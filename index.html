<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>Á´†È±ºÂñ∑Â¢®Êú∫</title>
    <meta name="theme-color" content="#ffffff" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="UwU" />
    <meta name="mobile-web-app-capable" content="yes" />
    <link rel="apple-touch-icon" href="https://i.postimg.cc/DZHdV88x/chan-135.png">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="referrer" content="no-referrer" />

    <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
    <script src="https://unpkg.com/dompurify@2.3.8/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mammoth@1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <!-- CSS Split: Base & Layout -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">

    <!-- CSS Split: Core Features -->
    <link rel="stylesheet" href="css/chat.css">
    <link rel="stylesheet" href="css/settings.css">

    <!-- CSS Split: Modules -->
    <link rel="stylesheet" href="css/modules/peek.css">
    <link rel="stylesheet" href="css/modules/search.css">
    <link rel="stylesheet" href="css/modules/pomodoro.css">
    <link rel="stylesheet" href="css/modules/forum.css">
    <link rel="stylesheet" href="css/modules/worldbook.css">
    <link rel="stylesheet" href="css/modules/journal.css">
    <link rel="stylesheet" href="css/modules/piggy_bank.css">
    <link rel="stylesheet" href="css/modules/steps.css">
    <link rel="stylesheet" href="css/modules/more.css">
    <link rel="stylesheet" href="css/modules/monitor.css">
    <link rel="stylesheet" href="css/modules/tutorial.css">
    <link rel="stylesheet" href="css/modules/live.css">
    <link rel="stylesheet" href="css/modules/shop.css">
    <link rel="stylesheet" href="css/modules/cot_settings.css">
    <link rel="stylesheet" href="css/modules/video_call.css">
    <link rel="stylesheet" href="css/modules/archive.css">
    <link rel="stylesheet" href="css/modules/favorites.css">

    <!-- Other Styles -->
    <link rel="stylesheet" href="contacts.css">
    <link rel="stylesheet" href="more_menu.css">
    <!-- <link rel="stylesheet" href="style.css"> (Deprecated) -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        /* ‰ªÖ„ÄåÂØºÂÖ•ÊñáÊ°£„ÄçËøõÂÖ•ÂàõÂª∫Êó∂ÔºöÂºπÁ™óÈôêÈ´ò + ÊªöÂä®Êù° */
        #add-char-modal.import-mode .modal-window {
            max-height: 70vh;
            overflow-y: auto;
        }

        /* === TTS ËØ≠Èü≥ÈÄâÊã©Âô®Ê†∑Âºè === */
        .voice-lang-filter {
            transition: all 0.2s;
        }
        
        .voice-lang-filter.active {
            background: var(--primary-color) !important;
            color: white !important;
            border-color: var(--primary-color) !important;
        }
        
        .voice-item {
            transition: all 0.2s;
        }
        
        .voice-item:hover {
            background: #f5f5f5 !important;
            border-color: var(--primary-color) !important;
        }
        
        .voice-item.selected {
            background: #e3f2fd !important;
            border-color: var(--primary-color) !important;
        }
        
        #voice-list-container {
            scrollbar-width: thin;
            scrollbar-color: #ccc transparent;
        }
        
        #voice-list-container::-webkit-scrollbar {
            width: 6px;
        }
        
        #voice-list-container::-webkit-scrollbar-track {
            background: transparent;
        }
        
        #voice-list-container::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }
        
        #voice-list-container::-webkit-scrollbar-thumb:hover {
            background: #999;
        }
    </style>
</head>

<body>
    <svg width="0" height="0" style="position:absolute;">
        <defs>
            <clipPath id="heart-clip" clipPathUnits="objectBoundingBox">
                <path d="M0.5,1 C0.1,0.8,0,0.45,0.5,0.2 C1,0.45,0.9,0.8,0.5,1 Z" />
            </clipPath>
        </defs>
    </svg>
    <div class="phone-screen">
        <div id="home-screen" class="screen active"></div>
        <div id="chat-list-screen" class="screen">
            <header class="app-header chat-list-header">
                <div class="header-left">
                    <h1 class="title">Chats</h1>
                    <button class="back-btn hidden-back-btn" data-target="home-screen">‚Äπ</button>
                </div>
                <div class="action-btn-group">
                    <!-- ÊêúÁ¥¢ (Ë£ÖÈ•∞) -->
                    <button class="action-btn" title="ÊêúÁ¥¢">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                    </button>
                    <!-- Ê∑ªÂä†Êñ∞ËßíËâ≤ -->
                    <button class="action-btn" id="add-chat-btn-kkt" title="Ê∑ªÂä†Êñ∞ËßíËâ≤">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="8.5" cy="7" r="4"></circle>
                            <line x1="20" y1="8" x2="20" y2="14"></line>
                            <line x1="23" y1="11" x2="17" y2="11"></line>
                        </svg>
                    </button>
                    <!-- ÂàõÂª∫Áæ§ËÅä -->
                    <button class="action-btn" id="create-group-btn-kkt" title="ÂàõÂª∫Áæ§ËÅä">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                    </button>
                    <!-- ËÆæÁΩÆ/ÂØºÂÖ• -->
                    <button class="action-btn" id="import-btn-kkt" title="ÂØºÂÖ•/ËÆæÁΩÆ">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path
                                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                            </path>
                        </svg>
                    </button>
                </div>
            </header>
            <div class="chat-category-tabs" id="chat-category-tabs">
                <!-- JS Âä®ÊÄÅÁîüÊàê -->
            </div>
            <main class="content">
                <ul class="list-container" id="chat-list-container"></ul>
                <div class="placeholder-text" id="no-chats-placeholder" style="display: none;">
                    <p>ËøòÊ≤°ÊúâËÅäÂ§©ÂØπË±°Âì¶~</p>
                    <p>ÁÇπÂáªÂè≥‰∏äËßíÁöÑ‚Äú+‚ÄùÂàõÂª∫‰∏Ä‰∏™ÂêßÔºÅ</p>
                </div>
            </main>
        </div>
        <div id="contacts-screen" class="screen">
            <header class="app-header chat-list-header">
                <div class="header-left">
                    <h1 class="title">Friends</h1>
                    <button class="back-btn hidden-back-btn" data-target="home-screen">‚Äπ</button>
                </div>
                <div class="action-btn-group">
                    <!-- ÊêúÁ¥¢ -->
                    <button class="action-btn" title="ÊêúÁ¥¢">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                    </button>
                    <!-- Ê∑ªÂä†Â•ΩÂèã -->
                    <button class="action-btn" title="Ê∑ªÂä†Â•ΩÂèã">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="8.5" cy="7" r="4"></circle>
                            <line x1="20" y1="8" x2="20" y2="14"></line>
                            <line x1="23" y1="11" x2="17" y2="11"></line>
                        </svg>
                    </button>
                    <!-- ËÆæÁΩÆ -->
                    <button class="action-btn" title="ËÆæÁΩÆ">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path
                                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                            </path>
                        </svg>
                    </button>
                </div>
            </header>
            <main class="content">
                <!-- My Profile Section -->
                <div class="profile-section" id="my-profile-section">
                    <!-- JS Âä®ÊÄÅÊ≥®ÂÖ•ÊàëÁöÑ‰ø°ÊÅØ -->
                    <div class="profile-item my-profile">
                        <img src="https://i.postimg.cc/GtbTnxhP/o-o-1.jpg" alt="My Avatar"
                            class="profile-avatar squircle" id="contacts-my-avatar">
                        <div class="profile-info">
                            <div class="profile-name" id="contacts-my-name">User Name</div>
                            <div class="profile-status" id="contacts-my-status">Set a status message</div>
                        </div>
                    </div>
                </div>

                <div class="section-divider"></div>

                <!-- Friends List Section -->
                <div class="friends-section">
                    <div class="section-title">Â•ΩÂèã <span id="friends-count">0</span></div>
                    <ul class="friend-list" id="contacts-list">
                        <!-- JS Âä®ÊÄÅÊ≥®ÂÖ•Â•ΩÂèãÂàóË°® -->
                    </ul>
                </div>
            </main>

        </div>

        <div id="phone-screen" class="screen">
            <div
                style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; color: #999; gap: 20px;">
                <div style="font-size: 16px; letter-spacing: 1px;">ÁáÉÂ∞Ω‰∫ÜÔºåËøôÈáåÊ≤°Êúâ‰ªª‰ΩïÂäüËÉΩ<br>ÁÇπËøôÈáå‚Üì</div>
                <div id="burnout-bubble" style="cursor: pointer; opacity: 0.6; transition: opacity 0.3s;">
                    <svg viewBox="0 0 24 24" width="32" height="32" fill="currentColor">
                        <path
                            d="M20,2H4A2,2,0,0,0,2,4V22L6,18H20A2,2,0,0,0,22,16V4A2,2,0,0,0,20,2M20,16H6L4,18V4H20V16M6,9H18V11H6V9M6,12H12V14H6V12Z" />
                    </svg>
                </div>
                <!-- ‰∏¥Êó∂Áõ¥Êí≠ÂÖ•Âè£ -->
                <button id="temp-live-entry-btn" class="btn btn-primary" style="width: auto; padding: 10px 20px;">
                    ËøõÂÖ•Áõ¥Êí≠Èó¥ (ÊµãËØï)
                </button>
            </div>
        </div>

        <!-- Áõ¥Êí≠Èó¥ Screen -->
        <div id="live-room-screen" class="screen">
            <div class="live-bg-layer" id="live-bg-layer"></div>
            <div class="live-letterbox"></div>

            <div class="live-header">
                <div class="live-host-info">
                    <img src="" class="live-host-avatar" id="live-host-avatar">
                    <div class="live-host-text">
                        <span class="live-host-name" id="live-host-name">‰∏ªÊí≠Âêç</span>
                        <span class="live-host-hot">üî• 1.2w</span>
                    </div>
                </div>
                <button class="live-close-btn" id="live-close-btn">√ó</button>
            </div>

            <div class="live-stage">
                <div class="live-action-text" id="live-action-text"></div>
                <div class="live-speech-bubble" id="live-speech-bubble"></div>
            </div>

            <div class="live-danmaku-area" id="live-danmaku-area"></div>

            <div class="live-gift-effect-container" id="live-gift-effect-container"></div>

            <div class="live-controls">
                <div class="live-input-box">
                    <input type="text" id="live-input" placeholder="ËØ¥ÁÇπ‰ªÄ‰πà..."
                        style="background:transparent; border:none; color:#fff; width:100%; outline:none;">
                </div>
                <button class="live-btn" id="live-send-btn">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
                    </svg>
                </button>
                <button class="live-btn live-gift-btn" id="live-gift-btn">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                        <path
                            d="M20,8L12,13L4,8V6H20M20,4H4A2,2 0 0,0 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6A2,2 0 0,0 20,4M12.5,18C12.5,17.29 12.17,16.65 11.64,16.27C12.17,15.89 12.5,15.26 12.5,14.55C12.5,13.6 11.83,12.79 11,12.58V12H13V10H11V8H13V6H11V5C11,4.45 10.55,4 10,4H8C7.45,4 7,4.45 7,5V6H9V8H7V10H9V12H7V12.58C6.17,12.79 5.5,13.6 5.5,14.55C5.5,15.26 5.83,15.89 6.36,16.27C5.83,16.65 5.5,17.29 5.5,18H12.5Z" />
                    </svg>
                </button>
            </div>
        </div>
        <!-- ÂÖ®Â±ÄÂ∫ïÈÉ®ÂØºËà™Ê†è -->
        <nav class="bottom-nav" id="global-bottom-nav" style="display: none;">
            <button class="nav-item" title="ËÅîÁ≥ª‰∫∫" data-target="contacts-screen" data-nav-id="0">
                <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="currentColor"
                    class="bi bi-person-fill" viewBox="0 0 16 16">
                    <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" />
                </svg>
                <img class="nav-icon-img" src="" alt="icon">
            </button>
            <button class="nav-item active" title="ËÅäÂ§©" data-target="chat-list-screen" data-nav-id="1">
                <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="currentColor"
                    class="bi bi-chat-fill" viewBox="0 0 16 16">
                    <path
                        d="M8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6-.097 1.016-.417 2.13-.771 2.966-.079.186.074.394.273.362 2.256-.37 3.597-.938 4.18-1.234A9.06 9.06 0 0 0 8 15z" />
                </svg>
                <img class="nav-icon-img" src="" alt="icon">
                <span class="nav-badge" id="nav-chat-badge" style="display: none;">0</span>
            </button>
            <button class="nav-item" title="ÁîµËØù" data-target="phone-screen" data-nav-id="2">
                <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="currentColor"
                    class="bi bi-telephone-fill" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M1.885.511a1.745 1.745 0 0 1 2.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z" />
                </svg>
                <img class="nav-icon-img" src="" alt="icon">
            </button>
            <button class="nav-item" title="Êõ¥Â§ö" data-target="more-screen" data-nav-id="3">
                <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="currentColor"
                    class="bi bi-three-dots" viewBox="0 0 16 16">
                    <path
                        d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z" />
                </svg>
                <img class="nav-icon-img" src="" alt="icon">
            </button>
        </nav>
        <div id="chat-room-screen" class="screen">
            <header class="app-header" id="chat-room-header-default">
                <button class="back-btn" data-target="chat-list-screen">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 12H5M12 19l-7-7 7-7" />
                    </svg>
                </button>
                <div class="title-container">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 6px;">
                        <h1 class="title" id="chat-room-title">...</h1>
                        <button id="char-status-btn" title="Áä∂ÊÄÅ"
                            style="display: none; background: none; border: none; padding: 0; cursor: pointer; color: #a5c1d6; display: flex; align-items: center;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor"
                                class="bi bi-reception-3" viewBox="0 0 16 16">
                                <path
                                    d="M0 11.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-2zm4-3a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-5zm4-3a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-8zm4 8a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z" />
                            </svg>
                        </button>
                    </div>
                    <!-- Âú®Á∫øÁä∂ÊÄÅÊöÇÊó∂ÈöêËóèÊàñÁßªÂà∞Ê†áÈ¢òÊóÅÔºåÊ†πÊçÆKKTÈ£éÊ†ºÈÄöÂ∏∏Âè™ÊòæÁ§∫ÂêçÂ≠ó -->
                    <div class="subtitle" id="chat-room-subtitle" style="display:none;">
                        <div class="online-indicator"></div>
                        <span id="chat-room-status-text">Âú®Á∫ø</span>
                    </div>
                </div>
                <div class="action-btn-group">
                    <button class="action-btn" id="peek-btn" title="ÂÅ∑Áúã" style="position: relative;">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <span class="nav-badge" id="gossip-badge"
                            style="display: none; top: -2px; right: -2px; width: 8px; height: 8px; padding: 0;"></span>
                    </button>
                    <button class="action-btn" id="chat-settings-btn" title="ËÆæÁΩÆ">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="3" y1="12" x2="21" y2="12"></line>
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <line x1="3" y1="18" x2="21" y2="18"></line>
                        </svg>
                    </button>
                </div>
            </header>
            <header class="app-header" id="chat-room-header-select" style="display: none;">
                <button class="action-btn" id="cancel-multi-select-btn">ÂèñÊ∂à</button>
                <div class="title-container">
                    <h1 class="title" id="multi-select-title">ÈÄâÊã©Ê∂àÊÅØ</h1>
                </div>
                <div class="placeholder"></div>
            </header>
            <main class="content">
                <div class="message-area" id="message-area"></div>
                <div class="typing-indicator" id="typing-indicator"></div>
            </main>

            <!-- ËßíËâ≤Áä∂ÊÄÅÊ†èË¶ÜÁõñÂ±Ç -->
            <div id="char-status-overlay" class="status-panel-overlay">
                <div class="status-panel-content" id="char-status-content">
                    <!-- JS Âä®ÊÄÅÊ≥®ÂÖ• -->
                </div>
                <button class="close-status-panel" id="close-status-panel-btn">√ó</button>
            </div>

            <div class="chat-input-wrapper">
                <div id="reply-preview-bar">
                    <div class="reply-preview-content">
                        <span class="reply-preview-name"></span>
                        <p class="reply-preview-text"></p>
                    </div>
                    <button id="cancel-reply-btn">√ó</button>
                </div>
                <div class="message-input-area" id="message-input-default">
                    <button id="toggle-expansion-btn" class="icon-btn circle-bg">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                    <div class="input-wrapper">
                        <input type="text" id="message-input" autocomplete="off" placeholder="">
                        <button id="sticker-toggle-btn" class="icon-btn input-inner-btn">
                            <img src="https://i.postimg.cc/prRC31Gk/retouch-2025110902080890.png" alt="Ë°®ÊÉÖ">
                        </button>
                    </div>
                    <button id="get-reply-btn" class="icon-btn">
                        <svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="12" fill="#F0F0F0" />
                            <g fill="#191919">
                                <rect x="11.25" y="5.85" width="1.5" height="12.3" rx="0.2" />
                                <rect x="8.55" y="8.35" width="1.5" height="7.3" rx="0.2" />
                                <rect x="13.95" y="8.35" width="1.5" height="7.3" rx="0.2" />
                                <rect x="5.85" y="10.5" width="1.5" height="3" rx="0.2" />
                                <rect x="16.65" y="10.5" width="1.5" height="3" rx="0.2" />
                            </g>
                        </svg>
                    </button>
                    <button id="send-message-btn" class="icon-btn send-btn circle-bg" style="display: none;">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Â∫ïÈÉ®ÂäüËÉΩÂ±ïÂºÄÈù¢Êùø -->
            <div id="chat-expansion-panel">
                <!-- ÂäüËÉΩÊåâÈíÆÂå∫Âüü -->
                <div id="panel-function-area" class="panel-area">
                    <div class="expansion-grid">
                        <div class="expansion-item" id="regenerate-btn">
                            <div class="expansion-item-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M17.65,6.35C16.2,4.9,14.21,4,12,4A8,8,0,0,0,4,12A8,8,0,0,0,12,20C15.73,20,18.84,17.45,19.73,14H17.65C16.83,16.33,14.61,18,12,18A6,6,0,0,1,6,12A6,6,0,0,1,12,6C13.66,6,15.14,6.69,16.22,7.78L13,11H20V4L17.65,6.35Z" />
                                </svg>
                            </div>
                            <span class="expansion-item-name">ÈáçÂõû</span>
                        </div>
                        <div class="expansion-item" id="photo-video-btn">
                            <div class="expansion-item-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z" />
                                </svg>
                            </div>
                            <span class="expansion-item-name">Áõ∏ÂÜå</span>
                        </div>
                        <div class="expansion-item" id="image-recognition-btn">
                            <div class="expansion-item-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M21.58,16.09L19.66,18L18.24,16.58L21,13.83C21.39,13.44 22,13.44 22.39,13.83L23.17,14.61C23.56,15 23.56,15.64 23.17,16.03L21.58,17.62M20.13,12.25L18.71,13.66L20.41,15.36L21.83,13.94L20.13,12.25M5.93,19H5C3.9,19 3,18.1 3,17V5C3,3.9 3.9,3 5,3H19C20.1,3 21,3.9 21,5V11.08L19,13.08V5H5V17H5.93L13.5,9.43L16.29,12.21L12.08,16.42L5.93,19Z" />
                                </svg>
                            </div>
                            <span class="expansion-item-name">ËØÜÂõæ</span>
                        </div>
                        <div class="expansion-item" id="voice-message-btn">
                            <div class="expansion-item-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z" />
                                </svg>
                            </div>
                            <span class="expansion-item-name">ËØ≠Èü≥</span>
                        </div>
                        <div class="expansion-item" id="wallet-btn">
                            <div class="expansion-item-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M20 4H4C2.9 4 2 4.9 2 6V18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6C22 4.9 21.1 4 20 4ZM20 18H4V8H20V18ZM4 6H20V6H4Z" />
                                </svg>
                            </div>
                            <span class="expansion-item-name">ËΩ¨Ë¥¶</span>
                        </div>
                        <div class="expansion-item" id="gift-btn">
                            <div class="expansion-item-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M20,8L12,13L4,8V6H20M20,4H4A2,2 0 0,0 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6A2,2 0 0,0 20,4M12.5,18C12.5,17.29 12.17,16.65 11.64,16.27C12.17,15.89 12.5,15.26 12.5,14.55C12.5,13.6 11.83,12.79 11,12.58V12H13V10H11V8H13V6H11V5C11,4.45 10.55,4 10,4H8C7.45,4 7,4.45 7,5V6H9V8H7V10H9V12H7V12.58C6.17,12.79 5.5,13.6 5.5,14.55C5.5,15.26 5.83,15.89 6.36,16.27C5.83,16.65 5.5,17.29 5.5,18H12.5Z" />
                                </svg>
                            </div>
                            <span class="expansion-item-name">Á§ºÁâ©</span>
                        </div>
                        <div class="expansion-item" id="time-skip-btn">
                            <div class="expansion-item-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M4 5v14l7-7-7-7zm9 0v14l7-7-7-7z"></path>
                                </svg>
                            </div>
                            <span class="expansion-item-name">ÂâßÊÉÖ</span>
                        </div>
                        <div class="expansion-item" id="memory-journal-btn">
                            <div class="expansion-item-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M12,13.09C11.67,13.03 11.34,13 11,13A3,3 0 0,0 8,16A3,3 0 0,0 11,19C12.36,19 13.5,18.15 13.91,17H16V15H13.91C13.5,13.85 12.36,13.09 12,13.09M11,17A1,1 0 0,1 10,16A1,1 0 0,1 11,15A1,1 0 0,1 12,16A1,1 0 0,1 11,17Z" />
                                </svg>
                            </div>
                            <span class="expansion-item-name">Êó•ËÆ∞</span>
                        </div>
                        <div class="expansion-item" id="delete-history-btn">
                            <div class="expansion-item-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z" />
                                </svg>
                            </div>
                            <span class="expansion-item-name">ÁÆ°ÁêÜ</span>
                        </div>
                        <div class="expansion-item" id="char-gallery-manage-btn">
                            <div class="expansion-item-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M22 16V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2zm-11-4l2.03 2.71L16 11l4 5H8l3-4zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6H2z" />
                                </svg>
                            </div>
                            <span class="expansion-item-name">TAÁõ∏ÂÜå</span>
                        </div>
                        <div class="expansion-item" id="capture-btn">
                            <div class="expansion-item-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z" />
                                </svg>
                            </div>
                            <span class="expansion-item-name">ÊçïËé∑</span>
                        </div>
                        <div class="expansion-item" id="shop-btn">
                            <div class="expansion-item-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M21.9 8.89l-1.06-4.24C20.67 3.82 19.92 3.25 19.06 3.25h-14.12c-0.86 0-1.61 0.57-1.78 1.4L2.1 8.89c-0.34 1.35 0.38 2.7 1.63 3.12l0.27 0.09V19c0 1.1 0.9 2 2 2h12c1.1 0 2-0.9 2-2v-6.9l0.27-0.09c1.25-0.42 1.97-1.77 1.63-3.12zM12 13c-1.1 0-2-0.9-2-2s0.9-2 2-2 2 0.9 2 2-0.9 2-2 2z">
                                    </path>
                                </svg>
                            </div>
                            <span class="expansion-item-name">ÂïÜÂüé</span>
                        </div>
                        <div class="expansion-item" id="video-call-btn">
                            <div class="expansion-item-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                                    class="bi bi-telephone-outbound" viewBox="0 0 16 16">
                                    <path
                                        d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.568 17.568 0 0 0 4.168 6.608 17.569 17.569 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.678.678 0 0 0-.58-.122l-2.19.547a1.745 1.745 0 0 1-1.657-.459L5.482 8.062a1.745 1.745 0 0 1-.46-1.657l.548-2.19a.678.678 0 0 0-.122-.58L3.654 1.328zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511zM11 .5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V1.707l-4.146 4.147a.5.5 0 0 1-.708-.708L14.293 1H11.5a.5.5 0 0 1-.5-.5z" />
                                </svg>
                            </div>
                            <span class="expansion-item-name">ÈÄöËØù</span>
                        </div>
                    </div>
                </div>

                <!-- Ë°®ÊÉÖÂåÖÂå∫Âüü (Âéü sticker-modal ÂÜÖÂÆπ) -->
                <div id="panel-sticker-area" class="panel-area" style="display: none;">
                    <!-- È°∂ÈÉ®ÂØºËà™Ë°åÔºöÂ∑¶‰æßÊòØÂàÜÁªÑÔºåÂè≥‰æßÊòØËèúÂçïÊåâÈíÆ -->
                    <div class="sticker-nav-row">
                        <div id="sticker-category-bar">
                            <!-- JS Âä®ÊÄÅÁîüÊàêÂàÜÁªÑ -->
                        </div>
                        <button class="icon-btn-simple" id="sticker-menu-btn">
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                <path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" />
                            </svg>
                        </button>
                    </div>

                    <!-- Ë°®ÊÉÖÂàóË°®ÂÆπÂô® -->
                    <div class="sticker-grid" id="sticker-grid-container"></div>

                    <!-- Â∫ïÈÉ®ÁÆ°ÁêÜÊ†è (‰ªÖÂú®Â§öÈÄâÊ®°ÂºèÊòæÁ§∫) -->
                    <div id="sticker-manage-bar">
                        <div class="manage-bar-content">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <button class="btn btn-neutral btn-small" id="select-all-stickers-btn"
                                    style="padding: 4px 8px; font-size: 12px;">ÂÖ®ÈÄâ</button>
                                <span id="sticker-select-count" style="font-size: 14px; color: #666;">Â∑≤ÈÄâ 0 È°π</span>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-neutral btn-small" id="move-sticker-group-btn">ÁßªÂä®ÂàÜÁªÑ</button>
                                <button class="btn btn-danger btn-small" id="delete-selected-stickers-btn">Âà†Èô§</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="music-screen" class="screen"></div>


            <div id="multi-select-bar"><span id="select-count">Â∑≤ÈÄâÊã© 0 È°π</span>
                <button class="btn btn-danger" id="delete-selected-btn" style="width: auto; padding: 8px 16px;">Âà†Èô§Â∑≤ÈÄâ</button>
                <button class="btn btn-primary" id="favorite-selected-btn" style="display: none; width: auto; padding: 8px 16px;">Êî∂ËóèÈÄâ‰∏≠</button>
            </div>
            <div id="capture-mode-bar">
                <span id="capture-select-count">Â∑≤ÈÄâÊã© 0 È°π</span>
                <button class="btn btn-primary" id="generate-capture-btn"
                    style="width: auto; padding: 8px 16px;">ÁîüÊàêÊà™Âõæ</button>
            </div>
        </div> <!-- ËøôÈáåÊòØ chat-room-screen ÁöÑÁªìÊùüÊ†áÁ≠æ -->


        <!-- Êñ∞Â¢ûÔºöÁÆ°ÁêÜËèúÂçï (ÁÇπÂáªÂè≥‰∏äËßíËèúÂçïÈîÆÂá∫Áé∞) -->
        <div id="sticker-menu-actionsheet" class="action-sheet-overlay">
            <div class="action-sheet">
                <button class="action-sheet-button" id="menu-multi-select-btn">Â§öÈÄâÁÆ°ÁêÜ</button>
                <button class="action-sheet-button" id="menu-batch-import-btn">ÊâπÈáèÂØºÂÖ•</button>
                <button class="action-sheet-button" id="menu-add-new-btn">Ê∑ªÂä†Êñ∞Ë°®ÊÉÖ</button>
                <button class="action-sheet-button danger" id="menu-cancel-btn">ÂèñÊ∂à</button>
            </div>
        </div>

        <!-- Êñ∞Â¢ûÔºöÁßªÂä®ÂàÜÁªÑÂºπÁ™ó -->
        <div id="move-sticker-modal" class="modal-overlay">
            <div class="modal-window">
                <h3>ÁßªÂä®Âà∞ÂàÜÁªÑ</h3>
                <div class="form-group">
                    <label>ÈÄâÊã©ÊàñËæìÂÖ•Êñ∞ÂàÜÁªÑÂêçÁß∞</label>
                    <input type="text" id="move-target-group-input" placeholder="‰æãÂ¶ÇÔºöÁå´Áå´Âõæ" list="existing-groups-list">
                    <datalist id="existing-groups-list">
                        <!-- JS Ëá™Âä®Â°´ÂÖÖÁé∞ÊúâÂàÜÁªÑ -->
                    </datalist>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button id="confirm-move-sticker-btn" class="btn btn-primary" style="flex: 1;">Á°ÆËÆ§ÁßªÂä®</button>
                    <button id="cancel-move-sticker-btn" class="btn btn-neutral" style="flex: 1;">ÂèñÊ∂à</button>
                </div>
            </div>
        </div>

        <div id="world-book-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="home-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">‰∏ñÁïå‰π¶</h1>
                </div>
                <div class="action-btn-group">
                    <button class="action-btn" id="add-world-book-btn">+</button>
                    <button class="action-btn" id="cancel-wb-multi-select-btn"
                        style="display: none; font-size: 16px;">ÂèñÊ∂à</button>
                </div>
            </header>
            <main class="content">
                <ul class="list-container" id="world-book-list-container"></ul>
                <div class="placeholder-text" id="no-world-books-placeholder" style="display: none;">
                    <p>‰Ω†ÁöÑ‰∏ñÁïå‰∏ÄÁâáÊ∑∑Ê≤å...</p>
                    <p>ÁÇπÂáªÂè≥‰∏äËßíÁöÑ‚Äú+‚ÄùÂàõÈÄ†Á¨¨‰∏Ä‰∏™ËÆæÂÆöÂêßÔºÅ</p>
                </div>
            </main>
            <div id="world-book-multi-select-bar" style="display: none;">
                <span id="world-book-select-count">Â∑≤ÈÄâÊã© 0 È°π</span>
                <button class="btn btn-danger" id="delete-selected-world-books-btn"
                    style="width: auto; padding: 8px 16px;">Âà†Èô§Â∑≤ÈÄâ</button>
            </div>
        </div>
        <div id="edit-world-book-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="world-book-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title" id="edit-world-book-title">ÂàõÂª∫/ÁºñËæëÊù°ÁõÆ</h1>
                </div>
                <div class="placeholder"></div>
            </header>
            <main class="content">
                <form id="edit-world-book-form">
                    <input type="hidden" id="world-book-id">
                    <div class="form-group">
                        <label for="world-book-name">Êù°ÁõÆÂêçÁß∞</label>
                        <input type="text" id="world-book-name" placeholder="‰æãÂ¶ÇÔºö‰∏ñÁïåËßÇËÉåÊôØ„ÄÅÈ≠îÊ≥ï‰ΩìÁ≥ª" required>
                    </div>
                    <div class="form-group">
                        <label for="world-book-category">Êù°ÁõÆÂàÜÁ±ª</label>
                        <input type="text" id="world-book-category" placeholder="‰æãÂ¶ÇÔºö‰∫∫Áâ©„ÄÅÂú∞ÁÇπ„ÄÅÁªÑÁªáÔºàÂèØÈÄâÔºâ">
                    </div>
                    <div class="form-group">
                        <label for="world-book-content">Êù°ÁõÆÂÜÖÂÆπ</label>
                        <textarea id="world-book-content" rows="8" placeholder="ËØ¶ÁªÜÊèèËø∞Ê≠§È°πËÆæÂÆö..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Ê≥®ÂÖ•‰ΩçÁΩÆ</label>
                        <div class="form-group radio-group">
                            <label><input type="radio" name="world-book-position" value="before" checked> Ââç</label>
                            <label><input type="radio" name="world-book-position" value="middle"> ‰∏≠</label>
                            <label><input type="radio" name="world-book-position" value="after"> Âêé</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; justify-content: space-between;">
                            <span>ÂÖ®Â±Ä‰∏ñÁïå‰π¶</span>
                            <label class="kkt-switch" style="margin: 0;">
                                <input type="checkbox" id="world-book-global">
                                <span class="kkt-slider"></span>
                            </label>
                        </label>
                        <p style="font-size: 12px; color: #999; margin-top: 5px;">
                            ÂºÄÂêØÂêéÔºåÊ≠§Êù°ÁõÆÂ∞ÜËá™Âä®Â∫îÁî®Âà∞ÊâÄÊúâËßíËâ≤
                        </p>
                    </div>
                    <button type="submit" class="btn btn-primary">‰øùÂ≠òÊù°ÁõÆ</button>
                </form>
            </main>
        </div>
        <div id="api-settings-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="home-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">API ËÆæÁΩÆ</h1>
                </div>
                <div class="placeholder"></div>
            </header>
            <main class="content">
                <div class="kkt-settings-container">
                    <form id="api-form">
                        <!-- Âü∫Á°ÄÈÖçÁΩÆ -->
                        <div class="kkt-group">
                            <div class="kkt-item">
                                <div class="kkt-item-label">ÊúçÂä°ÂïÜ</div>
                                <div class="kkt-item-control">
                                    <select id="api-provider" name="provider"
                                        style="border:none; background:transparent; text-align:right; direction: rtl; appearance: none; -webkit-appearance: none; padding-right: 15px;">
                                        <option value="newapi">NewAPI (Ëá™ÂÆö‰πâ)</option>
                                        <option value="deepseek">DeepSeek</option>
                                        <option value="claude">Claude</option>
                                        <option value="gemini">Gemini</option>
                                    </select>
                                    <span class="kkt-arrow">‚Ä∫</span>
                                </div>
                            </div>
                            <div class="kkt-item">
                                <div class="kkt-item-label">API Âú∞ÂùÄ</div>
                                <div class="kkt-item-control">
                                    <input type="text" id="api-url" name="url" autocomplete="off"
                                        placeholder="https://..."
                                        style="text-align:right; border:none; background:transparent; width: 100%;">
                                </div>
                            </div>
                            <div class="kkt-item">
                                <div class="kkt-item-label">ÂØÜÈí• (Key)</div>
                                <div class="kkt-item-control">
                                    <input type="password" id="api-key" name="key" autocomplete="new-password"
                                        placeholder="sk-..."
                                        style="text-align:right; border:none; background:transparent; width: 100%;">
                                </div>
                            </div>
                        </div>

                        <!-- Ê®°ÂûãÈÖçÁΩÆ -->
                        <div class="kkt-group" style="margin-top: 15px;">
                            <div class="kkt-item">
                                <div class="kkt-item-label">Ê®°ÂûãÂàóË°®</div>
                                <div class="kkt-item-control">
                                    <button type="button" class="btn btn-small btn-secondary" id="fetch-models-btn"
                                        style="margin:0; padding: 4px 8px;">
                                        <span class="btn-text">ÊãâÂèñ</span>
                                        <div class="spinner"></div>
                                    </button>
                                </div>
                            </div>
                            <div class="kkt-item">
                                <div class="kkt-item-label">ÈÄâÊã©Ê®°Âûã</div>
                                <div class="kkt-item-control">
                                    <select id="api-model" name="model"
                                        style="border:none; background:transparent; text-align:right; direction: rtl; max-width: 180px; appearance: none; -webkit-appearance: none; padding-right: 15px;">
                                        <option value="">ËØ∑ÂÖàÊãâÂèñ</option>
                                    </select>
                                    <span class="kkt-arrow">‚Ä∫</span>
                                </div>
                            </div>
                        </div>

                        <!-- È´òÁ∫ßËÆæÁΩÆ -->
                        <div class="kkt-group" style="margin-top: 15px;">
                            <div class="kkt-item">
                                <div class="kkt-item-label">Êó∂Èó¥ÊÑüÁü•Âä†Âº∫</div>
                                <div class="kkt-item-control">
                                    <label class="kkt-switch">
                                        <input type="checkbox" id="time-perception-switch">
                                        <span class="kkt-slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="kkt-item">
                                <div class="kkt-item-label">ÊµÅÂºèËæìÂá∫</div>
                                <div class="kkt-item-control">
                                    <label class="kkt-switch">
                                        <input type="checkbox" id="stream-switch">
                                        <span class="kkt-slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="kkt-item"
                                style="flex-direction: column; align-items: stretch; padding-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <div class="kkt-item-label">ÂõûÂ§çÈöèÊú∫ÊÄß (Temperature)</div>
                                    <span id="temperature-value"
                                        style="color: var(--primary-color); font-weight: bold;">1.0</span>
                                </div>
                                <input type="range" id="temperature-slider" min="0" max="2" step="0.1" value="1.0"
                                    style="width: 100%; accent-color: var(--primary-color);">
                                <p style="font-size: 12px; color: #999; margin-top: 5px; margin-bottom: 0;">
                                    Êï∞ÂÄºË∂äÂ§ßË∂äÈöèÊú∫ÔºåÊï∞ÂÄºË∂äÂ∞èË∂ä‰∏•Ë∞®„ÄÇ</p>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary" id="save-btn"
                            style="margin-top: 20px; width: 100%;">
                            <span class="btn-text">‰øùÂ≠òËÆæÁΩÆ</span>
                            <div class="spinner"></div>
                        </button>
                        
                        <!-- API È¢ÑËÆæÁÆ°ÁêÜ -->
                        <div class="api-presets-embedded" style="margin-top:20px;">
                            <div style="margin-bottom: 10px;">
                                <h3 style="margin: 0; font-size: 14px; color: var(--primary-color);">API È¢ÑËÆæÁÆ°ÁêÜ</h3>
                                <p style="font-size: 11px; color: #999; margin: 3px 0 0;">ÁÆ°ÁêÜËÅäÂ§©APIÈÖçÁΩÆÈ¢ÑËÆæ</p>
                            </div>
                            <div id="api-presets-control"
                                style="padding:12px; border-radius:8px; background: #f5f5f5; border: 1px solid #eee;">
                                <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
                                    <label style="min-width:40px; color:#666; font-size: 14px;">È¢ÑËÆæ</label>
                                    <select id="api-preset-select"
                                        style="flex:1; padding:6px; border-radius:6px; border:1px solid #ddd;">
                                        <option value="">‚Äî ÈÄâÊã© ‚Äî</option>
                                    </select>
                                    <button id="api-apply-preset" class="btn btn-primary btn-small"
                                        style="padding: 6px 12px;">Â∫îÁî®</button>
                                </div>
                                <div style="display:flex; gap:8px; align-items:center; flex-wrap: wrap;">
                                    <button id="api-save-preset" class="btn btn-small" style="flex: 1;">Âè¶Â≠ò‰∏∫</button>
                                    <button id="api-manage-presets" class="btn btn-small" style="flex: 1;">ÁÆ°ÁêÜ</button>
                                    <button id="api-import-presets" class="btn btn-small" style="flex: 1;">ÂØºÂÖ•</button>
                                    <button id="api-export-presets" class="btn btn-small" style="flex: 1;">ÂØºÂá∫</button>
                                </div>
                            </div>
                            <div id="api-presets-modal"
                                style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.35);z-index:9999;align-items:center;justify-content:center;">
                                <div
                                    style="width:640px;max-width:94%;background:var(--panel-bg,#fff);padding:16px;border-radius:8px;box-shadow:0 8px 24px rgba(0,0,0,0.12);">
                                    <h3 style="margin:0 0 12px 0;">API È¢ÑËÆæÁÆ°ÁêÜ</h3>
                                    <div id="api-presets-list"
                                        style="max-height:360px;overflow:auto;border:1px solid #f0f0f0;padding:8px;border-radius:6px;">
                                    </div>
                                    <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end;">
                                        <button id="api-close-modal" class="btn btn-primary">ÂÖ≥Èó≠</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>

                    <!-- ÂâØAPI 1: ÊÄªÁªì‰∏ìÁî® -->
                    <div class="kkt-group" style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #eee;">
                        <div style="margin-bottom: 15px;">
                            <h3 style="margin: 0; font-size: 16px; color: var(--primary-color);">ÊÄªÁªì‰∏ìÁî® APIÔºàÂèØÈÄâÔºâ</h3>
                            <p style="font-size: 12px; color: #999; margin: 5px 0 0;">ÁïôÁ©∫Âàô‰ΩøÁî®‰∏ªAPIÔºåÂ°´ÂÜôÂêéÊÄªÁªìÂäüËÉΩ‰ºòÂÖà‰ΩøÁî®Ê≠§ÈÖçÁΩÆ</p>
                        </div>
                        
                        <div class="kkt-item">
                            <div class="kkt-item-label">ÊúçÂä°ÂïÜ</div>
                            <div class="kkt-item-control">
                                <select id="summary-api-provider"
                                    style="border:none; background:transparent; text-align:right; direction: rtl; appearance: none; -webkit-appearance: none; padding-right: 15px;">
                                    <option value="newapi">NewAPI (Ëá™ÂÆö‰πâ)</option>
                                    <option value="deepseek">DeepSeek</option>
                                    <option value="claude">Claude</option>
                                    <option value="gemini">Gemini</option>
                                </select>
                                <span class="kkt-arrow">‚Ä∫</span>
                            </div>
                        </div>
                        
                        <div class="kkt-item">
                            <div class="kkt-item-label">API Âú∞ÂùÄ</div>
                            <div class="kkt-item-control">
                                <input type="text" id="summary-api-url" autocomplete="off"
                                    placeholder="https://..."
                                    style="text-align:right; border:none; background:transparent; width: 100%;">
                            </div>
                        </div>
                        
                        <div class="kkt-item">
                            <div class="kkt-item-label">ÂØÜÈí• (Key)</div>
                            <div class="kkt-item-control">
                                <input type="password" id="summary-api-key" autocomplete="new-password"
                                    placeholder="sk-..."
                                    style="text-align:right; border:none; background:transparent; width: 100%;">
                            </div>
                        </div>
                        
                        <div class="kkt-item">
                            <div class="kkt-item-label">Ê®°ÂûãÂàóË°®</div>
                            <div class="kkt-item-control">
                                <button type="button" class="btn btn-small btn-secondary" id="summary-fetch-models-btn"
                                    style="margin:0; padding: 4px 8px;">
                                    <span class="btn-text">ÊãâÂèñ</span>
                                    <div class="spinner"></div>
                                </button>
                            </div>
                        </div>
                        
                        <div class="kkt-item">
                            <div class="kkt-item-label">ÈÄâÊã©Ê®°Âûã</div>
                            <div class="kkt-item-control">
                                <select id="summary-api-model"
                                    style="border:none; background:transparent; text-align:right; direction: rtl; max-width: 180px; appearance: none; -webkit-appearance: none; padding-right: 15px;">
                                    <option value="">ËØ∑ÂÖàÊãâÂèñ</option>
                                </select>
                                <span class="kkt-arrow">‚Ä∫</span>
                            </div>
                        </div>
                        
                        <button type="button" class="btn btn-primary" id="summary-api-save-btn"
                            style="margin-top: 15px; width: 100%;">
                            <span class="btn-text">‰øùÂ≠òÊÄªÁªìAPIËÆæÁΩÆ</span>
                            <div class="spinner"></div>
                        </button>
                        
                        <!-- ÊÄªÁªìAPIÈ¢ÑËÆæÁÆ°ÁêÜ -->
                        <div class="api-presets-embedded" style="margin-top:20px;">
                            <div style="margin-bottom: 10px;">
                                <h3 style="margin: 0; font-size: 14px; color: var(--primary-color);">ÊÄªÁªìAPIÈ¢ÑËÆæÁÆ°ÁêÜ</h3>
                                <p style="font-size: 11px; color: #999; margin: 3px 0 0;">ÁÆ°ÁêÜÊÄªÁªìAPIÈÖçÁΩÆÈ¢ÑËÆæ</p>
                            </div>
                            <div id="summary-api-presets-control"
                                style="padding:12px; border-radius:8px; background: #f5f5f5; border: 1px solid #eee;">
                                <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
                                    <label style="min-width:40px; color:#666; font-size: 14px;">È¢ÑËÆæ</label>
                                    <select id="summary-api-preset-select"
                                        style="flex:1; padding:6px; border-radius:6px; border:1px solid #ddd;">
                                        <option value="">‚Äî ÈÄâÊã© ‚Äî</option>
                                    </select>
                                    <button id="summary-api-apply-preset" class="btn btn-primary btn-small"
                                        style="padding: 6px 12px;">Â∫îÁî®</button>
                                </div>
                                <div style="display:flex; gap:8px; align-items:center; flex-wrap: wrap;">
                                    <button id="summary-api-save-preset" class="btn btn-small" style="flex: 1;">Âè¶Â≠ò‰∏∫</button>
                                    <button id="summary-api-manage-presets" class="btn btn-small" style="flex: 1;">ÁÆ°ÁêÜ</button>
                                    <button id="summary-api-import-presets" class="btn btn-small" style="flex: 1;">ÂØºÂÖ•</button>
                                    <button id="summary-api-export-presets" class="btn btn-small" style="flex: 1;">ÂØºÂá∫</button>
                                </div>
                            </div>
                            <div id="summary-api-presets-modal"
                                style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.35);z-index:9999;align-items:center;justify-content:center;">
                                <div
                                    style="width:640px;max-width:94%;background:var(--panel-bg,#fff);padding:16px;border-radius:8px;box-shadow:0 8px 24px rgba(0,0,0,0.12);">
                                    <h3 style="margin:0 0 12px 0;">ÊÄªÁªìAPIÈ¢ÑËÆæÁÆ°ÁêÜ</h3>
                                    <div id="summary-api-presets-list"
                                        style="max-height:360px;overflow:auto;border:1px solid #f0f0f0;padding:8px;border-radius:6px;">
                                    </div>
                                    <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end;">
                                        <button id="summary-api-close-modal" class="btn btn-primary">ÂÖ≥Èó≠</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ÂâØAPI 2: ÂêéÂè∞Ê¥ªÂä®‰∏ìÁî® -->
                    <div class="kkt-group" style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #eee;">
                        <div style="margin-bottom: 15px;">
                            <h3 style="margin: 0; font-size: 16px; color: var(--primary-color);">ÂêéÂè∞Ê¥ªÂä®‰∏ìÁî® APIÔºàÂèØÈÄâÔºâ</h3>
                            <p style="font-size: 12px; color: #999; margin: 5px 0 0;">ÁïôÁ©∫Âàô‰ΩøÁî®‰∏ªAPIÔºåÂ°´ÂÜôÂêéÂêéÂè∞Ê¥ªÂä®‰ºòÂÖà‰ΩøÁî®Ê≠§ÈÖçÁΩÆ</p>
                        </div>
                        
                        <div class="kkt-item">
                            <div class="kkt-item-label">ÊúçÂä°ÂïÜ</div>
                            <div class="kkt-item-control">
                                <select id="background-api-provider"
                                    style="border:none; background:transparent; text-align:right; direction: rtl; appearance: none; -webkit-appearance: none; padding-right: 15px;">
                                    <option value="newapi">NewAPI (Ëá™ÂÆö‰πâ)</option>
                                    <option value="deepseek">DeepSeek</option>
                                    <option value="claude">Claude</option>
                                    <option value="gemini">Gemini</option>
                                </select>
                                <span class="kkt-arrow">‚Ä∫</span>
                            </div>
                        </div>
                        
                        <div class="kkt-item">
                            <div class="kkt-item-label">API Âú∞ÂùÄ</div>
                            <div class="kkt-item-control">
                                <input type="text" id="background-api-url" autocomplete="off"
                                    placeholder="https://..."
                                    style="text-align:right; border:none; background:transparent; width: 100%;">
                            </div>
                        </div>
                        
                        <div class="kkt-item">
                            <div class="kkt-item-label">ÂØÜÈí• (Key)</div>
                            <div class="kkt-item-control">
                                <input type="password" id="background-api-key" autocomplete="new-password"
                                    placeholder="sk-..."
                                    style="text-align:right; border:none; background:transparent; width: 100%;">
                            </div>
                        </div>
                        
                        <div class="kkt-item">
                            <div class="kkt-item-label">Ê®°ÂûãÂàóË°®</div>
                            <div class="kkt-item-control">
                                <button type="button" class="btn btn-small btn-secondary" id="background-fetch-models-btn"
                                    style="margin:0; padding: 4px 8px;">
                                    <span class="btn-text">ÊãâÂèñ</span>
                                    <div class="spinner"></div>
                                </button>
                            </div>
                        </div>
                        
                        <div class="kkt-item">
                            <div class="kkt-item-label">ÈÄâÊã©Ê®°Âûã</div>
                            <div class="kkt-item-control">
                                <select id="background-api-model"
                                    style="border:none; background:transparent; text-align:right; direction: rtl; max-width: 180px; appearance: none; -webkit-appearance: none; padding-right: 15px;">
                                    <option value="">ËØ∑ÂÖàÊãâÂèñ</option>
                                </select>
                                <span class="kkt-arrow">‚Ä∫</span>
                            </div>
                        </div>
                        
                        <button type="button" class="btn btn-primary" id="background-api-save-btn"
                            style="margin-top: 15px; width: 100%;">
                            <span class="btn-text">‰øùÂ≠òÂêéÂè∞Ê¥ªÂä®APIËÆæÁΩÆ</span>
                            <div class="spinner"></div>
                        </button>
                        
                        <!-- ÂêéÂè∞Ê¥ªÂä®APIÈ¢ÑËÆæÁÆ°ÁêÜ -->
                        <div class="api-presets-embedded" style="margin-top:20px;">
                            <div style="margin-bottom: 10px;">
                                <h3 style="margin: 0; font-size: 14px; color: var(--primary-color);">ÂêéÂè∞Ê¥ªÂä®APIÈ¢ÑËÆæÁÆ°ÁêÜ</h3>
                                <p style="font-size: 11px; color: #999; margin: 3px 0 0;">ÁÆ°ÁêÜÂêéÂè∞Ê¥ªÂä®APIÈÖçÁΩÆÈ¢ÑËÆæ</p>
                            </div>
                            <div id="background-api-presets-control"
                                style="padding:12px; border-radius:8px; background: #f5f5f5; border: 1px solid #eee;">
                                <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
                                    <label style="min-width:40px; color:#666; font-size: 14px;">È¢ÑËÆæ</label>
                                    <select id="background-api-preset-select"
                                        style="flex:1; padding:6px; border-radius:6px; border:1px solid #ddd;">
                                        <option value="">‚Äî ÈÄâÊã© ‚Äî</option>
                                    </select>
                                    <button id="background-api-apply-preset" class="btn btn-primary btn-small"
                                        style="padding: 6px 12px;">Â∫îÁî®</button>
                                </div>
                                <div style="display:flex; gap:8px; align-items:center; flex-wrap: wrap;">
                                    <button id="background-api-save-preset" class="btn btn-small" style="flex: 1;">Âè¶Â≠ò‰∏∫</button>
                                    <button id="background-api-manage-presets" class="btn btn-small" style="flex: 1;">ÁÆ°ÁêÜ</button>
                                    <button id="background-api-import-presets" class="btn btn-small" style="flex: 1;">ÂØºÂÖ•</button>
                                    <button id="background-api-export-presets" class="btn btn-small" style="flex: 1;">ÂØºÂá∫</button>
                                </div>
                            </div>
                            <div id="background-api-presets-modal"
                                style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.35);z-index:9999;align-items:center;justify-content:center;">
                                <div
                                    style="width:640px;max-width:94%;background:var(--panel-bg,#fff);padding:16px;border-radius:8px;box-shadow:0 8px 24px rgba(0,0,0,0.12);">
                                    <h3 style="margin:0 0 12px 0;">ÂêéÂè∞Ê¥ªÂä®APIÈ¢ÑËÆæÁÆ°ÁêÜ</h3>
                                    <div id="background-api-presets-list"
                                        style="max-height:360px;overflow:auto;border:1px solid #f0f0f0;padding:8px;border-radius:6px;">
                                    </div>
                                    <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end;">
                                        <button id="background-api-close-modal" class="btn btn-primary">ÂÖ≥Èó≠</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Minimax TTS ÈÖçÁΩÆ (Áã¨Á´ã‰øùÂ≠ò) -->
                    <div class="kkt-group" style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #eee;">
                        <div style="margin-bottom: 15px;">
                            <h3 style="margin: 0; font-size: 16px; color: var(--primary-color);">Minimax TTS ÈÖçÁΩÆ</h3>
                            <p style="font-size: 12px; color: #999; margin: 5px 0 0;">ËØ≠Èü≥ÂêàÊàêÊúçÂä°ÔºåÁã¨Á´ãÈÖçÁΩÆ</p>
                        </div>
                        
                        <div class="kkt-item">
                            <div class="kkt-item-label">ÂêØÁî® TTS</div>
                            <div class="kkt-item-control">
                                <label class="kkt-switch">
                                    <input type="checkbox" id="minimax-tts-enabled">
                                    <span class="kkt-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="kkt-item">
                            <div class="kkt-item-label">Group ID</div>
                            <div class="kkt-item-control">
                                <input type="text" id="minimax-group-id" autocomplete="off"
                                    placeholder="ËæìÂÖ• GroupId"
                                    style="text-align:right; border:none; background:transparent; width: 100%;">
                            </div>
                        </div>
                        
                        <div class="kkt-item">
                            <div class="kkt-item-label">API Key</div>
                            <div class="kkt-item-control">
                                <input type="password" id="minimax-api-key" autocomplete="new-password"
                                    placeholder="ËæìÂÖ• API Key"
                                    style="text-align:right; border:none; background:transparent; width: 100%;">
                            </div>
                        </div>
                        
                        <div class="kkt-item">
                            <div class="kkt-item-label">ÂüüÂêçÈÄâÊã©</div>
                            <div class="kkt-item-control">
                                <select id="minimax-domain"
                                    style="border:none; background:transparent; text-align:right; direction: rtl; appearance: none; -webkit-appearance: none; padding-right: 15px;">
                                    <option value="api.minimaxi.com">ÂõΩÈôÖ (api.minimaxi.com)</option>
                                    <option value="api.minimax.chat">ÂõΩÂÜÖ (api.minimax.chat)</option>
                                </select>
                                <span class="kkt-arrow">‚Ä∫</span>
                            </div>
                        </div>
                        
                        <div class="kkt-item">
                            <div class="kkt-item-label">TTS Ê®°Âûã</div>
                            <div class="kkt-item-control">
                                <select id="minimax-tts-model"
                                    style="border:none; background:transparent; text-align:right; direction: rtl; appearance: none; -webkit-appearance: none; padding-right: 15px;">
                                    <option value="speech-01">speech-01</option>
                                    <option value="speech-02-turbo">speech-02-turbo</option>
                                    <option value="speech-02-hd">speech-02-hd</option>
                                    <option value="speech-2.6-turbo">speech-2.6-turbo</option>
                                    <option value="speech-2.6-hd">speech-2.6-hd</option>
                                    <option value="speech-2.8-turbo">speech-2.8-turbo</option>
                                    <option value="speech-2.8-hd" selected>speech-2.8-hd (Êé®Ëçê)</option>
                                </select>
                                <span class="kkt-arrow">‚Ä∫</span>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button type="button" class="btn btn-primary" id="save-minimax-tts-btn"
                                style="flex: 1;">
                                ‰øùÂ≠ò TTS ÈÖçÁΩÆ
                            </button>
                            <button type="button" class="btn btn-secondary" id="test-minimax-tts-btn"
                                style="flex: 1;">
                                ÊµãËØïÊí≠Êîæ
                            </button>
                        </div>
                        
                        <!-- TTS È¢ÑËÆæÁÆ°ÁêÜ -->
                        <div style="margin-top:20px;">
                            <div id="tts-presets-control"
                                style="padding:12px; border-radius:8px; background: #f5f5f5; border: 1px solid #eee;">
                                <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
                                    <label style="min-width:60px; color:#666; font-size: 14px;">TTSÈ¢ÑËÆæ</label>
                                    <select id="tts-preset-select"
                                        style="flex:1; padding:6px; border-radius:6px; border:1px solid #ddd;">
                                        <option value="">‚Äî ÈÄâÊã© ‚Äî</option>
                                    </select>
                                    <button id="tts-apply-preset" class="btn btn-primary btn-small"
                                        style="padding: 6px 12px;">Â∫îÁî®</button>
                                </div>
                                <div style="display:flex; gap:8px; align-items:center; flex-wrap: wrap;">
                                    <button id="tts-save-preset" class="btn btn-small" style="flex: 1;">Âè¶Â≠ò‰∏∫</button>
                                    <button id="tts-manage-presets" class="btn btn-small" style="flex: 1;">ÁÆ°ÁêÜ</button>
                                    <button id="tts-import-presets" class="btn btn-small" style="flex: 1;">ÂØºÂÖ•</button>
                                    <button id="tts-export-presets" class="btn btn-small" style="flex: 1;">ÂØºÂá∫</button>
                                </div>
                            </div>
                            <div id="tts-presets-modal"
                                style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.35);z-index:9999;align-items:center;justify-content:center;">
                                <div
                                    style="width:640px;max-width:94%;background:var(--panel-bg,#fff);padding:16px;border-radius:8px;box-shadow:0 8px 24px rgba(0,0,0,0.12);">
                                    <h3 style="margin:0 0 12px 0;">TTS È¢ÑËÆæÁÆ°ÁêÜ</h3>
                                    <div id="tts-presets-list"
                                        style="max-height:360px;overflow:auto;border:1px solid #f0f0f0;padding:8px;border-radius:6px;">
                                    </div>
                                    <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end;">
                                        <button id="tts-close-modal" class="btn btn-primary">ÂÖ≥Èó≠</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
        <div id="wallpaper-screen" class="screen">
            <header class="app-header"><button class="back-btn" data-target="home-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">Êõ¥Êç¢Â£ÅÁ∫∏</h1>
                </div>
                <div class="placeholder"></div>
            </header>
            <main class="content">
                <div class="wallpaper-preview" id="wallpaper-preview"><span>ÂΩìÂâçÂ£ÅÁ∫∏È¢ÑËßà</span></div>
                <button type="button" id="wallpaper-reset-btn" class="btn btn-secondary">ÈáçÁΩÆ‰∏∫ÈªòËÆ§Â£ÅÁ∫∏</button>
                <input type="file"
                    id="wallpaper-upload" accept="image/*" style="display: none;"><label for="wallpaper-upload"
                    class="btn btn-primary">‰ªéÁõ∏ÂÜåÈÄâÊã©Êñ∞Â£ÅÁ∫∏</label>
            </main>
        </div>
        <div id="customize-screen" class="screen">
            <header class="app-header"><button class="back-btn" data-target="home-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">‰∏ªÂ±èÂπïËá™ÂÆö‰πâ</h1>
                </div>
                <div class="placeholder"></div>
            </header>
            <main class="content">
                <form id="customize-form"></form>
            </main>
        </div>

        <div id="search-history-screen" class="screen">
            <header class="search-header">
                <div class="search-input-wrapper">
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <input type="text" id="search-history-input" autocomplete="off" placeholder="ÊêúÁ¥¢ËÅäÂ§©ËÆ∞ÂΩï...">
                </div>
                <button class="search-cancel-btn" id="search-cancel-btn">ÂèñÊ∂à</button>
            </header>
            <div class="search-filter-bar">
                <div class="search-scope-select active" id="search-scope-select">
                    <span>ÊêúÁ¥¢ËåÉÂõ¥ÔºöÂÖ®ÈÉ®</span>
                    <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor">
                        <path d="M7 10l5 5 5-5z" />
                    </svg>
                </div>
                <div class="search-option-toggle">
                    <label class="kkt-switch kkt-switch-small">
                        <input type="checkbox" id="search-ignore-status" checked>
                        <span class="kkt-slider"></span>
                    </label>
                    <span style="font-size:12px; color:#666;">ÂøΩÁï•Áä∂ÊÄÅÊ†è</span>
                </div>
            </div>
            <main class="search-content" id="search-results-container">
                <!-- JS Ê∏≤ÊüìÁªìÊûú -->
            </main>

            <!-- ËåÉÂõ¥ÈÄâÊã©Ê®°ÊÄÅÊ°Ü -->
            <div id="search-scope-modal" class="scope-modal">
                <div class="scope-modal-content">
                    <h3 style="margin:0; font-size:16px; text-align:center;">ÈÄâÊã©ÊêúÁ¥¢ËåÉÂõ¥</h3>
                    <div class="scope-list" id="search-scope-list">
                        <!-- JS ÁîüÊàê -->
                    </div>
                </div>
            </div>
        </div>

        <div id="more-screen" class="screen">
            <header class="app-header chat-list-header">
                <div class="header-left">
                    <h1 class="title">Menu</h1>
                    <button class="back-btn hidden-back-btn" data-target="home-screen">‚Äπ</button>
                </div>
                <div class="action-btn-group">
                    <!-- ËÆæÁΩÆÊåâÈíÆÂ∑≤ÁßªÈô§ -->
                </div>
            </header>
            <main class="content" style="padding: 20px;">
                <!-- Profile Card (Custom Glass Style) -->
                <div class="more-profile-card custom-glass-style">
                    <div class="glass-background-layer"></div>
                    <div class="profile-content-layer">
                        <div class="more-profile-name" id="more-my-name">User Name</div>

                        <div class="avatar-quote-container">
                            <span class="quote-symbol left">‚ùù</span>
                            <div class="avatar-wrapper">
                                <img src="https://i.postimg.cc/GtbTnxhP/o-o-1.jpg" alt="My Avatar"
                                    class="more-profile-avatar" id="more-my-avatar">
                            </div>
                            <span class="quote-symbol right">‚ùû</span>
                        </div>

                        <div class="current-date-display" id="more-date-display">2025#0101</div>

                        <div class="search-bar-decoration">
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="11" cy="11" r="8"></circle>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                            </svg>
                            <span>ÊêúÁ¥¢ËÅäÂ§©ËÆ∞ÂΩï</span>
                        </div>
                    </div>
                </div>

                <!-- Placeholder for future content -->
                <div class="more-content-placeholder">
                    <div class="menu-grid">
                        <div class="menu-item" data-action="status-bar">
                            <div class="menu-icon-wrapper">
                                <svg viewBox="0 0 24 24">
                                    <rect x="2" y="4" width="20" height="16" rx="2" />
                                    <path d="M6 12h12M6 8h12M6 16h12" />
                                </svg>
                            </div>
                            <span class="menu-item-label">Áä∂ÊÄÅÊ†è</span>
                        </div>
                        <div class="menu-item" data-action="cot-settings">
                            <div class="menu-icon-wrapper">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <path
                                        d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2zm0 18a8 8 0 1 1 8-8 8 8 0 0 1-8 8z">
                                    </path>
                                    <path d="M12 6v6l4 2"></path>
                                </svg>
                            </div>
                            <span class="menu-item-label">ÊÄùÁª¥Èìæ</span>
                        </div>
                        <div class="menu-item" data-action="calendar">
                            <div class="menu-icon-wrapper">
                                <svg viewBox="0 0 24 24">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                                    <line x1="16" y1="2" x2="16" y2="6" />
                                    <line x1="8" y1="2" x2="8" y2="6" />
                                    <line x1="3" y1="10" x2="21" y2="10" />
                                </svg>
                            </div>
                            <span class="menu-item-label">Êó•ÂéÜ</span>
                        </div>
                        <div class="menu-item" data-action="star">
                            <div class="menu-icon-wrapper">
                                <svg viewBox="0 0 24 24">
                                    <polygon
                                        points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
                                </svg>
                            </div>
                            <span class="menu-item-label">Êî∂Ëóè</span>
                        </div>
                    </div>
                </div>

            </main>
        </div>

        <div id="cot-settings-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="more-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">ÊÄùÁª¥Èìæ(CoT)ËÆæÁΩÆ</h1>
                </div>
                <div class="placeholder"></div>
            </header>
            <main class="content" style="padding: 15px;">
                <div class="kkt-settings-container">
                    <!-- Tab ÂØºËà™Ê†è -->
                    <div class="settings-tabs" id="cot-settings-tabs" style="margin-bottom: 15px;">
                        <div class="settings-tab-item active" data-mode="chat">ËÅäÂ§©</div>
                        <div class="settings-tab-item" data-mode="call">ÈÄöËØù</div>
                    </div>

                    <!-- ÂÖ®Â±ÄÂºÄÂÖ≥ -->
                    <div class="kkt-group">
                        <div class="kkt-item">
                            <div class="kkt-item-label">ÂêØÁî®ÊÄùÁª¥Èìæ (CoT)</div>
                            <div class="kkt-item-control">
                                <label class="kkt-switch">
                                    <input type="checkbox" id="cot-enabled-switch">
                                    <span class="kkt-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="kkt-item">
                            <div class="kkt-item-label">ËøáÂ¢ÉÈ¢ÑËÆæÊù°ÁõÆ„ÄêÂ§çÊùÇ‰∫∫ËÆæ+Ê¥ª‰∫∫Âåñ+Ë°å‰∏∫‰∏ÄËá¥ÊÄß„Äë</div>
                            <div class="kkt-item-control">
                                <label class="kkt-switch">
                                    <input type="checkbox" id="cot-human-run-switch">
                                    <span class="kkt-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- È¢ÑËÆæÁÆ°ÁêÜ -->
                    <div class="kkt-group" style="margin-top: 15px;">
                        <div class="kkt-item" style="flex-direction: column; align-items: stretch;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div class="kkt-item-label">ÂΩìÂâçÈ¢ÑËÆæ</div>
                                <div style="display: flex; gap: 5px;">
                                    <button class="btn btn-small" id="cot-new-preset-btn">Êñ∞Âª∫</button>
                                    <button class="btn btn-small" id="cot-manage-presets-btn">ÁÆ°ÁêÜ</button>
                                    <button class="btn btn-small danger" id="cot-reset-preset-btn">ÈáçÁΩÆ</button>
                                </div>
                            </div>
                            <select id="cot-preset-select"
                                style="width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #eee; background: transparent;">
                                <!-- JS populated -->
                            </select>
                        </div>
                    </div>

                    <!-- Êù°ÁõÆÂàóË°® -->
                    <div class="kkt-group" style="margin-top: 15px; padding-bottom: 10px;">
                        <div class="kkt-item" style="border-bottom: 1px solid #f0f0f0; margin-bottom: 10px;">
                            <div class="kkt-item-label" style="font-weight: bold;">Prompt Êù°ÁõÆÂ∫èÂàó</div>
                        </div>
                        <div id="cot-items-list" style="display: flex; flex-direction: column; gap: 10px;">
                            <!-- JS populated items -->
                        </div>
                        <button class="btn btn-secondary" id="cot-add-item-btn" style="margin-top: 15px; width: 100%;">+
                            Ê∑ªÂä†Êñ∞Êù°ÁõÆ</button>
                    </div>
                </div>
            </main>
        </div>

        <!-- CoT Item Edit Modal -->
        <div id="cot-item-edit-modal" class="modal-overlay">
            <div class="modal-window">
                <h3>ÁºñËæëÊù°ÁõÆ</h3>
                <form id="cot-item-edit-form">
                    <input type="hidden" id="cot-item-id">
                    <div class="form-group">
                        <label>Êù°ÁõÆÂêçÁß∞</label>
                        <input type="text" id="cot-item-name" required>
                    </div>
                    <div class="form-group">
                        <label>Prompt ÂÜÖÂÆπ</label>
                        <textarea id="cot-item-content" rows="10" required
                            style="font-family: monospace; font-size: 13px;"></textarea>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="submit" class="btn btn-primary" style="flex: 1;">‰øùÂ≠ò</button>
                        <button type="button" id="cot-item-cancel-btn" class="btn btn-neutral"
                            style="flex: 1;">ÂèñÊ∂à</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- CoT Preset Manage Modal -->
        <div id="cot-preset-manage-modal" class="modal-overlay">
            <div class="modal-window" style="max-width: 520px;">
                <h3>È¢ÑËÆæÁÆ°ÁêÜ</h3>
                <div id="cot-preset-list-container"
                    style="max-height: 300px; overflow-y: auto; margin-bottom: 15px; border: 1px solid #eee; border-radius: 8px; padding: 10px;">
                    <!-- JS populated -->
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button id="cot-import-preset-btn" class="btn btn-secondary">ÂØºÂÖ•</button>
                    <button id="cot-close-manage-modal-btn" class="btn btn-primary">ÂÖ≥Èó≠</button>
                </div>
                <input type="file" id="cot-import-file" accept=".json" style="display: none;">
            </div>
        </div>

        <div id="status-bar-manager-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="more-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">Áä∂ÊÄÅÊ†èÁÆ°ÁêÜ</h1>
                </div>
                <div class="action-btn-group">
                    <button class="action-btn" id="import-status-preset-btn" title="ÂØºÂÖ•È¢ÑËÆæ">
                        <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3" />
                        </svg>
                    </button>
                    <button class="action-btn" id="add-status-preset-btn" title="Ê∑ªÂä†È¢ÑËÆæ">+</button>
                </div>
            </header>
            <main class="content" style="padding: 15px;">
                <div id="status-bar-preset-list" class="preset-grid">
                    <!-- JS Âä®ÊÄÅÁîüÊàê -->
                </div>
                <input type="file" id="status-preset-import-input" accept=".json" style="display: none;">
            </main>
        </div>

        <div id="status-bar-editor-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="status-bar-manager-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title" id="status-bar-editor-title">ÁºñËæëÈ¢ÑËÆæ</h1>
                </div>
                <div class="placeholder"></div>
            </header>
            <main class="content">
                <form id="status-bar-editor-form" onsubmit="event.preventDefault();">
                    <input type="hidden" id="sb-preset-id">

                    <!-- Âü∫Á°Ä‰ø°ÊÅØ -->
                    <div class="editor-section">
                        <div class="form-group">
                            <label>È¢ÑËÆæÂêçÁß∞</label>
                            <input type="text" id="sb-preset-name" placeholder="‰æãÂ¶ÇÔºöÈÄöÁî®HPÊù°" required>
                        </div>
                        <div class="form-group">
                            <label>Prompt ÂêéÁºÄ <span class="hint">(ÂëäËØâAIÂ¶Ç‰ΩïËæìÂá∫Áä∂ÊÄÅ)</span></label>
                            <textarea id="sb-preset-prompt" rows="2" placeholder="‰æãÂ¶ÇÔºöËØ∑Âú®ÂõûÂ§çÊú´Â∞æËæìÂá∫Áä∂ÊÄÅÁ†ÅÔºö[HP:xx]"></textarea>
                        </div>
                    </div>

                    <!-- Ê†∏ÂøÉÈÖçÁΩÆ‰∏éÈ¢ÑËßà -->
                    <div class="editor-section">
                        <div class="form-group">
                            <label>ÊèêÂèñÊ≠£Âàô (Regex) <span class="hint">(‰ΩøÁî® () ÊçïËé∑ÂèòÈáè)</span></label>
                            <input type="text" id="sb-preset-regex" class="code-input" placeholder="‰æãÂ¶ÇÔºö\[HP:(\d+)\]">
                        </div>
                        <div class="form-group">
                            <label>HTML Ê®°Êùø <span class="hint">(‰ΩøÁî® $1, $2 ÂºïÁî®ÂèòÈáè)</span></label>
                            <textarea id="sb-preset-html" class="code-input" rows="3"
                                placeholder='‰æãÂ¶ÇÔºö<div class="hp-bar" style="width:$1%"></div>'></textarea>
                        </div>
                    </div>

                    <!-- ÂÆûÊó∂È¢ÑËßàÂÆûÈ™åÂÆ§ -->
                    <div class="editor-section preview-lab">
                        <div class="lab-header">üß™ ÂÆûÊó∂È¢ÑËßàÂÆûÈ™åÂÆ§</div>
                        <div class="form-group">
                            <label>ÊµãËØïÊñáÊú¨ <span class="hint">(Ê®°ÊãüAIÁöÑÂõûÂ§çÂÜÖÂÆπ)</span></label>
                            <textarea id="sb-test-input" rows="2" placeholder="ËæìÂÖ•ÂåÖÂê´Áä∂ÊÄÅÁ†ÅÁöÑÊñáÊú¨Ôºå‰æãÂ¶ÇÔºöÂèóÂà∞ÊîªÂáªÔºÅ[HP:80]"></textarea>
                        </div>
                        <div class="preview-result-box">
                            <div class="preview-label">ÂåπÈÖçÁªìÊûúÔºö<span id="sb-match-status" class="status-tag">Êú™ÂåπÈÖç</span>
                            </div>
                            <div class="preview-container" id="sb-preview-container">
                                <!-- Ê∏≤ÊüìÁªìÊûú -->
                                <span style="color:#999; font-size:12px;">È¢ÑËßàÂå∫Âüü</span>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary" id="save-status-preset-btn" style="margin-top: 10px;">‰øùÂ≠òÈ¢ÑËÆæ</button>
                </form>
            </main>
        </div>

        <div id="my-profile-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="contacts-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">ÊàëÁöÑÊ°£Ê°à</h1>
                </div>
                <div class="action-btn-group">
                    <!-- ‰øùÂ≠òÊåâÈíÆÁßªÂà∞Â∫ïÈÉ®ÊÇ¨ÊµÆÊ†èÔºåÈ°∂ÈÉ®ÁïôÁ©∫ÊàñÊîæÂÖ∂‰ªñÂäüËÉΩ -->
                </div>
            </header>
            <main class="content" style="padding: 0; display: flex; flex-direction: column;">
                <!-- ËÉåÊôØÊ®°Á≥äÂ±Ç -->
                <div id="mp-bg-blur" class="mp-bg-blur"></div>

                <!-- È°∂ÈÉ®Â§¥ÂÉèËΩÆÊí≠ -->
                <div class="mp-carousel-container">
                    <div class="mp-carousel" id="mp-carousel">
                        <!-- JS Âä®ÊÄÅÁîüÊàêÂ§¥ÂÉèÂç°Áâá -->
                    </div>
                    <div class="mp-carousel-indicators" id="mp-carousel-indicators"></div>
                </div>

                <!-- ‰ø°ÊÅØÁºñËæëÂå∫ -->
                <div class="mp-info-container">
                    <div class="mp-info-header">
                        <span class="mp-section-title">Âü∫Á°ÄÊ°£Ê°à</span>
                        <div style="display: flex; gap: 5px; align-items: center;">
                            <button class="icon-btn-simple" id="mp-set-active-btn" title="ËÆæ‰∏∫Â±ïÁ§∫ÂêçÁâá">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polygon
                                        points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2">
                                    </polygon>
                                </svg>
                            </button>
                            <button class="icon-btn-simple danger" id="mp-delete-persona-btn" title="Âà†Èô§ÂΩìÂâç‰∫∫ËÆæ">
                                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path
                                        d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                    </path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="mp-input-group">
                        <input type="text" id="mp-name-input" class="mp-transparent-input title-input"
                            placeholder="ËæìÂÖ•ÊòµÁß∞">
                    </div>

                    <div class="mp-input-group">
                        <textarea id="mp-persona-input" class="mp-transparent-input" rows="4"
                            placeholder="Âú®Ê≠§ËæìÂÖ•ÈÄöÁî®‰∫∫ËÆæ/Áä∂ÊÄÅÊèèËø∞..."></textarea>
                    </div>

                    <div class="mp-divider"></div>

                    <div class="mp-section-title" style="margin-bottom: 10px;">Â∑≤ÁªëÂÆöËßíËâ≤ (‰∏ìÂ±ûËÆæÂÆö)</div>
                    <div class="mp-tags-container" id="mp-tags-container">
                        <!-- JS ÁîüÊàê Tag -->
                        <button class="mp-tag-add" id="mp-add-binding-btn">+ Ê∑ªÂä†</button>
                    </div>
                </div>

                <!-- Â∫ïÈÉ®‰øùÂ≠òÊ†è -->
                <div class="mp-bottom-bar">
                    <button class="btn btn-primary mp-save-btn" id="mp-save-btn">‰øùÂ≠òÂπ∂ÂêåÊ≠•ÂΩìÂâç‰∫∫ËÆæ</button>
                </div>
            </main>

            <!-- ‰∏ìÂ±ûËÆæÂÆö‰æßÊªëÊùø -->
            <div id="mp-exclusive-sheet" class="action-sheet-overlay" style="align-items: flex-end;">
                <div class="action-sheet-content mp-exclusive-panel">
                    <div class="mp-panel-header">
                        <div class="mp-panel-char-info">
                            <img src="" id="mp-panel-char-avatar" class="mp-panel-avatar">
                            <span id="mp-panel-char-name">ËßíËâ≤Âêç</span>
                        </div>
                        <button class="icon-btn-simple" id="mp-panel-close-btn">√ó</button>
                    </div>
                    <div class="mp-panel-body">
                        <label class="mp-label">‰∏ìÂ±ûËÆæÂÆö (ÈôÑÂä†Âú®ÈÄöÁî®ËÆæÂÆö‰πãÂêé)</label>
                        <textarea id="mp-panel-input" rows="4" placeholder="‰æãÂ¶ÇÔºöÊòØTaÁöÑÂßêÂßêÔºåÊÄßÊ†ºË¶ÅÊõ¥Ê∏©Êüî..."></textarea>

                        <div class="mp-panel-option">
                            <label class="kkt-switch">
                                <input type="checkbox" id="mp-panel-override-check">
                                <span class="kkt-slider"></span>
                            </label>
                            <span>ÂÆåÂÖ®Ë¶ÜÁõñÈÄöÁî®ËÆæÂÆö (‰∏çÊãºÊé•)</span>
                        </div>
                    </div>
                    <div class="mp-panel-footer">
                        <button class="btn btn-danger btn-small" id="mp-panel-unbind-btn">Ëß£Èô§ÁªëÂÆö</button>
                        <button class="btn btn-primary" id="mp-panel-confirm-btn">Á°ÆËÆ§‰øÆÊîπ</button>
                    </div>
                </div>
            </div>

            <!-- ËßíËâ≤ÈÄâÊã©Ê®°ÊÄÅÊ°Ü -->
            <div id="mp-char-select-modal" class="modal-overlay">
                <div class="modal-window">
                    <h3>ÈÄâÊã©Ë¶ÅÁªëÂÆöÁöÑËßíËâ≤</h3>
                    <div id="mp-char-select-list" class="mp-select-list">
                        <!-- JS ÁîüÊàê -->
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button class="btn btn-primary" id="mp-char-select-confirm" style="flex:1;">Á°ÆÂÆö</button>
                        <button class="btn btn-neutral" id="mp-char-select-cancel" style="flex:1;">ÂèñÊ∂à</button>
                    </div>
                </div>
            </div>

            <!-- Â§¥ÂÉè‰∏ä‰º† Input -->
            <input type="file" id="mp-carousel-avatar-upload" accept="image/*" style="display:none;">
        </div>
        <div id="tutorial-screen" class="screen">
            <header class="app-header"><button class="back-btn" data-target="home-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">ÊïôÁ®ã</h1>
                </div>
                <div class="placeholder"></div>
            </header>
            <main class="content" id="tutorial-content-area"></main>
        </div>
        <div id="toast-notification" class="toast">
            <img class="toast-avatar" src="" alt="avatar">
            <div class="toast-content">
                <div class="toast-name"></div>
                <div class="toast-message"></div>
            </div>
        </div>
        <input type="file" id="image-upload-input" accept="image/*" style="display:none;">

        <!-- Profile Card Modal -->
        <div id="profile-card-modal" class="modal-overlay">
            <div class="modal-window">
                <div class="pc-header">
                    <img src="" class="pc-avatar" id="pc-avatar">
                </div>
                <div class="pc-content">
                    <div class="pc-name" id="pc-name">Character Name</div>
                    <div class="pc-remark" id="pc-remark">@RemarkName</div>

                    <div class="pc-stats-grid">
                        <div class="pc-stat-item">
                            <span class="pc-stat-value" id="pc-stat-msg-count">0</span>
                            <span class="pc-stat-label">Ê∂àÊÅØ</span>
                        </div>
                        <div class="pc-stat-item pc-stat-token-wrap" id="pc-stat-token-click" title="ÁÇπÂáªÊü•Áúã Token ÂàÜÂ∏É">
                            <span class="pc-stat-value" id="pc-stat-memory">0</span>
                            <span class="pc-stat-label">Token</span>
                        </div>
                        <div class="pc-stat-item">
                            <span class="pc-stat-value" id="pc-stat-last-chat">-</span>
                            <span class="pc-stat-label">ÊúÄËøë</span>
                        </div>
                    </div>

                    <div class="pc-persona-box">
                        <span class="pc-persona-label">‰∫∫ËÆæÊ°£Ê°à</span>
                        <span id="pc-persona-text">...</span>
                    </div>

                    <div class="pc-actions">
                        <button class="pc-btn-primary" id="pc-message-btn">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                                <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"></path>
                            </svg>
                            ÂèëÊ∂àÊÅØ
                        </button>
                        <!-- È¢ÑÁïôÊõ¥Â§öÊìç‰ΩúÊåâÈíÆ -->
                        <button class="pc-btn-secondary" id="pc-settings-btn" title="ËÆæÁΩÆ">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path
                                    d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                                </path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Token ÂàÜÂ∏ÉÂºπÁ™óÔºàÁÇπÂáªËßíËâ≤ËµÑÊñôÂç° Token ÊâìÂºÄÔºâ -->
        <div id="token-distribution-modal" class="modal-overlay">
            <div class="modal-window token-distribution-window">
                <h3 class="token-distribution-title">Token ÂàÜÂ∏É</h3>
                <div id="token-chart-container"></div>
                <div class="token-total-row">
                    <span class="token-total-label">ÂêàËÆ°</span>
                    <strong id="token-distribution-total" class="token-total-value">0</strong>
                    <span class="token-total-unit">Token</span>
                </div>
                <div class="token-details-list" id="token-details-list"></div>
                <div class="token-detail-desc" id="token-detail-desc"></div>
                <button type="button" class="btn btn-neutral token-distribution-close" id="token-distribution-close-btn">ÂÖ≥Èó≠</button>
            </div>
        </div>

        <!-- Capture Result Modal -->
        <div id="capture-result-modal" class="modal-overlay">
            <div class="modal-window" style="max-width: 90%; width: 400px;">
                <h3>Êà™ÂõæÁîüÊàêÊàêÂäü</h3>
                <div id="capture-preview-container"
                    style="max-height: 60vh; overflow-y: auto; margin: 15px 0; border: 1px solid #eee; border-radius: 8px; display: flex; justify-content: center; background: #f9f9f9;">
                    <!-- Image will be injected here -->
                </div>
                <p style="font-size: 12px; color: #999; text-align: center; margin-bottom: 15px;">ÈïøÊåâÂõæÁâáÂèØ‰øùÂ≠òÂà∞ÊâãÊú∫</p>
                <div style="display: flex; gap: 10px;">
                    <button id="download-capture-btn" class="btn btn-secondary" style="flex: 1;">‰∏ãËΩΩÂõæÁâá</button>
                    <button id="close-capture-modal-btn" class="btn btn-primary" style="flex: 1;">ÂÖ≥Èó≠</button>
                </div>
            </div>
        </div>

        <!-- Message Edit Modal -->
        <div id="message-edit-modal" class="modal-overlay">
            <div class="modal-window">
                <h3>ÁºñËæëÊ∂àÊÅØ</h3>
                <form id="message-edit-form">
                    <div class="form-group">
                        <textarea id="message-edit-textarea" rows="6" required></textarea>
                    </div>
                    <!-- Êñ∞Â¢ûÔºöÊó∂Èó¥Êà≥ÁºñËæëËæìÂÖ•Ê°ÜÔºåÈªòËÆ§ÈöêËóè -->
                    <div class="form-group" id="message-edit-timestamp-group" style="display: none; margin-top: 10px;">
                        <label for="message-edit-timestamp" style="font-size: 12px; color: #666;">Ê∂àÊÅØÊó∂Èó¥
                            (‰øÆÊîπÂèØËÉΩÂΩ±ÂìçÊéíÂ∫è)</label>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="datetime-local" id="message-edit-timestamp" step="1" style="flex: 1;">
                            <button type="button" id="hide-timestamp-btn" class="btn btn-neutral"
                                style="padding: 8px 12px; font-size: 12px; white-space: nowrap; display: none;"
                                title="Â∞ÜÊó∂Èó¥ËÆæÁΩÆ‰∏∫‰∏ä‰∏ÄÊù°Ê∂àÊÅØ+1ÂàÜÈíü">ÈöêËóèÊó∂Èó¥Êà≥</button>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <!-- Êñ∞Â¢ûÁöÑÂà†Èô§ÊåâÈíÆÔºåÈªòËÆ§ÈöêËóè -->
                        <button type="button" id="debug-delete-msg-btn" class="btn btn-danger"
                            style="flex: 1; display: none;">Âà†Èô§</button>
                        <button type="submit" class="btn btn-primary" style="flex: 1;">‰øùÂ≠ò</button>
                        <button type="button" id="cancel-edit-modal-btn" class="btn btn-neutral"
                            style="flex: 1;">ÂèñÊ∂à</button>
                    </div>

                </form>
            </div>
        </div>

        <div id="add-char-modal" class="modal-overlay">
            <div class="modal-window">
                <h3>ÂàõÂª∫Êñ∞ËßíËâ≤</h3>
                <form id="add-char-form">
                    <div class="form-group">
                        <label for="char-real-name">ËßíËâ≤ÂßìÂêç</label><input type="text" id="char-real-name"
                            placeholder="ËßíËâ≤ÁöÑÁúüÂÆûÂßìÂêç" required>
                    </div>
                    <div class="form-group">
                        <label for="char-remark-name">ËßíËâ≤Â§áÊ≥® (ÊòµÁß∞)</label><input type="text" id="char-remark-name"
                            placeholder="‰Ω†ÂØπTaÁöÑÁß∞Âëº" required>
                    </div>
                    <div class="form-group">
                        <label for="my-name-for-char">ÊàëÁöÑÂßìÂêç</label><input type="text" id="my-name-for-char"
                            placeholder="‰Ω†Â∏åÊúõTaÂ¶Ç‰ΩïÁß∞Âëº‰Ω†" required>
                    </div>
                    <div class="form-group" id="char-persona-group" style="display:none;">
                        <label for="char-persona-input">ËßíËâ≤ÊèèËø∞</label>
                        <div id="char-persona-import-hint"
                            style="display:none; background:#f0f8ff; border:1px solid #b8d9f5; border-radius:8px; padding:8px 12px; margin-bottom:8px; font-size:12px; color:#4a7fa5;">
                            üìÑ Â∑≤‰ªéÊñáÊ°£ÂØºÂÖ•ÂÜÖÂÆπÔºåÂèØÂú®Ê≠§ÁºñËæëÂêéÁÇπÂáªÂàõÂª∫
                        </div>
                        <textarea id="char-persona-input" rows="3" placeholder="ËßíËâ≤ÊèèËø∞ÂÜÖÂÆπ..."
                            style="width:100%; max-height:140px; overflow-y:auto; border:1px solid #eee; border-radius:8px; padding:8px; box-sizing:border-box; font-family:inherit; font-size:14px; resize:vertical;"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">ÂàõÂª∫</button>
                </form>
            </div>
        </div>

        <!-- Import Confirm Modal -->
        <div id="import-confirm-modal" class="modal-overlay">
            <div class="modal-window">
                <h3>Á°ÆËÆ§ËßíËâ≤‰ø°ÊÅØ</h3>
                <form id="import-confirm-form">
                    <div class="form-group">
                        <label for="import-char-name">ËßíËâ≤ÁúüÂêç (Real Name)</label>
                        <input type="text" id="import-char-name" required>
                        <p style="font-size: 12px; color: #888; margin-top: 5px;">ËøôÊòØÁ≥ªÁªüËØÜÂà´ËßíËâ≤ÁöÑÂîØ‰∏ÄÊ†áËØÜÔºåÂàõÂª∫Âêé‰∏çÂèØ‰øÆÊîπÔºåËØ∑Ë∞®ÊÖéÁ°ÆËÆ§„ÄÇ</p>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="submit" class="btn btn-primary" style="flex: 1;">Á°ÆËÆ§ÂØºÂÖ•</button>
                        <button type="button" id="cancel-import-btn" class="btn btn-neutral"
                            style="flex: 1;">ÂèñÊ∂à</button>
                    </div>
                </form>
            </div>
        </div>
        <!-- Create Character Method Selection Action Sheet -->
        <div id="create-char-method-sheet" class="action-sheet-overlay">
            <div class="action-sheet">
                <div class="action-sheet-title">ÂàõÂª∫Êñ∞ËßíËâ≤</div>
                <button class="action-sheet-button" id="method-manual-btn">ÊâãÂä®ÂàõÂª∫</button>
                <button class="action-sheet-button" id="method-import-doc-btn">ÂØºÂÖ•ÊñáÊ°£</button>
                <button class="action-sheet-button danger" id="method-cancel-btn">ÂèñÊ∂à</button>
            </div>
        </div>

        <!-- Document Import - File Selection Modal -->
        <div id="doc-import-select-modal" class="modal-overlay">
            <div class="modal-window" style="max-width: 95%; width: 420px;">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                    <h3 style="margin: 0;">ÈÄâÊã©ÂØºÂÖ•Êñá‰ª∂</h3>
                    <button id="doc-import-close-btn"
                        style="background:none; border:none; font-size:20px; cursor:pointer; color:#999;">√ó</button>
                </div>
                <p style="font-size:13px; color:#888; margin-bottom:15px;">ÊîØÊåÅ TXT„ÄÅDOCX„ÄÅZIPÔºàZIPÂÜÖ‰ªÖËß£ÊûêTXT/DOCXÔºâ</p>
                <div id="doc-import-drop-zone"
                    style="border: 2px dashed #ddd; border-radius: 12px; padding: 30px; text-align: center; cursor: pointer; transition: all 0.2s; margin-bottom: 15px;">
                    <div style="font-size: 36px; margin-bottom: 8px;">üìÇ</div>
                    <div style="color: #666; font-size: 14px;">ÁÇπÂáªÈÄâÊã©Êñá‰ª∂ Êàñ ÊãñÊãΩÂà∞Ê≠§Â§Ñ</div>
                    <div style="color: #bbb; font-size: 12px; margin-top: 5px;">ÊîØÊåÅÂ§öÈÄâÔºåÂèØÊ∑∑ÂêàÊ†ºÂºè</div>
                </div>
                <input type="file" id="doc-import-file-input" multiple accept=".txt,.docx,.zip" style="display:none;">
                <div id="doc-import-file-list" style="max-height: 200px; overflow-y: auto; margin-bottom: 15px;"></div>
                <div style="display:flex; gap:10px;">
                    <button id="doc-import-start-btn" class="btn btn-primary" style="flex:1;" disabled>ÂºÄÂßãËß£Êûê</button>
                    <button id="doc-import-cancel-btn" class="btn btn-neutral" style="flex:1;">ÂèñÊ∂à</button>
                </div>
            </div>
        </div>

        <!-- Document Import - Parse Preview Modal (single file preview) -->
        <div id="doc-preview-modal" class="modal-overlay">
            <div class="modal-window" style="max-width: 95%; width: 450px;">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                    <div style="font-size: 20px;">üìÑ</div>
                    <div>
                        <div style="font-weight: 600; font-size: 15px;" id="doc-preview-filename">Êñá‰ª∂Âêç</div>
                        <div style="font-size: 12px; color: #888;" id="doc-preview-progress">Á¨¨ 1 / 1 ‰∏™</div>
                    </div>
                </div>
                <label
                    style="font-size: 13px; color: #666; margin-bottom: 6px; display: block;">Ëß£ÊûêÂÜÖÂÆπÈ¢ÑËßàÔºàÂ∞ÜËá™Âä®Â°´ÂÖ•ËßíËâ≤ÊèèËø∞Ôºâ</label>
                <textarea id="doc-preview-content" rows="10"
                    style="width:100%; border:1px solid #eee; border-radius:8px; padding:10px; font-size:13px; resize:vertical; box-sizing:border-box; font-family: inherit;"></textarea>
                <div style="display:flex; gap:8px; margin-top:15px;">
                    <button id="doc-preview-confirm-btn" class="btn btn-primary" style="flex:2;">‚úì Á°ÆÂÆöÔºåËøõÂÖ•ÂàõÂª∫</button>
                    <button id="doc-preview-skip-btn" class="btn btn-neutral" style="flex:1;">Ë∑≥Ëøá</button>
                    <button id="doc-preview-cancel-btn" class="btn btn-danger" style="flex:1;">ÂèñÊ∂àÂÖ®ÈÉ®</button>
                </div>
            </div>
        </div>

        <!-- Add Character Modal with Persona prefill support -->
        <div id="add-sticker-modal" class="modal-overlay">
            <div class="modal-window">
                <h3 id="add-sticker-modal-title">Ê∑ªÂä†Êñ∞Ë°®ÊÉÖ</h3>
                <form id="add-sticker-form"><input type="hidden" id="sticker-edit-id">
                    <div id="sticker-preview"><span>È¢ÑËßà</span></div>
                    <div class="form-group"><label for="sticker-name">Ë°®ÊÉÖÂêçÁß∞</label><input type="text" id="sticker-name"
                            placeholder="Â¶ÇÔºöÂºÄÂøÉ" required></div>
                    <div class="form-group"><label for="sticker-group">ÂàÜÁªÑÂêçÁß∞</label><input type="text" id="sticker-group"
                            placeholder="Â¶ÇÔºöÁå´Áå´ÁªÑ (ÈÄâÂ°´)"></div>


                    <div class="form-group"><label for="sticker-url-input">Ë°®ÊÉÖURL</label><input type="url"
                            id="sticker-url-input" placeholder="Á≤òË¥¥ÂõæÁâáURL">
                    </div>
                    <p style="text-align:center; color:#888; margin: -10px 0 15px;">Êàñ</p><input type="file"
                        id="sticker-file-upload" accept="image/*" style="display:none;"><label for="sticker-file-upload"
                        class="btn btn-secondary" style="width:100%; margin-bottom: 20px;">‰ªéÊú¨Âú∞‰∏ä‰º†</label>
                    <button type="submit" class="btn btn-primary">‰øùÂ≠ò</button>
                </form>
            </div>
        </div>
        <div id="sticker-actionsheet" class="action-sheet-overlay">
            <div class="action-sheet">
                <button class="action-sheet-button" id="edit-sticker-btn">ÁºñËæë</button>
                <button class="action-sheet-button danger" id="delete-sticker-btn">Âà†Èô§</button>
            </div>
        </div>
        <!-- Batch Add Sticker Modal -->
        <div id="batch-add-sticker-modal" class="modal-overlay">
            <div class="modal-window">
                <h3>ÊâπÈáèÂØºÂÖ•Ë°®ÊÉÖ</h3>
                <form id="batch-add-sticker-form">
                    <div class="form-group">
                        <label for="batch-sticker-group">ÂàÜÁªÑÂêçÁß∞ (Êú¨ÊâπÊ¨°ÊâÄÊúâË°®ÊÉÖÂ∞ÜÂΩíÂÖ•Ê≠§ÁªÑ)</label>
                        <input type="text" id="batch-sticker-group" placeholder="Â¶ÇÔºöÈÄöÁî®ÁªÑ">
                    </div>
                    <div class="form-group">
                        <label for="sticker-urls-textarea">Êï∞ÊçÆÊ†ºÂºèÔºöÂêçÁß∞:URLÔºàÊîØÊåÅÂÆΩÊ≥õÊ†ºÂºèÔºåÂ¶Ç ÂêçÁß∞ÔºöURL„ÄÅÂêçÁß∞ URL„ÄÅÂêçÁß∞URL Á≠âÔºâ</label>
                        <textarea id="sticker-urls-textarea" rows="8"
                            placeholder="‰æãÂ¶ÇÔºö&#10;ÂºÄÂøÉ:https://example.com/happy.gif&#10;Âì≠Ê≥£:https://example.com/cry.png"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">ÂºÄÂßãÂØºÂÖ•</button>
                    <p style="text-align:center; color:#888; margin: 12px 0 0;">Êàñ</p>
                    <button type="button" id="sticker-doc-import-open-btn" class="btn btn-secondary" style="width:100%; margin-top:8px;">‰ªéÊñáÊ°£ÂØºÂÖ• (TXT / DOCX / ZIP)</button>
                </form>
            </div>
        </div>
        <!-- Sticker Doc Import: file select -->
        <div id="sticker-doc-import-modal" class="modal-overlay">
            <div class="modal-window" style="max-width: 95%; width: 420px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <h3 style="margin: 0;">ÂØºÂÖ•ÊñáÊ°£Ë°®ÊÉÖÂåÖ</h3>
                    <button id="sticker-doc-import-close-btn"
                        style="background:none; border:none; font-size:20px; cursor:pointer; color:#999;">√ó</button>
                </div>
                <p style="font-size:13px; color:#888; margin-bottom:15px;">ÊîØÊåÅ TXT„ÄÅDOCX„ÄÅZIPÔºàZIP ÂÜÖ‰ªÖËß£Êûê TXT/DOCXÔºâÔºåÊØèË°å‰∏ÄÊù°ÔºöÂêçÁß∞+URLÔºåÊ†ºÂºèÂÆΩÊ≥õ</p>
                <div id="sticker-doc-import-drop-zone"
                    style="border: 2px dashed #ddd; border-radius: 12px; padding: 24px; text-align: center; cursor: pointer; transition: all 0.2s; margin-bottom: 15px;">
                    <div style="font-size: 32px; margin-bottom: 6px;">üìÇ</div>
                    <div style="color: #666; font-size: 14px;">ÁÇπÂáªÈÄâÊã©Êñá‰ª∂ Êàñ ÊãñÊãΩÂà∞Ê≠§Â§Ñ</div>
                    <div style="color: #bbb; font-size: 12px; margin-top: 4px;">ÊîØÊåÅÂ§öÈÄâÔºåÂèØÊ∑∑ÂêàÊ†ºÂºè</div>
                </div>
                <input type="file" id="sticker-doc-import-file-input" multiple accept=".txt,.docx,.zip" style="display:none;">
                <div id="sticker-doc-import-file-list" style="max-height: 180px; overflow-y: auto; margin-bottom: 15px;"></div>
                <div style="display:flex; gap:10px;">
                    <button id="sticker-doc-import-start-btn" class="btn btn-primary" style="flex:1;" disabled>ÂºÄÂßãËß£Êûê</button>
                    <button id="sticker-doc-import-cancel-btn" class="btn btn-neutral" style="flex:1;">ÂèñÊ∂à</button>
                </div>
            </div>
        </div>
        <!-- Sticker Doc Import: parse result preview -->
        <div id="sticker-doc-preview-modal" class="modal-overlay">
            <div class="modal-window" style="max-width: 95%; width: 480px; max-height: 85vh; display: flex; flex-direction: column;">
                <h3 style="margin: 0 0 10px 0;">Ëß£ÊûêÁªìÊûúÈ¢ÑËßà</h3>
                <div class="form-group" style="margin-bottom: 10px;">
                    <label for="sticker-doc-preview-group">ÂàÜÁªÑÂêçÁß∞ÔºàÊú¨ÊâπÊ¨°ÂΩíÂÖ•Ê≠§ÁªÑÔºâ</label>
                    <input type="text" id="sticker-doc-preview-group" placeholder="Â¶ÇÔºöÈÄöÁî®ÁªÑ">
                </div>
                <div style="font-size: 12px; color: #888; margin-bottom: 8px;">ÂÖ± <span id="sticker-doc-preview-count">0</span> Êù°ÔºåÁ°ÆËÆ§ÂêéÂ∞ÜÂä†ÂÖ•Ë°®ÊÉÖÂåÖ</div>
                <div id="sticker-doc-preview-list" style="flex:1; overflow-y: auto; max-height: 320px; border: 1px solid #eee; border-radius: 8px; padding: 8px; background: #fafafa;"></div>
                <div style="display:flex; gap:8px; margin-top: 15px;">
                    <button id="sticker-doc-preview-confirm-btn" class="btn btn-primary" style="flex:2;">Á°ÆËÆ§ÂØºÂÖ•</button>
                    <button id="sticker-doc-preview-cancel-btn" class="btn btn-neutral" style="flex:1;">ÂèñÊ∂à</button>
                </div>
            </div>
        </div>
        <div id="send-voice-modal" class="modal-overlay">
            <div class="modal-window">
                <h3>ÂèëÈÄÅËØ≠Èü≥Ê∂àÊÅØ</h3>
                <form id="send-voice-form">
                    <div class="form-group">
                        <label for="voice-text-input">ËæìÂÖ•ËØ≠Èü≥ÊñáÂ≠ó</label>
                        <textarea id="voice-text-input" placeholder="Âú®ËøôÈáåËæìÂÖ•‰Ω†ÊÉ≥ËØ¥ÁöÑËØù..." required rows="4"></textarea>
                    </div>
                    <div class="form-group" style="text-align:center; color:#888; font-size: 14px;">
                        È¢ÑËÆ°Êó∂Èïø: <span id="voice-duration-preview">0"</span>
                    </div>
                    <button type="submit" class="btn btn-primary">ÂèëÈÄÅ</button>
                </form>
            </div>
        </div>
        <div id="send-pv-modal" class="modal-overlay">
            <div class="modal-window">
                <h3>ÂàÜ‰∫´ÁÖßÁâá/ËßÜÈ¢ë</h3>
                <form id="send-pv-form">
                    <div class="form-group">
                        <label for="pv-text-input">ËæìÂÖ•ÊèèËø∞</label>
                        <textarea id="pv-text-input" placeholder="Âú®ËøôÈáåÊèèËø∞‰Ω†ÁöÑÁÖßÁâáÊàñËßÜÈ¢ëÂÜÖÂÆπ..." required rows="4"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">ÂèëÈÄÅ</button>
                </form>
            </div>
        </div>
        <div id="send-transfer-modal" class="modal-overlay">
            <div class="modal-window">
                <h3>ËΩ¨Ë¥¶</h3>
                <form id="send-transfer-form">
                    <div class="form-group">
                        <label for="transfer-amount-input">ÈáëÈ¢ù (ÂÖÉ)</label>
                        <input type="number" id="transfer-amount-input" placeholder="0.00" required step="0.01"
                            min="0.01">
                    </div>
                    <div class="form-group">
                        <label for="transfer-remark-input">Â§áÊ≥®</label>
                        <input type="text" id="transfer-remark-input" placeholder="ÔºàÈÄâÂ°´Ôºâ">
                    </div>
                    <button type="submit" class="btn btn-primary">ÂèëÈÄÅ</button>
                </form>
            </div>
        </div>
        <div id="send-gift-modal" class="modal-overlay">
            <div class="modal-window">
                <h3>ÈÄÅÂá∫Á§ºÁâ©</h3>
                <form id="send-gift-form">
                    <div class="form-group">
                        <label for="gift-description-input">Á§ºÁâ©ÊèèËø∞</label>
                        <textarea id="gift-description-input" placeholder="ÂëäËØâTa‰Ω†ÈÄÅ‰∫Ü‰ªÄ‰πàÁâπÂà´ÁöÑ‰∏úË•ø..." required
                            rows="4"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">ÂèëÈÄÅ</button>
                </form>
            </div>
        </div>
        <!-- NEW: Time Skip Modal -->
        <div id="time-skip-modal" class="modal-overlay">
            <div class="modal-window">
                <h3>ËÆ∞ÂΩï‰ªäÂ§©ÂèëÁîüÁöÑ‰∫ã</h3>
                <form id="time-skip-form">
                    <div class="form-group">
                        <label for="time-skip-input">‰∫ã‰ª∂ÊèèËø∞ (ËØ•Ê∂àÊÅØAIÂèØËßÅÔºå‰ºö‰Ωú‰∏∫‰∏ä‰∏ãÊñá)</label>
                        <textarea id="time-skip-input" placeholder="‰æãÂ¶ÇÔºöÊàë‰ª¨‰∏ÄËµ∑ÂéªÂ±±È°∂Áúã‰∫ÜÊó•ËêΩÔºåÁÑ∂ÂêéÂêÉ‰∫ÜÁÉßÁÉ§„ÄÇ" required
                            rows="4"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">ÂèëÈÄÅ</button>
                </form>
            </div>
        </div>
        <!-- NEW: Group Recipient Selection Modal -->
        <div id="group-recipient-selection-modal" class="modal-overlay">
            <div class="modal-window">
                <h3 id="group-recipient-selection-title">ÈÄâÊã©Êî∂‰ª∂‰∫∫</h3>
                <ul id="group-recipient-selection-list"></ul>
                <button class="btn btn-primary" id="confirm-group-recipient-btn" style="margin-top: 20px;">Á°ÆËÆ§</button>
            </div>
        </div>

        <!-- Folder Management Modal -->
        <div id="folder-manage-modal" class="modal-overlay">
            <div class="modal-window">
                <h3 id="folder-modal-title">Êñ∞Âª∫Êñá‰ª∂Â§π</h3>
                <div class="form-group">
                    <input type="text" id="folder-name-input" placeholder="ËØ∑ËæìÂÖ•Êñá‰ª∂Â§πÂêçÁß∞" required>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button id="folder-confirm-btn" class="btn btn-primary" style="flex: 1;">Á°ÆËÆ§</button>
                    <button id="folder-delete-btn" class="btn btn-danger" style="flex: 1; display: none;">Âà†Èô§</button>
                    <button id="folder-cancel-btn" class="btn btn-neutral" style="flex: 1;">ÂèñÊ∂à</button>
                </div>
            </div>
        </div>

        <!-- Move Chat to Folder Modal -->
        <div id="move-to-folder-modal" class="modal-overlay">
            <div class="modal-window">
                <h3>ÁßªÂä®Âà∞Êñá‰ª∂Â§π</h3>
                <ul id="folder-selection-list" class="list-container"
                    style="max-height: 40vh; overflow-y: auto; padding: 0; margin: 15px 0;">
                    <!-- JS populated -->
                </ul>
                <button id="close-move-folder-modal" class="btn btn-neutral" style="margin-top: 10px;">ÂèñÊ∂à</button>
            </div>
        </div>
        <div id="receive-transfer-actionsheet" class="action-sheet-overlay">
            <div class="action-sheet">
                <button class="action-sheet-button" id="accept-transfer-btn">Êé•Êî∂</button>
                <button class="action-sheet-button danger" id="return-transfer-btn">ÈÄÄÂõû</button>
            </div>
        </div>
        <!-- Private Chat Settings (KKT Style) -->
        <div id="chat-settings-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="chat-room-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">ËÅäÂ§©ËÆæÁΩÆ</h1>
                </div>
                <div class="placeholder"></div>
            </header>
            <main class="content">
                <div class="kkt-settings-container">
                    <!-- ‰∏™‰∫∫ËµÑÊñôÈÉ®ÂàÜ -->
                    <div class="kkt-profile-section">
                        <img src="" alt="Avatar" id="setting-char-avatar-preview" class="kkt-profile-avatar"
                            onclick="document.getElementById('setting-char-avatar-upload').click()">
                        <div class="kkt-profile-name" id="setting-char-name-display"></div>
                        <!-- ÈöêËóèÁöÑÊñá‰ª∂‰∏ä‰º†input -->
                        <input type="file" id="setting-char-avatar-upload" accept="image/*" style="display:none;">
                    </div>

                    <!-- Tab ÂØºËà™Ê†è -->
                    <div class="settings-tabs">
                        <div class="settings-tab-item active" data-tab="setting-tab-basic">ËÆæÂÆö</div>
                        <div class="settings-tab-item" data-tab="setting-tab-func">ÂäüËÉΩ</div>
                        <div class="settings-tab-item" data-tab="setting-tab-style">ÁæéÂåñ</div>
                        <div class="settings-tab-item" data-tab="setting-tab-ext">ÊãìÂ±ï</div>
                    </div>

                    <form id="chat-settings-form">

                        <!-- „ÄêËÆæÂÆö„ÄëTab ÂÜÖÂÆπ -->
                        <div id="setting-tab-basic" class="settings-tab-content active">
                            <!-- ËßíËâ≤‰ø°ÊÅØÂàÜÁªÑ -->
                            <div class="kkt-group">
                                <div class="kkt-item">
                                    <div class="kkt-item-label">Â§áÊ≥®Âêç</div>
                                    <div class="kkt-item-control">
                                        <input type="text" id="setting-char-remark" autocomplete="off"
                                            style="text-align:right; border:none; background:transparent;"
                                            placeholder="ÁÇπÂáª‰øÆÊîπ">
                                    </div>
                                </div>
                                <div class="kkt-item" style="flex-direction:column; align-items:flex-start;">
                                    <div class="kkt-item-label" style="margin-bottom:8px;">ËßíËâ≤‰∫∫ËÆæ</div>
                                    <textarea id="setting-char-persona"
                                        style="width:100%; border:1px solid #eee; border-radius:8px; padding:8px; min-height:80px;"
                                        placeholder="ËØ¶ÁªÜÊèèËø∞ËßíËâ≤ÁöÑÊÄßÊ†º..."></textarea>
                                </div>
                                <!-- Ë°®ÊÉÖÂåÖÂàÜÁªÑ -->
                                <div class="kkt-item" style="flex-direction:column; align-items:flex-start;">
                                    <div class="kkt-item-label" style="margin-bottom:8px;">ÂèØÁî®Ë°®ÊÉÖÂåÖÂàÜÁªÑ</div>
                                    <div id="setting-char-sticker-groups-container"
                                        style="width:100%; max-height: 120px; overflow-y: auto; border: 1px solid #eee; padding: 10px; border-radius: 8px;">
                                        <!-- JS populate -->
                                    </div>
                                </div>
                            </div>

                            <!-- ÂÖ≥ËÅî‰∏ñÁïå‰π¶ (ÁßªÂà∞ÊàëÁöÑ‰ø°ÊÅØÂâç) -->
                            <div class="kkt-group" style="margin-top:15px;">
                                <div class="kkt-item">
                                    <div class="kkt-item-label">ÂÖ≥ËÅî‰∏ñÁïå‰π¶</div>
                                    <div class="kkt-item-control">
                                        <button type="button" id="link-world-book-btn"
                                            class="btn btn-small btn-secondary"
                                            style="margin: 0; padding: 4px 8px;">ËÆæÁΩÆ</button>
                                    </div>
                                </div>
                            </div>

                            <!-- ÊàëÁöÑ‰ø°ÊÅØÂàÜÁªÑ -->
                            <div class="kkt-group" style="margin-top:15px;">
                                <div class="kkt-item">
                                    <div class="kkt-item-label">ÊàëÁöÑÂ§¥ÂÉè</div>
                                    <div class="kkt-item-control"
                                        onclick="document.getElementById('setting-my-avatar-upload').click()">
                                        <img src="" id="setting-my-avatar-preview" class="kkt-small-avatar">
                                        <span class="kkt-arrow">‚Ä∫</span>
                                    </div>
                                    <input type="file" id="setting-my-avatar-upload" accept="image/*"
                                        style="display:none;">
                                </div>
                                <div class="kkt-item">
                                    <div class="kkt-item-label">ÊàëÁöÑÂêçÂ≠ó</div>
                                    <div class="kkt-item-control">
                                        <input type="text" id="setting-my-name" autocomplete="off"
                                            style="text-align:right; border:none; background:transparent;"
                                            placeholder="ÁÇπÂáª‰øÆÊîπ">
                                    </div>
                                </div>
                                <div class="kkt-item" style="flex-direction:column; align-items:flex-start;">
                                    <div class="kkt-item-label" style="margin-bottom:8px;">ÊàëÁöÑ‰∫∫ËÆæ</div>
                                    <textarea id="setting-my-persona"
                                        style="width:100%; border:1px solid #eee; border-radius:8px; padding:8px; min-height:60px;"
                                        placeholder="ÊèèËø∞‰Ω†ÁöÑÂΩ¢Ë±°..."></textarea>
                                </div>
                                <!-- ‰∫∫ËÆæÈ¢ÑËÆæ -->
                                <div class="kkt-item">
                                    <div class="kkt-item-label">‰∫∫ËÆæÈ¢ÑËÆæ</div>
                                    <div class="kkt-item-control">
                                        <select id="mypersona-preset-select"
                                            style="border:none; bg:transparent; width:100px;">
                                            <option value="">ÈÄâÊã©</option>
                                        </select>
                                        <button type="button" id="mypersona-apply-btn" class="btn btn-small btn-primary"
                                            style="padding:4px 8px; margin-left:5px;">Â∫îÁî®</button>
                                        <button type="button" id="mypersona-save-btn" class="btn btn-small"
                                            style="padding:4px 8px; margin-left:5px;">Â≠ò</button>
                                        <button type="button" id="mypersona-manage-btn" class="btn btn-small"
                                            style="padding:4px 8px; margin-left:5px;">ÁÆ°</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- „ÄêÂäüËÉΩ„ÄëTab ÂÜÖÂÆπ -->
                        <div id="setting-tab-func" class="settings-tab-content">
                            <!-- ËÅäÂ§©Â¢ûÂº∫ -->
                            <div class="kkt-group">
                                <div class="kkt-item">
                                    <div class="kkt-item-label">ÊúÄÂ§ßËÆ∞ÂøÜËΩÆÊï∞</div>
                                    <div class="kkt-item-control">
                                        <input type="number" id="setting-max-memory" value="100" min="1"
                                            style="width:50px; text-align:right; border:none;">
                                    </div>
                                </div>
                                <div class="kkt-item">
                                    <div class="kkt-item-label">ÂèåËØ≠ËÅäÂ§©Ê®°Âºè</div>
                                    <div class="kkt-item-control">
                                        <label class="kkt-switch">
                                            <input type="checkbox" id="setting-bilingual-mode">
                                            <span class="kkt-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="kkt-item" id="setting-bilingual-style-container">
                                    <div class="kkt-item-label">ÁøªËØëÊòæÁ§∫Ê†∑Âºè</div>
                                    <div class="kkt-item-control">
                                        <select id="setting-bilingual-style"
                                            style="border:none; background:transparent; text-align:right;">
                                            <option value="under">Ê∞îÊ≥°Â§ñ (ÈªòËÆ§)</option>
                                            <option value="inner">Ê∞îÊ≥°ÂÜÖ</option>
                                            <option value="inner-no-line">Ê∞îÊ≥°ÂÜÖ (Êó†ÂàÜÂâ≤Á∫ø)</option>
                                        </select>
                                        <span class="kkt-arrow">‚Ä∫</span>
                                    </div>
                                </div>
                                <div class="kkt-item">
                                    <div class="kkt-item-label">Ëá™ÂÆö‰πâÂõûÂ§çÊù°Êï∞</div>
                                    <div class="kkt-item-control">
                                        <label class="kkt-switch">
                                            <input type="checkbox" id="setting-reply-count-enabled">
                                            <span class="kkt-slider"></span>
                                        </label>
                                    </div>
                                </div>

                                <div class="kkt-item" id="setting-reply-count-container" style="display: none;">
                                    <div class="kkt-item-label">ÂõûÂ§çÊù°Êï∞ËåÉÂõ¥</div>
                                    <div class="kkt-item-control" style="gap: 5px;">
                                        <input type="number" id="setting-reply-count-min" value="3" min="1"
                                            style="width:30px; text-align:center; border:none; background: rgba(0,0,0,0.05); border-radius: 4px;">
                                        <span style="color:#999;">-</span>
                                        <input type="number" id="setting-reply-count-max" value="8" min="1"
                                            style="width:30px; text-align:center; border:none; background: rgba(0,0,0,0.05); border-radius: 4px;">
                                    </div>
                                </div>

                                <div class="kkt-item">
                                    <div class="kkt-item-label">Ëá™Âä®ÁîüÊàêÊó•ËÆ∞ÊÄªÁªì</div>
                                    <div class="kkt-item-control">
                                        <label class="kkt-switch">
                                            <input type="checkbox" id="setting-auto-journal-enabled">
                                            <span class="kkt-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="kkt-item" id="setting-auto-journal-interval-container" style="display: none;">
                                    <div class="kkt-item-label">Ëá™Âä®ÊÄªÁªìÈó¥Èöî(Êù°)</div>
                                    <div class="kkt-item-control">
                                        <input type="number" id="setting-auto-journal-interval" value="100" min="10"
                                            style="width:60px; text-align:right; border:none; background: rgba(0,0,0,0.05); border-radius: 4px;">
                                    </div>
                                </div>

                                <div class="kkt-item">
                                    <div class="kkt-item-label">ËßíËâ≤Ëá™‰∏ªÊî∂Ëóè</div>
                                    <div class="kkt-item-control">
                                        <label class="kkt-switch">
                                            <input type="checkbox" id="setting-char-auto-favorite">
                                            <span class="kkt-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="kkt-item" style="padding-top: 0;">
                                    <p class="kkt-item-hint" style="font-size: 12px; color: #999; margin: 0;">
                                        ÂºÄÂêØÂêéÔºåËØ•ËßíËâ≤ÂèØËá™‰∏ªÊî∂ËóèËÆ§‰∏∫ÈáçË¶ÅÁöÑÁî®Êà∑Ê∂àÊÅØÔºåÂèØÂú®„ÄåÊî∂Ëóè„Äç‚Üí„ÄåËßíËâ≤Êî∂Ëóè„Äç‰∏≠Êü•Áúã</p>
                                </div>
                            </div>

                            <!-- ËßíËâ≤Áõ∏ÂÜåËÆæÁΩÆ -->
                            <div class="kkt-group" style="margin-top:15px;">
                                <div class="kkt-item">
                                    <div class="kkt-item-label">ÂêØÁî®ÁúüÂÆûÁõ∏ÂÜåÂåπÈÖç</div>
                                    <div class="kkt-item-control">
                                        <label class="kkt-switch">
                                            <input type="checkbox" id="setting-use-real-gallery">
                                            <span class="kkt-slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- ÂïÜÂüé‰∫íÂä®ËÆæÁΩÆ -->
                            <div class="kkt-group" style="margin-top:15px;">
                                <div class="kkt-item">
                                    <div class="kkt-item-label">ÂêØÁî®ÂïÜÂüé‰∫íÂä®</div>
                                    <div class="kkt-item-control">
                                        <label class="kkt-switch">
                                            <input type="checkbox" id="setting-shop-interaction-enabled">
                                            <span class="kkt-slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- ËßÜÈ¢ëÈÄöËØùËÆæÁΩÆ -->
                            <div class="kkt-group" style="margin-top:15px;">
                                <div class="kkt-item">
                                    <div class="kkt-item-label">ÂÖÅËÆ∏ËßíËâ≤‰∏ªÂä®ÂèëËµ∑ÈÄöËØù</div>
                                    <div class="kkt-item-control">
                                        <label class="kkt-switch">
                                            <input type="checkbox" id="setting-video-call-enabled">
                                            <span class="kkt-slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- ËÆ∞ÂøÜÂ≠òÊ°£Â∫ì -->
                            <div class="kkt-group" style="margin-top:15px;">
                                <div class="kkt-item">
                                    <div class="kkt-item-label">ËÆ∞ÂøÜÂ≠òÊ°£</div>
                                    <div class="kkt-item-control">
                                        <button type="button" id="open-archive-library-btn" class="btn btn-small btn-secondary"
                                            style="margin: 0; padding: 4px 12px;">ÁÆ°ÁêÜÂ≠òÊ°£</button>
                                        <span class="kkt-arrow">‚Ä∫</span>
                                    </div>
                                </div>
                            </div>

                            <!-- ËßíËâ≤Áä∂ÊÄÅÊ†èËÆæÁΩÆ -->
                            <div class="kkt-group" style="margin-top:15px;">
                                <div class="kkt-item">
                                    <div class="kkt-item-label">ÂêØÁî®ËßíËâ≤Áä∂ÊÄÅÊ†è</div>
                                    <div class="kkt-item-control">
                                        <label class="kkt-switch">
                                            <input type="checkbox" id="setting-status-panel-enabled">
                                            <span class="kkt-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <!-- ‰∏ãÊªëÊòæÁ§∫ÁöÑËØ¶ÁªÜËÆæÁΩÆÂå∫Âüü -->
                                <div id="status-panel-settings-container" class="collapsible-content">
                                    <div class="kkt-item"
                                        style="flex-direction:column; align-items:flex-start; border-top: 1px solid #f5f5f5;">
                                        <div class="preset-select-container" style="width: 100%; margin-bottom: 10px;">
                                            <label class="preset-select-label">Âø´ÈÄüÂ°´ÂÖÖÈ¢ÑËÆæ</label>
                                            <div style="display:flex; gap:5px; align-items:center;">
                                                <select id="setting-status-preset-select" style="flex:1;">
                                                    <option value="">-- ÈÄâÊã©È¢ÑËÆæËá™Âä®Â°´ÂÖÖ --</option>
                                                </select>
                                                <button type="button" id="quick-save-status-preset-btn"
                                                    class="btn btn-small"
                                                    style="padding: 6px 12px; white-space: nowrap;">Â≠ò</button>
                                            </div>
                                        </div>
                                        <div class="kkt-item-label" style="margin-bottom:8px;">Áä∂ÊÄÅÊ†èÊ†ºÂºèË¶ÅÊ±Ç (Prompt Suffix)
                                        </div>
                                        <textarea id="setting-status-prompt-suffix"
                                            style="width:100%; border:1px solid #eee; border-radius:8px; padding:8px; min-height:60px;"
                                            placeholder="‰æãÂ¶ÇÔºöËØ∑Âú®ÂõûÂ§çÊú´Â∞æËæìÂá∫Áä∂ÊÄÅÁ†ÅÔºö[HP:xx]"></textarea>
                                    </div>
                                    <div class="kkt-item" style="flex-direction:column; align-items:flex-start;">
                                        <div class="kkt-item-label" style="margin-bottom:8px;">ÊèêÂèñÊ≠£Âàô (Regex Pattern)
                                        </div>
                                        <input type="text" id="setting-status-regex"
                                            style="width:100%; border:1px solid #eee; border-radius:8px; padding:8px;"
                                            placeholder="‰æãÂ¶ÇÔºö\[HP:(\d+)\]">
                                    </div>
                                    <div class="kkt-item" style="flex-direction:column; align-items:flex-start;">
                                        <div class="kkt-item-label" style="margin-bottom:8px;">Ê≠£ÂàôÊõøÊç¢Âºè (HTML Template)
                                        </div>
                                        <textarea id="setting-status-replace"
                                            style="width:100%; border:1px solid #eee; border-radius:8px; padding:8px; min-height:60px;"
                                            placeholder='‰æãÂ¶ÇÔºö<div class="hp-bar" style="width:$1%"></div>'></textarea>
                                    </div>
                                    <div class="kkt-item">
                                        <div class="kkt-item-label">‰ªÖÂèëÈÄÅÊúÄËøë x ‰∏™Áä∂ÊÄÅÊ†è</div>
                                        <div class="kkt-item-control">
                                            <input type="number" id="setting-status-history-limit" value="3" min="0"
                                                style="width:50px; text-align:right; border:none;">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ÂêéÂè∞Ëá™Âä®Ê∂àÊÅØ -->
                            <div class="kkt-group" style="margin-top:15px;">
                                <div class="kkt-item">
                                    <div class="kkt-item-label">ÂêéÂè∞Ëá™Âä®ÂèëÈÄÅÊ∂àÊÅØ</div>
                                    <div class="kkt-item-control">
                                        <label class="kkt-switch">
                                            <input type="checkbox" id="setting-auto-reply-enabled">
                                            <span class="kkt-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="kkt-item">
                                    <div class="kkt-item-label">Êó†Êìç‰ΩúÊ£ÄÊµãÊó∂Èó¥ (ÂàÜÈíü)</div>
                                    <div class="kkt-item-control">
                                        <input type="number" id="setting-auto-reply-interval" value="60" min="1"
                                            style="width:50px; text-align:right; border:none;">
                                    </div>
                                </div>
                            </div>

                            <button type="button" class="kkt-danger-btn" id="clear-chat-history-btn">Ê∏ÖÁ©∫ËÅäÂ§©ËÆ∞ÂΩï</button>
                        </div>

                        <!-- „ÄêÁæéÂåñ„ÄëTab ÂÜÖÂÆπ -->
                        <div id="setting-tab-style" class="settings-tab-content">
                            <!-- ËÅäÂ§©ÁéØÂ¢ÉÂàÜÁªÑ -->
                            <div class="kkt-group">
                                <div class="kkt-item">
                                    <div class="kkt-item-label">ËÅäÂ§©ËÉåÊôØ</div>
                                    <div class="kkt-item-control"
                                        onclick="document.getElementById('setting-chat-bg-upload').click()">
                                        <span>ÁÇπÂáªÊõ¥Êç¢</span>
                                        <span class="kkt-arrow">‚Ä∫</span>
                                    </div>
                                    <input type="file" id="setting-chat-bg-upload" accept="image/*"
                                        style="display:none;">
                                </div>
                                <div class="kkt-item">
                                    <div class="kkt-item-label">‰∏ªÈ¢òÈ¢úËâ≤</div>
                                    <div class="kkt-item-control">
                                        <select id="setting-theme-color"
                                            style="border:none; background:transparent; text-align:right;"></select>
                                        <span class="kkt-arrow">‚Ä∫</span>
                                    </div>
                                </div>
                                <div class="kkt-item">
                                    <div class="kkt-item-label">Â§¥ÂÉèÊòæÁ§∫Ê®°Âºè</div>
                                    <div class="kkt-item-control">
                                        <select id="setting-avatar-mode"
                                            style="border:none; background:transparent; text-align:right;">
                                            <option value="full">ÂÖ®ÈÉ®ÊòæÁ§∫</option>
                                            <option value="merge">Ê∞îÊ≥°ÂêàÂπ∂</option>
                                            <option value="kkt">KKTÊ®°Âºè</option>
                                            <option value="hidden">ÈöêËóèÂ§¥ÂÉè</option>
                                        </select>
                                        <span class="kkt-arrow">‚Ä∫</span>
                                    </div>
                                </div>
                                <div class="kkt-item">
                                    <div class="kkt-item-label">È°∂ÈÉ®Ê†áÈ¢òÂ∏ÉÂ±Ä</div>
                                    <div class="kkt-item-control">
                                        <select id="setting-title-layout"
                                            style="border:none; background:transparent; text-align:right;">
                                            <option value="left">Â±ÖÂ∑¶ (ÈªòËÆ§)</option>
                                            <option value="center">Â±Ö‰∏≠</option>
                                        </select>
                                        <span class="kkt-arrow">‚Ä∫</span>
                                    </div>
                                </div>
                                <div class="kkt-item">
                                    <div class="kkt-item-label">ÊòæÁ§∫Êó∂Èó¥Êà≥</div>
                                    <div class="kkt-item-control">
                                        <label class="kkt-switch">
                                            <input type="checkbox" id="setting-show-timestamp">
                                            <span class="kkt-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="kkt-item" id="setting-timestamp-style-container">
                                    <div class="kkt-item-label">Êó∂Èó¥Êà≥‰ΩçÁΩÆ</div>
                                    <div class="kkt-item-control">
                                        <select id="setting-timestamp-style"
                                            style="border:none; background:transparent; text-align:right;">
                                            <option value="bubble">Ë∑üÈöèÊ∞îÊ≥°</option>
                                            <option value="avatar">Â§¥ÂÉè‰∏ãÊñπ</option>
                                        </select>
                                        <span class="kkt-arrow">‚Ä∫</span>
                                    </div>
                                </div>
                                <div class="kkt-item">
                                    <div class="kkt-item-label">È°∂ÈÉ®ÊòæÁ§∫Âú®Á∫øÁä∂ÊÄÅ</div>
                                    <div class="kkt-item-control">
                                        <label class="kkt-switch">
                                            <input type="checkbox" id="setting-show-status">
                                            <span class="kkt-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="kkt-item">
                                    <div class="kkt-item-label">ËÅäÂ§©ÂÜÖÊòæÁ§∫Áä∂ÊÄÅÊõ¥Êñ∞Ê∂àÊÅØ</div>
                                    <div class="kkt-item-control">
                                        <label class="kkt-switch">
                                            <input type="checkbox" id="setting-show-status-update-msg">
                                            <span class="kkt-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="kkt-item">
                                    <div class="kkt-item-label">Ê∞îÊ≥°Á£®Á†ÇÊïàÊûú</div>
                                    <div class="kkt-item-control">
                                        <label class="kkt-switch">
                                            <input type="checkbox" id="setting-bubble-blur">
                                            <span class="kkt-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="kkt-item"
                                    style="flex-direction: column; align-items: stretch; padding-bottom: 15px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                        <div class="kkt-item-label">Â§¥ÂÉèÂúÜËßí</div>
                                        <span id="setting-avatar-radius-value"
                                            style="color: var(--primary-color); font-weight: bold;">50%</span>
                                    </div>
                                    <input type="range" id="setting-avatar-radius" min="0" max="50" step="1" value="50"
                                        style="width: 100%; accent-color: var(--primary-color);">
                                </div>
                            </div>

                            <!-- Ê∞îÊ≥°Ê†∑ÂºèÂàÜÁªÑ -->
                            <div class="kkt-group" style="margin-top:15px;">
                                <div class="kkt-item">
                                    <div class="kkt-item-label">Ëá™ÂÆö‰πâÊ∞îÊ≥°Ê†∑Âºè</div>
                                    <div class="kkt-item-control">
                                        <label class="kkt-switch">
                                            <input type="checkbox" id="setting-use-custom-css">
                                            <span class="kkt-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="kkt-item" style="display:block;">
                                    <div id="private-bubble-css-preview" class="bubble-css-preview"
                                        style="margin-bottom:10px;"></div>
                                    <textarea id="setting-custom-bubble-css" rows="4" placeholder="CSS‰ª£Á†Å..."
                                        style="width:100%; border:1px solid #eee; border-radius:8px; padding:5px;"
                                        disabled></textarea>
                                    <div style="display:flex; justify-content:flex-end; gap:5px; margin-top:5px;">
                                        <select id="bubble-preset-select" style="width:100px;">
                                            <option value="">È¢ÑËÆæ</option>
                                        </select>
                                        <button type="button" id="apply-preset-btn" class="btn btn-small btn-primary"
                                            style="padding:4px 8px;">Â∫îÁî®</button>
                                        <button type="button" id="save-preset-btn" class="btn btn-small"
                                            style="padding:4px 8px;">Â≠ò</button>
                                        <button type="button" id="manage-presets-btn" class="btn btn-small"
                                            style="padding:4px 8px;">ÁÆ°</button>
                                        <button type="button" id="reset-custom-bubble-css-btn"
                                            class="btn btn-small btn-neutral" style="padding:4px 8px;">ÈáçÁΩÆ</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- „ÄêÊãìÂ±ï„ÄëTab ÂÜÖÂÆπ -->
                        <div id="setting-tab-ext" class="settings-tab-content">
                            <!-- TTS ËØ≠Èü≥ÈÖçÁΩÆ -->
                            <div class="kkt-group">
                                <div style="margin-bottom: 15px; padding-top: 5px; padding-left: 8px;">
                                    <div class="kkt-item-label" style="font-weight: bold; color: var(--primary-color);">ËØ≠Èü≥ËÆæÁΩÆ</div>
                                    <p style="font-size: 11px; color: #999; margin: 5px 0 0;">ÈÄöËØùÊó∂ÁöÑËØ≠Èü≥ÂêàÊàêËÆæÁΩÆ</p>
                                </div>
                                
                                <div class="kkt-item">
                                    <div class="kkt-item-label">ËØ≠Èü≥Èü≥Ëâ≤</div>
                                    <div class="kkt-item-control">
                                        <button type="button" id="select-voice-id-btn"
                                            class="btn btn-small btn-secondary"
                                            style="margin: 0; padding: 4px 12px; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                            <span id="current-voice-name">ÈÄâÊã©Èü≥Ëâ≤</span>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="kkt-item">
                                    <div class="kkt-item-label">Ëá™ÂÆö‰πâ Voice ID</div>
                                    <div class="kkt-item-control">
                                        <input type="text" id="setting-custom-voice-id" autocomplete="off"
                                            placeholder="ÂèØÈÄâÔºå‰ºòÂÖà‰ΩøÁî®"
                                            style="text-align:right; border:none; background:transparent; width: 100%;">
                                    </div>
                                </div>
                                
                                <div class="kkt-item">
                                    <div class="kkt-item-label">ËØ≠Ë®Ä</div>
                                    <div class="kkt-item-control">
                                        <select id="setting-tts-language"
                                            style="border:none; background:transparent; text-align:right; direction: rtl; appearance: none; -webkit-appearance: none; padding-right: 15px;">
                                            <option value="auto">Ëá™Âä®ËØÜÂà´</option>
                                            <option value="zh">‰∏≠Êñá (ÊôÆÈÄöËØù)</option>
                                            <option value="yue">‰∏≠Êñá (Á≤§ËØ≠)</option>
                                            <option value="en">Ëã±ËØ≠</option>
                                            <option value="ja">Êó•ËØ≠</option>
                                            <option value="ko">Èü©ËØ≠</option>
                                            <option value="es">Ë•øÁè≠ÁâôËØ≠</option>
                                            <option value="fr">Ê≥ïËØ≠</option>
                                            <option value="de">Âæ∑ËØ≠</option>
                                            <option value="ru">‰øÑËØ≠</option>
                                            <option value="pt">Ëë°ËêÑÁâôËØ≠</option>
                                            <option value="it">ÊÑèÂ§ßÂà©ËØ≠</option>
                                            <option value="ar">ÈòøÊãâ‰ºØËØ≠</option>
                                            <option value="th">Ê≥∞ËØ≠</option>
                                            <option value="vi">Ë∂äÂçóËØ≠</option>
                                            <option value="id">Âç∞Â∞ºËØ≠</option>
                                            <option value="tr">ÂúüËÄ≥ÂÖ∂ËØ≠</option>
                                            <option value="nl">Ëç∑ÂÖ∞ËØ≠</option>
                                            <option value="uk">‰πåÂÖãÂÖ∞ËØ≠</option>
                                            <option value="pl">Ê≥¢ÂÖ∞ËØ≠</option>
                                        </select>
                                        <span class="kkt-arrow">‚Ä∫</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ÁîüÂõæÂäüËÉΩÂç†‰Ωç -->
                            <div class="kkt-group" style="margin-top:15px; opacity: 0.5; pointer-events: none;">
                                <div style="margin-bottom: 10px; padding-left: 8px;">
                                    <div class="kkt-item-label" style="font-weight: bold; color: #aaa;">ÁîüÂõæËÆæÁΩÆ</div>
                                    <p style="font-size: 11px; color: #999; margin: 3px 0 0;">ÂäüËÉΩÂºÄÂèë‰∏≠ÔºåÊï¨ËØ∑ÊúüÂæÖ...</p>
                                </div>
                                
                                <div class="kkt-item">
                                    <div class="kkt-item-label" style="color: #ccc;">ÁîüÂõæÊ®°Âûã</div>
                                    <div class="kkt-item-control">
                                        <span style="color: #ccc;">ÊöÇÊú™ÂºÄÊîæ</span>
                                    </div>
                                </div>
                                
                                <div class="kkt-item">
                                    <div class="kkt-item-label" style="color: #ccc;">ÂõæÁâáÂ∞∫ÂØ∏</div>
                                    <div class="kkt-item-control">
                                        <span style="color: #ccc;">ÊöÇÊú™ÂºÄÊîæ</span>
                                    </div>
                                </div>
                                
                                <div class="kkt-item">
                                    <div class="kkt-item-label" style="color: #ccc;">ÁîüÊàêÈ£éÊ†º</div>
                                    <div class="kkt-item-control">
                                        <span style="color: #ccc;">ÊöÇÊú™ÂºÄÊîæ</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary" style="margin-top:20px;">‰øùÂ≠òÊâÄÊúâÊõ¥Êîπ</button>
                    </form>
                </div>
            </main>
        </div>
        <!-- ËÆ∞ÂøÜÂ≠òÊ°£Â∫ìÁïåÈù¢ -->
        <div id="archive-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="chat-settings-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">ËÆ∞ÂøÜÂ≠òÊ°£</h1>
                </div>
                <div class="action-btn-group">
                    <button type="button" id="archive-multi-select-btn" class="action-btn" title="Â§öÈÄâ">Â§öÈÄâ</button>
                    <button type="button" id="create-archive-btn" class="action-btn" title="Êñ∞Âª∫Â≠òÊ°£">+ Êñ∞Âª∫</button>
                </div>
            </header>
            <div id="archive-multi-select-bar" class="archive-multi-select-bar">
                <span>Â∑≤ÈÄâ <span id="archive-selected-count">0</span> È°π</span>
                <button type="button" id="archive-multi-delete-btn" class="btn btn-small" disabled>Âà†Èô§ÈÄâ‰∏≠</button>
                <button type="button" id="archive-cancel-multi-btn" class="btn btn-small btn-secondary">ÂèñÊ∂à</button>
            </div>
            <main class="content">
                <ul id="archive-list-container" class="archive-list"></ul>
                <div id="no-archives-placeholder" class="placeholder-text" style="display: none;">
                    <p>ËøòÊ≤°Êúâ‰øùÂ≠ò‰ªª‰ΩïÂ≠òÊ°£</p>
                    <p>ÁÇπÂáªÂè≥‰∏äËßí„Äå+ Êñ∞Âª∫„ÄçÂàõÂª∫Á¨¨‰∏Ä‰∏™Â≠òÊ°£</p>
                </div>
            </main>
        </div>
        <!-- ÂàõÂª∫Â≠òÊ°£ÂºπÁ™ó -->
        <div id="create-archive-modal" class="modal-overlay">
            <div class="modal-window">
                <h3>ÂàõÂª∫ËÆ∞ÂøÜÂ≠òÊ°£</h3>
                <form id="create-archive-form">
                    <div class="form-group">
                        <label for="archive-name-input">Â≠òÊ°£ÂêçÁß∞</label>
                        <input type="text" id="archive-name-input" autocomplete="off" placeholder="‰∏∫Ëøô‰∏™Â≠òÊ°£Ëµ∑‰∏™ÂêçÂ≠ó‚Ä¶">
                    </div>
                    <p class="archive-info">ÂΩìÂâçËÅäÂ§©ËÆ∞ÂΩïÔºö<span id="current-message-count">0</span> Êù°</p>
                    <div class="modal-actions" style="display: flex; gap: 10px; margin-top: 16px;">
                        <button type="button" id="cancel-archive-btn" class="btn btn-secondary">ÂèñÊ∂à</button>
                        <button type="submit" class="btn btn-primary">‰øùÂ≠ò</button>
                    </div>
                </form>
            </div>
        </div>
        <div id="world-book-selection-modal" class="modal-overlay">
            <div class="modal-window">
                <h3>ÈÄâÊã©Ë¶ÅÂÖ≥ËÅîÁöÑ‰∏ñÁïå‰π¶</h3>
                <ul id="world-book-selection-list"></ul>
                <button class="btn btn-primary" id="save-world-book-selection-btn" style="margin-top: 20px;">Á°ÆËÆ§</button>
            </div>
        </div>
        <!-- Global Pomodoro World Book Selection Modal -->
        <div id="global-pomodoro-world-book-selection-modal" class="modal-overlay">
            <div class="modal-window">
                <h3>‰∏∫ÂÖ®Â±Ä‰∏ìÊ≥®ËÆæÁΩÆÂÖ≥ËÅî‰∏ñÁïå‰π¶</h3>
                <ul id="global-pomodoro-world-book-selection-list" class="list-container"
                    style="max-height: 40vh; overflow-y: auto; padding: 0; margin: 15px 0;">
                    <!-- World book items will be rendered here -->
                </ul>
                <button class="btn btn-primary" id="save-global-pomodoro-world-book-selection-btn"
                    style="margin-top: 20px;">Á°ÆËÆ§</button>
            </div>
        </div>
        <!-- Group Chat Creation Modal -->
        <div id="create-group-modal" class="modal-overlay">
            <div class="modal-window">
                <h3>ÂàõÂª∫Áæ§ËÅä</h3>
                <form id="create-group-form">
                    <div class="form-group">
                        <label>ÈÄâÊã©Áæ§ÊàêÂëò</label>
                        <ul id="member-selection-list" class="member-selection-list"></ul>
                    </div>
                    <div class="form-group">
                        <label for="group-name-input">Áæ§ËÅäÂêçÁß∞</label>
                        <input type="text" id="group-name-input" autocomplete="off" placeholder="Áªô‰Ω†ÁöÑÁæ§ËÅäËµ∑‰∏™ÂêçÂ≠óÂêß" required>
                    </div>
                    <button type="submit" class="btn btn-primary">ÂàõÂª∫Áæ§ËÅä</button>
                </form>
            </div>
        </div>
        <!-- Group Chat Settings (KKT Style) -->
        <div id="group-settings-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="chat-room-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">Áæ§ËÅäËÆæÁΩÆ</h1>
                </div>
                <div class="placeholder"></div>
            </header>
            <main class="content">
                <div class="kkt-settings-container">
                    <!-- Áæ§‰ø°ÊÅØÂ§¥ÈÉ® (Ê®°‰ªø‰∏™‰∫∫ËµÑÊñô) -->
                    <div class="kkt-profile-section">
                        <img src="" alt="Áæ§Â§¥ÂÉè" id="setting-group-avatar-preview" class="kkt-profile-avatar"
                            onclick="document.getElementById('setting-group-avatar-upload').click()">
                        <!-- ÈöêËóèÁöÑÊñá‰ª∂‰∏ä‰º†input -->
                        <input type="file" id="setting-group-avatar-upload" accept="image/*" style="display:none;">
                        <!-- Áæ§ÂêçÁõ¥Êé•Âú®ËøôÈáåÊòæÁ§∫/ÁºñËæë -->
                        <input type="text" id="setting-group-name" autocomplete="off" class="kkt-profile-name-input"
                            placeholder="ËæìÂÖ•Áæ§Âêç"
                            style="text-align:center; border:none; background:transparent; font-size:18px; font-weight:bold; margin-top:10px; width:80%;">
                    </div>

                    <form id="group-settings-form">
                        <!-- ÊàëÁöÑ‰ø°ÊÅØÂàÜÁªÑ -->
                        <div class="kkt-group">
                            <div class="kkt-item">
                                <div class="kkt-item-label">ÊàëÁöÑÂ§¥ÂÉè</div>
                                <div class="kkt-item-control"
                                    onclick="document.getElementById('setting-group-my-avatar-upload').click()">
                                    <img src="" id="setting-group-my-avatar-preview" class="kkt-small-avatar">
                                    <span class="kkt-arrow">‚Ä∫</span>
                                </div>
                                <input type="file" id="setting-group-my-avatar-upload" accept="image/*"
                                    style="display:none;">
                            </div>
                            <div class="kkt-item">
                                <div class="kkt-item-label">ÊàëÁöÑÁæ§ÊòµÁß∞</div>
                                <div class="kkt-item-control">
                                    <input type="text" id="setting-group-my-nickname" autocomplete="off"
                                        style="text-align:right; border:none; background:transparent;"
                                        placeholder="ÁÇπÂáª‰øÆÊîπ">
                                </div>
                            </div>
                            <div class="kkt-item" style="flex-direction:column; align-items:flex-start;">
                                <div class="kkt-item-label" style="margin-bottom:8px;">ÊàëÁöÑ‰∫∫ËÆæ</div>
                                <textarea id="setting-group-my-persona"
                                    style="width:100%; border:1px solid #eee; border-radius:8px; padding:8px; min-height:60px;"
                                    placeholder="ÊèèËø∞‰Ω†Âú®Ê≠§Áæ§ÁöÑÂΩ¢Ë±°..."></textarea>
                            </div>
                        </div>

                        <!-- Áæ§ÊàêÂëòÁÆ°ÁêÜÂàÜÁªÑ -->
                        <div class="kkt-group" style="margin-top:15px;">
                            <div class="kkt-item" style="display:block;">
                                <div class="kkt-item-label" style="margin-bottom:10px;">Áæ§ÊàêÂëò</div>
                                <div class="group-members-list" id="group-members-list-container"
                                    style="display:grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 10px;">
                                </div>
                            </div>
                        </div>

                        <!-- Áæ§ÂÖ¨ÂëäËÆæÁΩÆÂàÜÁªÑ -->
                        <div class="kkt-group" style="margin-top:15px;">
                            <div class="kkt-item">
                                <div class="kkt-item-label">ÂêØÁî®Áæ§ÂÖ¨Âëä</div>
                                <div class="kkt-item-control">
                                    <label class="kkt-switch">
                                        <input type="checkbox" id="setting-group-show-notice">
                                        <span class="kkt-slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="kkt-item" style="flex-direction:column; align-items:flex-start;">
                                <div class="kkt-item-label" style="margin-bottom:8px;">ÂÖ¨ÂëäÂÜÖÂÆπ</div>
                                <textarea id="setting-group-notice"
                                    style="width:100%; border:1px solid #eee; border-radius:8px; padding:8px; min-height:80px;"
                                    placeholder="ËæìÂÖ•Áæ§ÂÖ¨ÂëäÔºåÂ∞Ü‰Ωú‰∏∫ÂΩìÂâçÂâßÊÉÖËÉåÊôØ..."></textarea>
                            </div>
                        </div>

                        <!-- ÂäüËÉΩÂºÄÂÖ≥ÂàÜÁªÑ (ÁßÅËÅäÂÖ´Âç¶) -->
                        <div class="kkt-group" style="margin-top: 15px;">
                            <div class="kkt-item">
                                <div class="kkt-item-label">ÂºÄÂêØÂÖÅËÆ∏Áæ§ÂÜÖÁßÅËÅä</div>
                                <div class="kkt-item-control">
                                    <label class="kkt-switch">
                                        <input type="checkbox" id="setting-group-allow-gossip">
                                        <span class="kkt-slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="kkt-item">
                                <div class="kkt-item-label">ÂèåËØ≠ËÅäÂ§©Ê®°Âºè</div>
                                <div class="kkt-item-control">
                                    <label class="kkt-switch">
                                        <input type="checkbox" id="setting-group-bilingual-mode">
                                        <span class="kkt-slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="kkt-item" id="setting-group-bilingual-style-container">
                                <div class="kkt-item-label">ÁøªËØëÊòæÁ§∫Ê†∑Âºè</div>
                                <div class="kkt-item-control">
                                    <select id="setting-group-bilingual-style"
                                        style="border:none; background:transparent; text-align:right;">
                                        <option value="under">Ê∞îÊ≥°Â§ñ (ÈªòËÆ§)</option>
                                        <option value="inner">Ê∞îÊ≥°ÂÜÖ</option>
                                        <option value="inner-no-line">Ê∞îÊ≥°ÂÜÖ (Êó†ÂàÜÂâ≤Á∫ø)</option>
                                    </select>
                                    <span class="kkt-arrow">‚Ä∫</span>
                                </div>
                            </div>
                        </div>

                        <!-- Ë°®ÊÉÖÂåÖËÆæÁΩÆÂàÜÁªÑ -->
                        <div class="kkt-group" style="margin-top:15px;">
                            <div class="kkt-item" style="flex-direction:column; align-items:flex-start;">
                                <div class="kkt-item-label" style="margin-bottom:8px;">ÂèØÁî®Ë°®ÊÉÖÂåÖÂàÜÁªÑ</div>
                                <div id="setting-group-sticker-groups-container"
                                    style="width:100%; max-height: 120px; overflow-y: auto; border: 1px solid #eee; padding: 10px; border-radius: 8px;">
                                    <!-- JS populate -->
                                </div>
                            </div>
                        </div>

                        <!-- ËÅäÂ§©ÁéØÂ¢ÉÂàÜÁªÑ -->
                        <div class="kkt-group" style="margin-top:15px;">
                            <div class="kkt-item">
                                <div class="kkt-item-label">ËÅäÂ§©ËÉåÊôØ</div>
                                <div class="kkt-item-control"
                                    onclick="document.getElementById('setting-group-chat-bg-upload').click()">
                                    <span>ÁÇπÂáªÊõ¥Êç¢</span>
                                    <span class="kkt-arrow">‚Ä∫</span>
                                </div>
                                <input type="file" id="setting-group-chat-bg-upload" accept="image/*"
                                    style="display:none;">
                            </div>
                            <div class="kkt-item">
                                <div class="kkt-item-label">‰∏ªÈ¢òÈ¢úËâ≤</div>
                                <div class="kkt-item-control">
                                    <select id="setting-group-theme-color"
                                        style="border:none; background:transparent; text-align:right;"></select>
                                    <span class="kkt-arrow">‚Ä∫</span>
                                </div>
                            </div>
                            <div class="kkt-item">
                                <div class="kkt-item-label">ÊúÄÂ§ßËÆ∞ÂøÜËΩÆÊï∞</div>
                                <div class="kkt-item-control">
                                    <input type="number" id="setting-group-max-memory" value="100" min="1"
                                        style="width:50px; text-align:right; border:none;">
                                </div>
                            </div>
                            <div class="kkt-item">
                                <div class="kkt-item-label">Ëá™Âä®ÁîüÊàêÊÄªÁªì</div>
                                <div class="kkt-item-control">
                                    <label class="kkt-switch">
                                        <input type="checkbox" id="setting-group-auto-journal-enabled">
                                        <span class="kkt-slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="kkt-item" id="setting-group-auto-journal-interval-container" style="display: none;">
                                <div class="kkt-item-label">Ëá™Âä®ÊÄªÁªìÈó¥Èöî(Êù°)</div>
                                <div class="kkt-item-control">
                                    <input type="number" id="setting-group-auto-journal-interval" value="100" min="10"
                                        style="width:60px; text-align:right; border:none; background: rgba(0,0,0,0.05); border-radius: 4px;">
                                </div>
                            </div>
                            <div class="kkt-item">
                                <div class="kkt-item-label">ÂÖ≥ËÅî‰∏ñÁïå‰π¶</div>
                                <div class="kkt-item-control">
                                    <button type="button" id="link-group-world-book-btn"
                                        class="btn btn-small btn-secondary"
                                        style="margin: 0; padding: 4px 8px;">ËÆæÁΩÆ</button>
                                </div>
                            </div>
                            <div class="kkt-item">
                                <div class="kkt-item-label">ÊòæÁ§∫Êó∂Èó¥Êà≥</div>
                                <div class="kkt-item-control">
                                    <label class="kkt-switch">
                                        <input type="checkbox" id="setting-group-show-timestamp">
                                        <span class="kkt-slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="kkt-item" id="setting-group-timestamp-style-container">
                                <div class="kkt-item-label">Êó∂Èó¥Êà≥‰ΩçÁΩÆ</div>
                                <div class="kkt-item-control">
                                    <select id="setting-group-timestamp-style"
                                        style="border:none; background:transparent; text-align:right;">
                                        <option value="bubble">Ë∑üÈöèÊ∞îÊ≥°</option>
                                        <option value="avatar">Â§¥ÂÉè‰∏ãÊñπ</option>
                                    </select>
                                    <span class="kkt-arrow">‚Ä∫</span>
                                </div>
                            </div>
                            <div class="kkt-item">
                                <div class="kkt-item-label">È°∂ÈÉ®Ê†áÈ¢òÂ∏ÉÂ±Ä</div>
                                <div class="kkt-item-control">
                                    <select id="setting-group-title-layout"
                                        style="border:none; background:transparent; text-align:right;">
                                        <option value="left">Â±ÖÂ∑¶ (ÈªòËÆ§)</option>
                                        <option value="center">Â±Ö‰∏≠</option>
                                    </select>
                                    <span class="kkt-arrow">‚Ä∫</span>
                                </div>
                            </div>
                            <div class="kkt-item"
                                style="flex-direction: column; align-items: stretch; padding-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <div class="kkt-item-label">Â§¥ÂÉèÂúÜËßí</div>
                                    <span id="setting-group-avatar-radius-value"
                                        style="color: var(--primary-color); font-weight: bold;">50%</span>
                                </div>
                                <input type="range" id="setting-group-avatar-radius" min="0" max="50" step="1"
                                    value="50" style="width: 100%; accent-color: var(--primary-color);">
                            </div>
                        </div>

                        <!-- Ê∞îÊ≥°Ê†∑ÂºèÂàÜÁªÑ -->
                        <div class="kkt-group" style="margin-top:15px;">
                            <div class="kkt-item">
                                <div class="kkt-item-label">Ëá™ÂÆö‰πâÊ∞îÊ≥°Ê†∑Âºè</div>
                                <div class="kkt-item-control">
                                    <label class="kkt-switch">
                                        <input type="checkbox" id="setting-group-use-custom-css">
                                        <span class="kkt-slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="kkt-item" style="display:block;">
                                <div id="group-bubble-css-preview" class="bubble-css-preview"
                                    style="margin-bottom:10px;"></div>
                                <textarea id="setting-group-custom-bubble-css" rows="4" placeholder="CSS‰ª£Á†Å..."
                                    style="width:100%; border:1px solid #eee; border-radius:8px; padding:5px;"
                                    disabled></textarea>
                                <div style="display:flex; justify-content:flex-end; gap:5px; margin-top:5px;">
                                    <select id="group-bubble-preset-select" style="width:100px;">
                                        <option value="">È¢ÑËÆæ</option>
                                    </select>
                                    <button type="button" id="group-apply-preset-btn" class="btn btn-small btn-primary"
                                        style="padding:4px 8px;">Â∫îÁî®</button>
                                    <button type="button" id="group-save-preset-btn" class="btn btn-small"
                                        style="padding:4px 8px;">Â≠ò</button>
                                    <button type="button" id="group-manage-presets-btn" class="btn btn-small"
                                        style="padding:4px 8px;">ÁÆ°</button>
                                    <button type="button" id="reset-group-custom-bubble-css-btn"
                                        class="btn btn-small btn-neutral" style="padding:4px 8px;">ÈáçÁΩÆ</button>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary" style="margin-top:20px;">‰øùÂ≠òÊâÄÊúâÊõ¥Êîπ</button>
                    </form>

                    <button type="button" class="kkt-danger-btn" id="clear-group-chat-history-btn">Ê∏ÖÁ©∫ËÅäÂ§©ËÆ∞ÂΩï</button>
                </div>
            </main>
        </div>
        <!-- Group Member Edit Modal -->
        <div id="edit-group-member-modal" class="modal-overlay">
            <div class="modal-window">
                <h3 id="edit-group-member-title">ÁºñËæëÁæ§ÊàêÂëò</h3>
                <form id="edit-group-member-form">
                    <input type="hidden" id="editing-member-id">
                    <div class="avatar-setting" style="justify-content: center;">
                        <img src="" alt="ÊàêÂëòÂ§¥ÂÉè" id="edit-member-avatar-preview" class="avatar-preview"
                            style="cursor: pointer;">
                        <input type="file" id="edit-member-avatar-upload" accept="image/*" style="display:none;">
                    </div>
                    <div class="form-group">
                        <label for="edit-member-group-nickname">Áæ§ÊòµÁß∞</label>
                        <input type="text" id="edit-member-group-nickname" autocomplete="off" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-member-real-name">ÁúüÂêç</label>
                        <input type="text" id="edit-member-real-name" autocomplete="off" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-member-persona">‰∫∫ËÆæ</label>
                        <textarea id="edit-member-persona" placeholder="ËØ¶ÁªÜÊèèËø∞ËßíËâ≤ÁöÑÊÄßÊ†º„ÄÅËÉåÊôØÁ≠â„ÄÇ"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">‰øùÂ≠ò</button>
                </form>
            </div>
        </div>
        <!-- Add Member to Group Action Sheet -->
        <div id="add-member-actionsheet" class="action-sheet-overlay">
            <div class="action-sheet">
                <button class="action-sheet-button" id="invite-existing-member-btn">ÈÇÄËØ∑Áé∞ÊúâËßíËâ≤</button>
                <button class="action-sheet-button" id="create-new-member-btn">ÂàõÂª∫Êñ∞ËßíËâ≤ÂÖ•Áæ§</button>
            </div>
        </div>
        <!-- Invite Existing Member Modal -->
        <div id="invite-member-modal" class="modal-overlay">
            <div class="modal-window">
                <h3>ÈÇÄËØ∑ÊàêÂëòÂä†ÂÖ•Áæ§ËÅä</h3>
                <ul id="invite-member-selection-list"></ul>
                <button class="btn btn-primary" id="confirm-invite-btn" style="margin-top: 20px;">Á°ÆËÆ§ÈÇÄËØ∑</button>
            </div>
        </div>
        <!-- Create New Member for Group Modal -->
        <div id="create-member-for-group-modal" class="modal-overlay">
            <div class="modal-window">
                <h3>ÂàõÂª∫Êñ∞ËßíËâ≤Âπ∂Âä†ÂÖ•Áæ§ËÅä</h3>
                <form id="create-member-for-group-form">
                    <div class="avatar-setting" style="justify-content: center;">
                        <img src="https://i.postimg.cc/Y96LPskq/o-o-2.jpg" alt="Êñ∞ÊàêÂëòÂ§¥ÂÉè"
                            id="create-group-member-avatar-preview" class="avatar-preview" style="cursor: pointer;">
                        <input type="file" id="create-group-member-avatar-upload" accept="image/*"
                            style="display:none;">
                    </div>
                    <div class="form-group">
                        <label for="create-group-member-nickname">Áæ§ÊòµÁß∞</label>
                        <input type="text" id="create-group-member-nickname" required>
                    </div>
                    <div class="form-group">
                        <label for="create-group-member-realname">ÁúüÂêç</label>
                        <input type="text" id="create-group-member-realname" required>
                    </div>
                    <div class="form-group">
                        <label for="create-group-member-persona">‰∫∫ËÆæ</label>
                        <textarea id="create-group-member-persona" placeholder="ËØ¶ÁªÜÊèèËø∞ËßíËâ≤ÁöÑÊÄßÊ†º„ÄÅËÉåÊôØÁ≠â„ÄÇ"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">ÂàõÂª∫Âπ∂Âä†ÂÖ•</button>
                </form>
            </div>
        </div>
        <!-- Memory Journal Screen -->
        <div id="memory-journal-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="chat-room-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">ÂõûÂøÜÊó•ËÆ∞</h1>
                </div>
                <div class="action-btn-group">
                    <button class="action-btn" id="journal-manage-btn" title="ÁÆ°ÁêÜÊó•ËÆ∞">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
                            stroke-linecap="round" stroke-linejoin="round" width="24" height="24">
                            <path d="M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2Z" />
                        </svg>
                    </button>
                    <button class="action-btn" id="journal-cancel-manage-btn" title="ÂèñÊ∂à"
                        style="display: none; font-size: 14px; width: auto; padding: 0 8px;">
                        ÂèñÊ∂à
                    </button>
                    <button class="action-btn" id="bind-journal-worldbook-btn" title="ÁªëÂÆö‰∏ñÁïå‰π¶">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
                            stroke-linecap="round" stroke-linejoin="round" width="24" height="24">
                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                        </svg>
                    </button>
                    <button class="action-btn" id="generate-new-journal-btn" title="ÁîüÊàêÊñ∞Êó•ËÆ∞">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
                            stroke-linecap="round" stroke-linejoin="round" width="24" height="24">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                </div>
            </header>
            <main class="content">
                <ul class="list-container" id="journal-list-container">
                    <!-- Journal cards will be rendered here -->
                </ul>
                <div class="placeholder-text" id="no-journals-placeholder" style="display: none;">
                    <p>ËøòÊ≤°ÊúâÊó•ËÆ∞Âì¶~</p>
                    <p>ÁÇπÂáªÂè≥‰∏äËßíÁöÑ‚Äú+Âè∑‚ÄùÊù•ÂàõÂª∫Á¨¨‰∏ÄÁØáÂêßÔºÅ</p>
                </div>
            </main>

            <!-- Êó•ËÆ∞Â§öÈÄâÊìç‰ΩúÊ†è -->
            <div id="journal-multi-select-bar" style="display: none;">
                <span id="journal-select-count">Â∑≤ÈÄâ 0 ÁØá</span>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-danger btn-small" id="journal-batch-delete-btn">Âà†Èô§</button>
                    <button class="btn btn-primary btn-small" id="journal-merge-btn">ÂêàÂπ∂Á≤æÁÆÄ</button>
                </div>
            </div>
        </div>

        <!-- Memory Journal Detail Screen -->
        <div id="memory-journal-detail-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="memory-journal-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">Êó•ËÆ∞ËØ¶ÊÉÖ</h1>
                </div>
                <button class="action-btn" id="edit-journal-detail-btn">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.13,5.12L18.88,8.87M3,17.25V21H6.75L17.81,9.94L14.06,6.19L3,17.25Z" />
                    </svg>
                </button>
            </header>
            <main class="content" style="padding: 20px; font-family: 'Georgia', 'Times New Roman', serif;">
                <h2 id="journal-detail-title" style="margin-top: 0; font-size: 22px;"></h2>
                <p id="journal-detail-meta"
                    style="font-size: 12px; color: #aaa; border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 15px;">
                </p>
                <div id="journal-detail-content" style="line-height: 1.7; white-space: pre-wrap; font-size: 16px;">
                </div>
            </main>
        </div>

        <!-- Êî∂ËóèÂàóË°®ÁïåÈù¢ -->
        <div id="favorites-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="more-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">Êî∂Ëóè</h1>
                </div>
                <div class="placeholder"></div>
            </header>
            <div class="favorites-tabs">
                <button type="button" class="favorites-tab active" data-filter="user">ÊàëÁöÑÊî∂Ëóè</button>
                <button type="button" class="favorites-tab" data-filter="character">ËßíËâ≤Êî∂Ëóè</button>
            </div>
            <main class="content favorites-content">
                <div id="favorites-list-container" class="favorites-list-container">
                    <!-- ÊåâËßíËâ≤/Áæ§ËÅäÂàÜÁªÑÁöÑÊî∂ËóèÂç°ÁâáÁî± JS Ê∏≤Êüì -->
                </div>
                <div class="favorites-empty-placeholder" id="favorites-empty-placeholder" style="display: none;">
                    <div class="favorites-empty-icon">‚òÜ</div>
                    <p id="favorites-empty-text">ËøòÊ≤°ÊúâÊî∂Ëóè‰ªª‰ΩïÊ∂àÊÅØ</p>
                    <p class="favorites-empty-hint" id="favorites-empty-hint">Âú®ËÅäÂ§©‰∏≠ÈïøÊåâÊ∂àÊÅØÔºåÈÄâÊã©„ÄåÊî∂Ëóè„ÄçÊàñ„ÄåÂ§öÈÄâÊî∂Ëóè„ÄçÂç≥ÂèØÊ∑ªÂä†</p>
                </div>
            </main>
        </div>

        <!-- Êî∂ËóèËØ¶ÊÉÖÔºàÊü•ÁúãÂÜÖÂÆπ + Êî∂ËóèÂØÑËØ≠Ôºâ -->
        <div id="favorites-detail-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="favorites-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title" id="favorite-detail-title">Êî∂ËóèËØ¶ÊÉÖ</h1>
                </div>
                <div class="action-btn-group favorites-detail-actions">
                    <button class="btn btn-primary btn-small" id="favorite-detail-save-note-btn">‰øùÂ≠òÂØÑËØ≠</button>
                    <button class="btn btn-danger btn-small" id="favorite-detail-delete-btn" title="ÂèñÊ∂àÊî∂Ëóè">Âà†Èô§</button>
                </div>
            </header>
            <main class="content favorites-detail-content">
                <p id="favorite-detail-meta" class="favorite-detail-meta"></p>
                <div id="favorite-detail-content" class="favorite-detail-body"></div>
                <div class="favorite-detail-note-section">
                    <label class="favorite-detail-note-label">Êî∂ËóèÂØÑËØ≠</label>
                    <textarea id="favorite-detail-note" class="favorite-detail-note-input" placeholder="ÂÜô‰∏ÄÂè•ÊÉ≥ËÆ∞‰ΩèÁöÑËØù‚Ä¶" rows="3"></textarea>
                </div>
            </main>
        </div>

        <!-- Voice ID Selection Modal -->
        <div id="voice-id-modal" class="modal-overlay">
            <div class="modal-window" style="max-height: 80vh; overflow: hidden; display: flex; flex-direction: column;">
                <h3 style="margin: 0 0 15px 0;">ÈÄâÊã©ËØ≠Èü≥Èü≥Ëâ≤</h3>
                
                <!-- ÊêúÁ¥¢Ê°Ü -->
                <div style="margin-bottom: 15px;">
                    <input type="text" id="voice-search-input" placeholder="ÊêúÁ¥¢Èü≥Ëâ≤ÂêçÁß∞..." 
                        style="width: 100%; padding: 8px 12px; border: 1px solid #eee; border-radius: 8px; font-size: 14px;">
                </div>
                
                <!-- ÂàÜÁ±ªÊ†áÁ≠æ -->
                <div style="display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap;">
                    <button class="voice-lang-filter active" data-lang="all" style="padding: 4px 12px; border-radius: 16px; border: 1px solid #ddd; background: var(--primary-color); color: white; font-size: 12px; cursor: pointer;">ÂÖ®ÈÉ®</button>
                    <button class="voice-lang-filter" data-lang="‰∏≠Êñá" style="padding: 4px 12px; border-radius: 16px; border: 1px solid #ddd; background: white; font-size: 12px; cursor: pointer;">‰∏≠Êñá</button>
                    <button class="voice-lang-filter" data-lang="Ëã±Êñá" style="padding: 4px 12px; border-radius: 16px; border: 1px solid #ddd; background: white; font-size: 12px; cursor: pointer;">Ëã±Êñá</button>
                    <button class="voice-lang-filter" data-lang="Êó•Êñá" style="padding: 4px 12px; border-radius: 16px; border: 1px solid #ddd; background: white; font-size: 12px; cursor: pointer;">Êó•Êñá</button>
                    <button class="voice-lang-filter" data-lang="Èü©Êñá" style="padding: 4px 12px; border-radius: 16px; border: 1px solid #ddd; background: white; font-size: 12px; cursor: pointer;">Èü©Êñá</button>
                    <button class="voice-lang-filter" data-lang="ÂÖ∂‰ªñ" style="padding: 4px 12px; border-radius: 16px; border: 1px solid #ddd; background: white; font-size: 12px; cursor: pointer;">ÂÖ∂‰ªñ</button>
                </div>
                
                <!-- Èü≥Ëâ≤ÂàóË°® -->
                <div id="voice-list-container" style="flex: 1; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; padding: 10px; max-height: 400px;">
                    <!-- JS populated -->
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button type="button" id="voice-cancel-btn" class="btn btn-neutral" style="flex: 1;">ÂèñÊ∂à</button>
                    <button type="button" id="voice-confirm-btn" class="btn btn-primary" style="flex: 1;">Á°ÆÂÆö</button>
                </div>
            </div>
        </div>

        <!-- Peek Steps App Screen -->
        <div id="peek-steps-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="peek-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">Ê≠•Êï∞</h1>
                </div>
                <div class="placeholder"></div> <!-- To balance the header -->
            </header>
            <main class="content">
                <div class="steps-header">
                    <img src="https://i.postimg.cc/Y96LPskq/o-o-2.jpg" alt="Char Avatar" class="steps-header-avatar"
                        id="steps-char-avatar">
                    <span class="steps-header-name" id="steps-char-name">Char</span>
                </div>

                <div class="steps-progress-container">
                    <div class="steps-progress-circle" id="steps-progress-ring"></div>
                    <div class="steps-progress-inner">
                        <div class="steps-count" id="steps-current-count">4321</div>
                        <div class="steps-label">/ 6000 Ê≠•</div>
                    </div>
                </div>

                <div class="steps-module">
                    <h3 class="steps-module-title">ÊúÄËøëÊ¥ªÂä®ËΩ®Ëøπ</h3>
                    <ul class="activity-track-list" id="activity-track-list">
                        <li class="activity-track-item">10:00 AM - ÂíñÂï°È¶Ü</li>
                        <li class="activity-track-item">01:30 PM - Â∏Ç‰∏≠ÂøÉÂõæ‰π¶È¶Ü</li>
                        <li class="activity-track-item">06:00 PM - Ê≤≥ËæπÂÖ¨Âõ≠</li>
                        <li class="activity-track-item">07:00 PM - ÂÅ•Ë∫´Êàø</li>
                        <li class="activity-track-item">08:30 PM - Ë∂ÖÂ∏Ç</li>
                        <li class="activity-track-item">09:00 PM - ÂõûÂÆ∂</li>
                    </ul>
                </div>
                <div class="steps-annotation" id="steps-annotation-content">
                    ‚Äú‰ªäÂ§©Ëµ∞‰∫Ü‰∏çÂ∞ëË∑ØÔºå‰ΩÜÊÑüËßâÂæàÂÖÖÂÆû„ÄÇÁâπÂà´ÊòØ‰∏ãÂçàÂú®Âõæ‰π¶È¶ÜÊâæÂà∞ÁöÑÈÇ£Êú¨‰π¶ÔºåÊÑüËßâËÉΩÁúãÂæà‰πÖ„ÄÇ‚Äù
                </div>
            </main>
        </div>

        <div id="peek-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="chat-room-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">TaÁöÑÊâãÊú∫</h1>
                </div>
                <div class="action-btn-group">
                    <!-- Êñ∞Â¢ûÔºöÊ∏ÖÁ©∫Êï∞ÊçÆÊåâÈíÆ -->
                    <button class="action-btn" id="clear-peek-data-btn" title="Ê∏ÖÁ©∫ÊâÄÊúâÂÅ∑ÁúãÊï∞ÊçÆ">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" style="width: 22px; height: 22px;">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                            </path>
                        </svg>
                    </button>
                    <button class="action-btn" id="peek-settings-btn"><img
                            src="https://i.postimg.cc/nhwP4pQy/chan-73.png" alt="ËÆæÁΩÆ"></button>
                </div>
            </header>

            <main class="content" style="padding: 50px 0; justify-content: flex-start; align-items: center;">
                <!-- Content rendered by renderPeekScreen() -->
            </main>
        </div>

        <div id="forum-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="home-screen">‚Üê</button>
                <div class="title-container">
                    <h1 class="title">ËÆ∫Âùõ</h1>
                </div>

                <div class="action-btn-group"></div>
            </header>
            <main class="content" style="padding: 15px;">

                <div class="forum-search-bar">
                    <button class="action-btn" id="forum-link-btn" title="ÁªëÂÆö">
                        <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                            <path
                                d="M17 7h-4v2h4c1.65 0 3 1.35 3 3s-1.35 3-3 3h-4v2h4c2.76 0 5-2.24 5-5s-2.24-5-5-5zm-6 8H7c-1.65 0-3-1.35-3-3s1.35-3 3-3h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-2zm-3-4h8v2H8v-2z">
                            </path>
                        </svg>
                    </button>
                    <input type="text" id="forum-search-input" autocomplete="off" placeholder="ÊêúÁ¥¢ÂÖ≥ÈîÆËØç">
                    <button class="action-btn" id="forum-refresh-btn" title="Âà∑Êñ∞">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="22"
                            height="22">
                            <path
                                d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z">
                            </path>
                        </svg>
                    </button>
                </div>

                <div class="forum-filter-tabs">
                    <button class="forum-filter-tab active" data-filter="all">ÂÖ®ÈÉ®</button>
                    <button class="forum-filter-tab" data-filter="liked">ÊàëÁÇπËµûÁöÑ</button>
                    <button class="forum-filter-tab" data-filter="favorited">ÊàëÊî∂ËóèÁöÑ</button>
                </div>

                <div id="forum-posts-container">
                    <p class="placeholder-text" style="margin-top: 50px;">ÁÇπÂáªÂè≥‰∏äËßíÂà∑Êñ∞ÊåâÈíÆÊù•ÁîüÊàêÂ∏ñÂ≠ê...</p>
                </div>
            </main>
        </div>



        <div id="forum-post-detail-screen" class="screen">

        </div>

        <div id="forum-profile-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="forum-screen">&#8249;</button>
                <div class="title-container">
                    <h1 class="title">‰∏™‰∫∫ËµÑÊñô</h1>
                </div>
                <div class="action-btn-group">
                    <button type="button" class="btn btn-primary btn-small" id="save-forum-profile-btn">‰øùÂ≠ò</button>
                </div>
            </header>
            <main class="content">
                <div class="kkt-settings-container">
                    <div class="kkt-profile-section">
                        <img src="https://i.postimg.cc/GtbTnxhP/o-o-1.jpg" alt="" id="forum-user-avatar-display" class="kkt-profile-avatar">
                        <div class="kkt-profile-name" id="forum-user-name-display">Êú™ËÆæÁΩÆÊòµÁß∞</div>
                        <input type="file" id="forum-avatar-upload" accept="image/*" style="display:none;">
                    </div>
                    <div class="kkt-group">
                        <div class="kkt-item">
                            <div class="kkt-item-label">ÊòµÁß∞</div>
                            <div class="kkt-item-control">
                                <input type="text" id="forum-username-input" placeholder="ËØ∑ËæìÂÖ•ÊòµÁß∞" autocomplete="off" style="border:none; background:transparent; text-align:right;">
                            </div>
                        </div>
                    </div>
                    <div class="kkt-group">
                        <div class="kkt-group-title">‰∏™‰∫∫ÁÆÄ‰ªã</div>
                        <textarea id="forum-bio-input" placeholder="‰ªãÁªç‰∏Ä‰∏ãËá™Â∑±..." rows="4" style="width:100%; padding:10px; border:1px solid #e0e0e0; border-radius:8px; box-sizing:border-box;"></textarea>
                    </div>
                    <div class="kkt-group">
                        <div class="kkt-group-title">ÁªüËÆ°‰ø°ÊÅØ</div>
                        <div class="kkt-item">
                            <div class="kkt-item-label">ÂèëÂ∏ñÊï∞</div>
                            <div class="kkt-item-value" id="user-posts-count">0</div>
                        </div>
                        <div class="kkt-item">
                            <div class="kkt-item-label">ËØÑËÆ∫Êï∞</div>
                            <div class="kkt-item-value" id="user-comments-count">0</div>
                        </div>
                        <div class="kkt-item">
                            <div class="kkt-item-label">Ëé∑ËµûÊï∞</div>
                            <div class="kkt-item-value" id="user-likes-count">0</div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <div id="forum-settings-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="forum-screen">&#8249;</button>
                <div class="title-container">
                    <h1 class="title">ËÆ∫ÂùõËÆæÁΩÆ</h1>
                </div>
                <div class="placeholder"></div>
            </header>
            <main class="content">
                <div class="kkt-settings-container">
                    <div class="kkt-group">
                        <div class="kkt-group-title">ËÆ∫Âùõ‰∏ìÂ±ûAPIËÆæÁΩÆ</div>
                        <div class="kkt-item">
                            <div class="kkt-item-label">‰ΩøÁî®ËÆ∫Âùõ‰∏ìÂ±ûAPI</div>
                            <div class="kkt-item-control">
                                <label class="kkt-switch">
                                    <input type="checkbox" id="forum-use-api-toggle">
                                    <span class="kkt-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div id="forum-api-config-section" style="display:none;">
                            <div class="kkt-item">
                                <div class="kkt-item-label">APIÂú∞ÂùÄ</div>
                                <div class="kkt-item-control" style="flex:1;">
                                    <input type="text" id="forum-api-url-input" placeholder="https://api.example.com" style="width:100%;padding:8px;border:1px solid #e0e0e0;border-radius:8px;">
                                </div>
                            </div>
                            <div class="kkt-item">
                                <div class="kkt-item-label">APIÂØÜÈí•</div>
                                <div class="kkt-item-control" style="flex:1;">
                                    <input type="password" id="forum-api-key-input" placeholder="sk-..." style="width:100%;padding:8px;border:1px solid #e0e0e0;border-radius:8px;">
                                </div>
                            </div>
                            <div class="kkt-item">
                                <div class="kkt-item-label">Ê®°ÂûãÂàóË°®</div>
                                <div class="kkt-item-control">
                                    <button type="button" class="btn btn-small btn-secondary" id="forum-fetch-models-btn" style="margin:0; padding:4px 8px;">
                                        <span class="btn-text">ÊãâÂèñ</span>
                                        <div class="spinner"></div>
                                    </button>
                                </div>
                            </div>
                            <div class="kkt-item">
                                <div class="kkt-item-label">ÈÄâÊã©Ê®°Âûã</div>
                                <div class="kkt-item-control" style="flex:1;">
                                    <select id="forum-api-model-select" style="width:100%;padding:8px;border:1px solid #e0e0e0;border-radius:8px;text-align:right;direction:rtl;appearance:none;-webkit-appearance:none;padding-right:15px;">
                                        <option value="">ËØ∑ÂÖàÊãâÂèñ</option>
                                    </select>
                                    <span class="kkt-arrow">‚Ä∫</span>
                                </div>
                            </div>
                            <div class="kkt-item" style="flex-direction:column;align-items:stretch;padding-bottom:15px;">
                                <div style="display:flex;justify-content:space-between;margin-bottom:10px;">
                                    <div class="kkt-item-label">ÂõûÂ§çÈöèÊú∫ÊÄß (Temperature)</div>
                                    <span id="forum-temperature-value" style="color:var(--primary-color);font-weight:bold;">0.9</span>
                                </div>
                                <input type="range" id="forum-temperature-slider" min="0" max="2" step="0.1" value="0.9" style="width:100%;accent-color:var(--primary-color);">
                                <p style="font-size:12px;color:#999;margin-top:5px;margin-bottom:0;">Êï∞ÂÄºË∂äÂ§ßË∂äÈöèÊú∫ÔºåÊï∞ÂÄºË∂äÂ∞èË∂ä‰∏•Ë∞®„ÄÇ</p>
                            </div>
                        </div>
                    </div>
                    <div class="kkt-group">
                        <div class="kkt-group-title">AIÁîüÊàêËÆæÁΩÆ</div>
                        <div class="kkt-item">
                            <div class="kkt-item-label">‰∏™‰∫∫ËµÑÊñô</div>
                            <div class="kkt-item-control">
                                <button type="button" class="btn btn-primary" id="forum-goto-profile-btn" style="padding:6px 12px;">ÁºñËæë</button>
                            </div>
                        </div>
                        <div class="kkt-item">
                            <div class="kkt-item-label">‰∏ÄÊ¨°ÁîüÊàêÂ∏ñÂ≠êÊï∞</div>
                            <div class="kkt-item-control">
                                <input type="number" id="forum-posts-count-input" min="1" max="20" value="8" style="border:none; background:transparent; text-align:right; width:60px;">
                            </div>
                        </div>
                        <div class="kkt-item">
                            <div class="kkt-item-label">ËØÑËÆ∫Êï∞ÊúÄÂ∞èÂÄº</div>
                            <div class="kkt-item-control">
                                <input type="number" id="forum-comments-min-input" min="0" max="50" value="4" style="border:none; background:transparent; text-align:right; width:60px;">
                            </div>
                        </div>
                        <div class="kkt-item">
                            <div class="kkt-item-label">ËØÑËÆ∫Êï∞ÊúÄÂ§ßÂÄº</div>
                            <div class="kkt-item-control">
                                <input type="number" id="forum-comments-max-input" min="1" max="50" value="8" style="border:none; background:transparent; text-align:right; width:60px;">
                            </div>
                        </div>
                        <div class="kkt-item">
                            <div class="kkt-item-label">Áî®Êà∑ÂèëÂ∏ñÂêéAIËØÑËÆ∫Êï∞</div>
                            <div class="kkt-item-control">
                                <input type="number" id="forum-auto-reply-count-input" min="0" max="20" value="3" style="border:none; background:transparent; text-align:right; width:60px;">
                            </div>
                        </div>
                        <div class="kkt-item">
                            <div class="kkt-item-label">Â∏ñÂ≠êËØ¶ÊÉÖAIÂõûÂ§çÊï∞</div>
                            <div class="kkt-item-control">
                                <input type="number" id="forum-detail-reply-count-input" min="1" max="10" value="2" style="border:none; background:transparent; text-align:right; width:60px;">
                            </div>
                        </div>
                    </div>
                    <div class="kkt-group">
                        <button class="btn btn-primary" id="save-forum-settings-btn" style="width:100%;">‰øùÂ≠òËÆæÁΩÆ</button>
                    </div>
                </div>
            </main>
        </div>

        <div id="forum-dm-list-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="forum-screen">&#8249;</button>
                <div class="title-container">
                    <h1 class="title">ÁßÅ‰ø°</h1>
                </div>
                <div class="forum-dm-header-actions" style="display:flex;align-items:center;gap:4px;">
                    <button type="button" class="app-header-icon-only" id="forum-dm-list-refresh-btn" title="ÁîüÊàêÈôåÁîü‰∫∫ÁßÅ‰ø°">
                        <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 4v6h-6"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
                    </button>
                    <button type="button" class="app-header-icon-only" id="forum-dm-list-delete-btn" title="Âà†Èô§ÂØπËØù">
                        <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/></svg>
                    </button>
                </div>
            </header>
            <div id="forum-dm-delete-toolbar" class="forum-dm-delete-toolbar" style="display:none;">
                <button type="button" class="btn btn-neutral btn-small" id="forum-dm-select-all-btn">ÂÖ®ÈÄâ</button>
                <button type="button" class="btn btn-danger btn-small" id="forum-dm-delete-selected-btn">Âà†Èô§ÈÄâ‰∏≠</button>
                <button type="button" class="btn btn-neutral btn-small" id="forum-dm-cancel-delete-btn">ÂèñÊ∂à</button>
            </div>
            <main class="content">
                <ul class="list-container" id="forum-dm-list-container"></ul>
            </main>
        </div>

        <div id="forum-dm-conversation-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="forum-dm-list-screen">&#8249;</button>
                <div class="title-container">
                    <h1 class="title" id="forum-dm-conversation-title">ÁßÅ‰ø°ÂØπËØù</h1>
                </div>
                <div class="placeholder"></div>
            </header>
            <main class="content">
                <div class="message-area" id="forum-dm-message-area"></div>
            </main>
            <div class="chat-input-wrapper">
                <div class="message-input-area">
                    <div class="input-wrapper">
                        <input type="text" id="forum-dm-input" autocomplete="off" placeholder="ÂèëÈÄÅÁßÅ‰ø°...">
                    </div>
                    <button id="ai-reply-dm-btn" class="icon-btn ai-reply-btn" title="AIÂõûÂ§ç">
                        <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            <path d="M8 10h.01M12 10h.01M16 10h.01"></path>
                        </svg>
                    </button>
                    <button id="send-forum-dm-btn" class="icon-btn send-btn circle-bg">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- ÁºñËæëËÆ∫ÂùõÁßÅ‰ø°ÂºπÁ™ó -->
        <div id="forum-dm-edit-modal" class="modal-overlay">
            <div class="modal-window">
                <h3>ÁºñËæëÁßÅ‰ø°</h3>
                <form id="forum-dm-edit-form">
                    <div class="form-group">
                        <textarea id="forum-dm-edit-textarea" rows="6" style="width:100%; resize:vertical; padding:10px; border-radius:8px; border:1px solid #ddd;"></textarea>
                    </div>
                    <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:15px;">
                        <button type="button" class="btn btn-neutral btn-small" id="forum-dm-edit-cancel-btn">ÂèñÊ∂à</button>
                        <button type="button" class="btn btn-danger btn-small" id="forum-dm-edit-delete-btn">Âà†Èô§</button>
                        <button type="submit" class="btn btn-primary btn-small">‰øùÂ≠ò</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="storage-analysis-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="home-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">Â≠òÂÇ®ÂàÜÊûê</h1>
                </div>
                <div class="placeholder"></div>
            </header>
            <main class="content"
                style="flex-direction: column; justify-content: flex-start; padding: 20px; gap: 20px;">
                <div id="storage-chart-container" style="width: 100%; height: 300px; flex-shrink: 0;"></div>
                <div id="storage-total-size-container"
                    style="text-align: center; padding: 10px 0; border-bottom: 1px solid #f0f0f0; margin-bottom: 10px;">
                    <span style="font-size: 14px; color: #888;">ÊÄªÂç†Áî®Á©∫Èó¥</span>
                    <h2 id="storage-total-size"
                        style="margin: 4px 0 0 0; font-size: 24px; color: #333; font-weight: 600;">---</h2>
                </div>
                <div id="storage-details-list" style="width: 100%; overflow-y: auto;"></div>
                <!-- ÁßªÂä®Á´ØÊéßÂà∂Âè∞ÔºöÁÇπÂáªÂ±ïÂºÄÊü•ÁúãÊó•Âøó/Êä•Èîô/Ë≠¶Âëä -->
                <div id="storage-console-widget" class="storage-console-widget">
                    <button type="button" id="storage-console-bar" class="storage-console-bar" aria-expanded="false">
                        <span class="storage-console-bar-icon">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="4" width="20" height="16" rx="2"/>
                                <path d="M6 8h.01M10 8h.01M14 8h.01"/>
                                <path d="M6 12h12M6 16h8"/>
                            </svg>
                        </span>
                        <span class="storage-console-bar-label">ÊéßÂà∂Âè∞</span>
                        <span class="storage-console-bar-counts">
                            <span class="storage-console-count storage-console-count-log" id="storage-console-count-log" title="Êó•Âøó">0</span>
                            <span class="storage-console-count storage-console-count-warn" id="storage-console-count-warn" title="Ë≠¶Âëä">0</span>
                            <span class="storage-console-count storage-console-count-error" id="storage-console-count-error" title="Êä•Èîô">0</span>
                        </span>
                        <span class="storage-console-bar-chevron">
                            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                        </span>
                    </button>
                    <div id="storage-console-panel" class="storage-console-panel" hidden>
                        <div class="storage-console-tabs">
                            <button type="button" class="storage-console-tab active" data-filter="all">ÂÖ®ÈÉ®</button>
                            <button type="button" class="storage-console-tab" data-filter="log">Êó•Âøó</button>
                            <button type="button" class="storage-console-tab" data-filter="warn">Ë≠¶Âëä</button>
                            <button type="button" class="storage-console-tab" data-filter="error">Êä•Èîô</button>
                        </div>
                        <div class="storage-console-panel-header">
                            <span class="storage-console-filter-label">ÂÖ®ÈÉ®</span>
                            <button type="button" id="storage-console-clear-btn" class="storage-console-clear-btn">Ê∏ÖÁ©∫</button>
                        </div>
                        <div id="storage-console-list" class="storage-console-list"></div>
                    </div>
                </div>
            </main>
        </div>



        <div id="peek-messages-screen" class="screen">

            <header class="app-header">
                <button class="back-btn" data-target="peek-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">TaÁöÑÊ∂àÊÅØ</h1>
                </div>
                <button class="action-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="22"
                        height="22">
                        <path
                            d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z">
                        </path>
                    </svg>
                </button>
            </header>
            <main class="content">
                <ul class="list-container" id="peek-chat-list-container">
                    <!-- Simulated chat list will be rendered here -->
                </ul>
            </main>
        </div>

        <!-- Peek Conversation Screen -->
        <div id="peek-conversation-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="peek-messages-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title" id="peek-conversation-title">...</h1>
                </div>
                <button class="action-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="22"
                        height="22">
                        <path
                            d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z">
                        </path>
                    </svg>
                </button>
            </header>
            <main class="content">
                <div class="message-area" id="peek-message-area">
                    <!-- Simulated messages will be rendered here -->
                </div>
            </main>
        </div>

        <!-- Peek Memos Screen -->
        <div id="peek-memos-screen" class="screen"></div>

        <!-- Peek Memo Detail Screen -->
        <div id="peek-memo-detail-screen" class="screen"></div>

        <!-- Peek Cart Screen -->
        <div id="peek-cart-screen" class="screen"></div>

        <!-- Peek Transfer Station Screen -->
        <div id="peek-transfer-station-screen" class="screen"></div>

        <!-- Peek Browser Screen -->
        <div id="peek-browser-screen" class="screen"></div>

        <!-- Peek Drafts Screen -->
        <div id="peek-drafts-screen" class="screen"></div>

        <!-- Peek Wallet Screen (Èí±ÂåÖ) -->
        <div id="peek-wallet-screen" class="screen"></div>

        <div id="peek-album-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="peek-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">Áõ∏ÂÜå</h1>
                </div>
                <button class="action-btn" id="refresh-album-btn"><svg xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24" fill="currentColor" width="22" height="22">
                        <path
                            d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z">
                        </path>
                    </svg></button>
            </header>
            <main class="content">
                <div class="album-grid">
                    <p class="placeholder-text">Ê≠£Âú®ÁîüÊàêÁõ∏ÂÜåÂÜÖÂÆπ...</p>
                </div>
            </main>
        </div>

        <!-- Peek Unlock Screen (Social Media) -->
        <div id="peek-unlock-screen" class="screen">
            <!-- Content will be dynamically rendered by renderPeekUnlock() -->
        </div>

        <!-- Peek Unlock Post Detail (single post with comments) -->
        <div id="peek-unlock-post-detail-screen" class="screen">
            <!-- Content will be dynamically rendered by renderPeekUnlockPostDetail() -->
        </div>

        <!-- Peek Time Thoughts (Êó∂ÂÖâÊÉ≥ËØ¥ - ‰æøÁ≠æÂ¢ô) -->
        <div id="peek-time-thoughts-screen" class="screen">
            <!-- Content will be dynamically rendered by renderPeekTimeThoughts() -->
        </div>

        <div id="peek-confirm-modal" class="modal-overlay">
            <div class="modal-window">
                <h3>Ë¶ÅÂÅ∑ÁúãtaÁöÑÊâãÊú∫ÂêóÔºü</h3>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button id="peek-confirm-yes" class="btn btn-primary" style="flex: 1;">ÊòØ</button>
                    <button id="peek-confirm-no" class="btn btn-neutral" style="flex: 1;">Âê¶</button>
                </div>
            </div>
        </div>

        <!-- Video Call Screens & Modals -->

        <!-- SCENE 1: Âä†ËΩΩ/ËøûÁ∫øÁïåÈù¢ -->
        <div id="vc-scene-loading" class="vc-scene vc-hidden">
            <div class="vc-loading-top-bar">
                <button type="button" class="vc-loading-minimize-btn" id="vc-loading-minimize-btn" title="ÊúÄÂ∞èÂåñ">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-1 9h-6c-.55 0-1-.45-1-1V5h7v7z"/></svg>
                </button>
            </div>
            <div class="vc-center-wrapper">
                <div class="vc-connection-wrapper">
                    <!-- AI -->
                    <div class="vc-avatar-box">
                        <div class="vc-avatar ai" id="vc-loading-char-avatar"></div>
                        <div class="vc-avatar-label" id="vc-loading-char-name" style="color:var(--vc-ai-color)">AI</div>
                    </div>

                    <!-- ‰ø°Âè∑Ê°• -->
                    <div class="vc-signal-bridge">
                        <svg class="vc-ekg-svg" viewBox="0 0 100 40" preserveAspectRatio="none">
                            <defs>
                                <linearGradient id="vcSignalGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:var(--vc-ai-color); stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:var(--vc-user-color); stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <path class="vc-ekg-line"
                                d="M0,20 L10,20 L15,5 L20,35 L25,20 L40,20 L45,10 L50,30 L55,20 L75,20 L80,5 L85,35 L90,20 L100,20" />
                            <path class="vc-ekg-line ghost"
                                d="M0,20 L10,20 L15,8 L20,32 L25,20 L40,20 L45,12 L50,28 L55,20 L75,20 L80,8 L85,32 L90,20 L100,20" />
                        </svg>
                    </div>

                    <!-- User -->
                    <div class="vc-avatar-box">
                        <div class="vc-avatar user" id="vc-loading-user-avatar"></div>
                        <div class="vc-avatar-label" style="color:var(--vc-user-color)">YOU</div>
                    </div>
                </div>

                <!-- Áä∂ÊÄÅÊñáÂ≠óÂå∫ -->
                <div class="vc-status-display">
                    <div class="vc-status-text" id="vc-status-main">Ê≠£Âú®Âª∫Á´ãÈÄöËØù‰∏ìÁ∫ø...</div>
                    <div class="vc-sub-status" id="vc-status-sub">HANDSHAKE_INIT</div>
                </div>
            </div>

            <!-- Â∫ïÈÉ®ÔºöÊåâÈíÆÊîæÂú®Â§ñÈù¢Ôºå‰øùÊåÅÂú®Â±èÂπïÂ∫ïÈÉ® -->
            <div class="vc-loading-footer">
                <div class="vc-c-btn vc-btn-hangup" id="vc-loading-hangup-btn">
                    <div class="vc-c-icon-box">
                        <div class="vc-icon-hangup"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SCENE 2: ÈÄöËØùÁïåÈù¢ -->
        <div id="vc-scene-call" class="vc-scene vc-hidden">
            <div class="vc-call-header">
                <div class="vc-contact-info">
                    <div class="name" id="vc-call-name">Unknown</div>
                    <div class="time" id="vc-call-timer">00:00:00</div>
                </div>
                <div class="vc-header-avatar" id="vc-call-avatar">
                    <div class="vc-online-dot"></div>
                </div>
            </div>

            <div class="vc-chat-area" id="vc-chat-container">
                <!-- Ëá™Âä®ÊèíÂÖ•ÁöÑÁ¨¨‰∏ÄÊù°Ê∂àÊÅØ -->
            </div>

            <div class="vc-controls-wrapper">
                <div class="vc-controls">
                    <div class="vc-c-btn" id="vc-camera-toggle-btn">
                        <div class="vc-c-icon-box">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                                class="bi bi-camera-video" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5zm11.5 5.175 3.5 1.556V4.269l-3.5 1.556v4.35zM2 4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H2z" />
                            </svg>
                        </div>
                        <span class="vc-c-label">Camera</span>
                    </div>
                    <div class="vc-c-btn" id="vc-action-voice-btn">
                        <div class="vc-c-icon-box">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                                class="bi bi-mic" viewBox="0 0 16 16">
                                <path
                                    d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5z" />
                                <path
                                    d="M10 8a2 2 0 1 1-4 0V3a2 2 0 1 1 4 0v5zM8 0a3 3 0 0 0-3 3v5a3 3 0 0 0 6 0V3a3 3 0 0 0-3-3z" />
                            </svg>
                        </div>
                        <span class="vc-c-label">Speak</span>
                    </div>
                    <div class="vc-c-btn vc-btn-hangup" id="vc-call-hangup-btn">
                        <div class="vc-c-icon-box">
                            <div class="vc-icon-hangup"></div>
                        </div>
                        <span class="vc-c-label">End</span>
                    </div>
                </div>
            </div>

            <!-- ÈÄöËØùËæìÂÖ•Ê°ÜË¶ÜÁõñÂ±Ç -->
            <div id="vc-input-overlay" class="vc-input-overlay" style="display: none;">
                <div class="vc-input-box">
                    <input type="text" id="vc-input-text" placeholder="ËæìÂÖ•‰Ω†ÊÉ≥ËØ¥ÁöÑËØù..." autocomplete="off">
                    <button id="vc-input-help-btn" title="‰ΩøÁî®ËØ¥Êòé">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                            <path
                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Call Type Selection Modal -->
        <div id="vc-type-modal" class="vc-type-modal">
            <div class="vc-type-sheet">
                <div class="vc-type-header">
                    <span class="vc-type-title">ÂèëËµ∑ÈÄöËØù</span>
                    <button class="vc-type-close" id="vc-type-close-btn">√ó</button>
                </div>

                <button class="vc-type-btn video" id="vc-start-video-btn">
                    <div class="vc-type-icon">üìπ</div>
                    <div class="vc-type-info">
                        <span class="vc-type-label">ËßÜÈ¢ëÈÄöËØù</span>
                        <span class="vc-type-desc">Ê≤âÊµ∏ÂºèËßÜËßâ‰ΩìÈ™å</span>
                    </div>
                </button>

                <button class="vc-type-btn voice" id="vc-start-voice-btn">
                    <div class="vc-type-icon">üìû</div>
                    <div class="vc-type-info">
                        <span class="vc-type-label">ËØ≠Èü≥ÈÄöËØù</span>
                        <span class="vc-type-desc">‰ªÖÂ£∞Èü≥‰∫§ÊµÅ</span>
                    </div>
                </button>

                <button class="vc-type-btn history" id="vc-history-btn">
                    <div class="vc-type-icon">üìú</div>
                    <div class="vc-type-info">
                        <span class="vc-type-label">ÈÄöËØùËÆ∞ÂΩï</span>
                        <span class="vc-type-desc">Êü•ÁúãËøáÂæÄËÆ∞ÂΩï</span>
                    </div>
                </button>
            </div>
        </div>

        <!-- Call History Modal -->
        <div id="vc-history-modal" class="vc-type-modal">
            <div class="vc-type-sheet" style="height: 70vh;">
                <div class="vc-type-header">
                    <span class="vc-type-title">ÈÄöËØùËÆ∞ÂΩï</span>
                    <button class="vc-type-close" id="vc-history-close-btn">√ó</button>
                </div>
                <div id="vc-history-list" class="vc-history-list">
                    <!-- JS populated -->
                    <div class="vc-history-empty">ÊöÇÊó†ÈÄöËØùËÆ∞ÂΩï</div>
                </div>
            </div>
        </div>

        <!-- Call Detail Modal -->
        <div id="vc-detail-modal" class="vc-type-modal">
            <div class="vc-type-sheet" style="height: 80vh;">
                <div class="vc-type-header">
                    <button class="vc-type-close" id="vc-detail-back-btn" style="font-size: 18px;">‚Äπ ËøîÂõû</button>
                    <span class="vc-type-title">ÈÄöËØùËØ¶ÊÉÖ</span>
                    <button class="vc-type-close" id="vc-detail-close-btn">√ó</button>
                </div>
                <div id="vc-detail-content" class="vc-detail-content">
                    <!-- JS populated -->
                </div>
            </div>
        </div>

        <!-- Incoming Call Notification (iOS Style) -->
        <div id="vc-incoming-modal" class="vc-incoming-overlay">
            <div class="vc-incoming-banner">
                <div class="vc-incoming-content">
                    <div class="vc-incoming-avatar" id="vc-incoming-avatar"></div>
                    <div class="vc-incoming-info">
                        <div class="vc-incoming-name" id="vc-incoming-name">Unknown</div>
                        <div class="vc-incoming-type" id="vc-incoming-type">ËßÜÈ¢ëÈÄöËØùÈÇÄËØ∑...</div>
                    </div>
                </div>
                <div class="vc-incoming-actions">
                    <button class="vc-incoming-btn reject" id="vc-incoming-reject-btn">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                            <path
                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11H7v-2h10v2z" />
                        </svg>
                    </button>
                    <button class="vc-incoming-btn accept" id="vc-incoming-accept-btn">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Floating Window (Mini Mode) -->
        <div id="vc-floating-window" class="vc-floating-window" style="display: none;">
            <div class="vc-float-avatar" id="vc-float-avatar"></div>
            <div class="vc-float-status" id="vc-float-status">Ê≠£Âú®ËøûÁ∫ø...</div>
            <div class="vc-float-timer" id="vc-float-timer">00:00</div>
        </div>

        <!-- New Peek Wallpaper Modal -->
        <div id="peek-wallpaper-modal" class="modal-overlay">
            <div class="modal-window" style="max-height: 80vh; overflow-y: auto;">
                <h3>‚ÄúÂÅ∑Áúã‚ÄùÈ°µÈù¢Ëá™ÂÆö‰πâ</h3>
                <div class="collapsible-section open">
                    <div class="collapsible-header">
                        <h4>È°µÈù¢Â£ÅÁ∫∏</h4>
                        <span class="collapsible-arrow">‚ñº</span>
                    </div>
                    <div class="collapsible-content">
                        <form id="peek-wallpaper-form">
                            <div class="form-group">
                                <label for="peek-wallpaper-url-input">Â£ÅÁ∫∏URL</label>
                                <input type="url" id="peek-wallpaper-url-input" class="form-group"
                                    placeholder="Á≤òË¥¥ÂõæÁâáURL">
                            </div>
                            <p style="text-align:center; color:#888; margin: -10px 0 15px;">Êàñ</p>
                            <input type="file" id="peek-wallpaper-upload" accept="image/*" style="display: none;">
                            <label for="peek-wallpaper-upload" class="btn btn-secondary">‰ªéÊú¨Âú∞‰∏ä‰º†</label>
                        </form>
                    </div>
                </div>
                <div class="collapsible-section">
                    <div class="collapsible-header">
                        <h4>Â∫îÁî®ÂõæÊ†á</h4>
                        <span class="collapsible-arrow">‚ñº</span>
                    </div>
                    <div class="collapsible-content" id="peek-app-icons-settings">
                        <!-- App icon settings will be rendered here by JS -->
                    </div>
                </div>
                <div class="collapsible-section">
                    <div class="collapsible-header">
                        <h4>ÂæÆÂçö(Unlock)Â∞èÂè∑</h4>
                        <span class="collapsible-arrow">‚ñº</span>
                    </div>
                    <div class="collapsible-content">
                        <div class="form-group">
                            <label for="peek-unlock-avatar-url">Â§¥ÂÉèURL</label>
                            <input type="url" id="peek-unlock-avatar-url" class="form-group" placeholder="Á≤òË¥¥ÂõæÁâáURL">
                        </div>
                        <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="peek-unlock-comments-enabled" style="width: auto;">
                            <label for="peek-unlock-comments-enabled" style="margin: 0;">Êü•ÊâãÊú∫Êó∂Ëá™Âä®ÁîüÊàêÂ∞èÂè∑Â∏ñÂ≠ê‰∏ãÁöÑËØÑËÆ∫</label>
                        </div>
                    </div>
                </div>
                <div class="collapsible-section">
                    <div class="collapsible-header">
                        <h4>ÊâπÈáèÊìç‰Ωú</h4>
                        <span class="collapsible-arrow">‚ñº</span>
                    </div>
                    <div class="collapsible-content">
                        <p style="color: #888; font-size: 14px; margin-bottom: 15px;">
                            ‰∏ÄÊ¨°ÊÄßÂà∑Êñ∞ÊâÄÊúâÂ∫îÁî®ÁöÑÂÜÖÂÆπ„ÄÇÊ≥®ÊÑèÔºöËøôÂ∞ÜÊ∂àËÄóÂ§öÊ¨° API Ë∞ÉÁî®ÔºåËØ∑ÁïôÊÑèÊÇ®ÁöÑ API È¢ùÂ∫¶„ÄÇ
                        </p>
                        <button id="refresh-all-peek-apps-btn" class="btn btn-secondary" style="width: 100%; margin-bottom: 10px;">ÂÖ®ÈÉ®Âà∑Êñ∞</button>
                        <button id="manage-peek-data-btn" class="btn btn-neutral" style="width: 100%;">ÁÆ°ÁêÜÂ∑≤Âà∑Êñ∞Êï∞ÊçÆ</button>
                    </div>
                </div>
                <button id="save-peek-settings-btn" class="btn btn-primary" style="margin-top: 20px;">‰øùÂ≠òÊâÄÊúâÊõ¥Êîπ</button>
            </div>
        </div>
        <!-- Peek Data Management Modal -->
        <div id="peek-data-management-modal" class="modal-overlay" style="z-index: 10002;">
            <div class="modal-window" style="max-width: 400px;">
                <h3>ÁÆ°ÁêÜÂÅ∑ÁúãÊï∞ÊçÆ</h3>
                <p style="color: #888; font-size: 13px; margin-bottom: 15px;">
                    Âà†Èô§Â∑≤Âà∑Êñ∞ÁöÑÂ∫îÁî®Êï∞ÊçÆÔºå‰∏ãÊ¨°ÁÇπÂáªÂ∫îÁî®Êó∂Â∞ÜÈáçÊñ∞ÁîüÊàê„ÄÇ
                </p>
                <div id="peek-data-list" style="max-height: 300px; overflow-y: auto; border: 1px solid #eee; border-radius: 6px; padding: 10px; margin-bottom: 15px; background: #fafafa;">
                    <!-- Âä®ÊÄÅÁîüÊàêÁöÑÂ∫îÁî®ÂàóË°® -->
                </div>
                <div style="display: flex; gap: 10px;">
                    <button id="delete-selected-peek-data-btn" class="btn btn-primary" style="flex: 1;">Âà†Èô§ÈÄâ‰∏≠</button>
                    <button id="delete-all-peek-data-btn" class="btn btn-danger" style="flex: 1;">ÂÖ®ÈÉ®Âà†Èô§</button>
                </div>
                <button id="close-peek-data-management-btn" class="btn btn-neutral" style="width: 100%; margin-top: 10px;">ÂèñÊ∂à</button>
            </div>
        </div>
        <div id="piggy-bank-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="home-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">Â≠òÈí±ÁΩê</h1>
                </div>
                <div class="action-btn-group"></div>
            </header>
            <main class="content piggy-bank-content">
                <div class="piggy-bank-balance-card">
                    <div class="piggy-bank-balance-label">ÂΩìÂâç‰ΩôÈ¢ù</div>
                    <div class="piggy-bank-balance-value" id="piggy-bank-balance-display">520</div>
                    <div class="piggy-bank-balance-actions">
                        <button type="button" class="btn btn-primary piggy-btn-add" id="piggy-bank-add-btn">Â≠òÂÖ•</button>
                        <button type="button" class="btn btn-neutral piggy-btn-edit" id="piggy-bank-edit-btn">‰øÆÊîπ‰ΩôÈ¢ù</button>
                    </div>
                </div>
                <div class="piggy-bank-tabs">
                    <button type="button" class="piggy-tab active" data-piggy-tab="all">ÂÖ®ÈÉ®</button>
                    <button type="button" class="piggy-tab" data-piggy-tab="income">Êî∂ÂÖ•</button>
                    <button type="button" class="piggy-tab" data-piggy-tab="expense">ÊîØÂá∫</button>
                </div>
                <ul class="piggy-bank-list" id="piggy-bank-transaction-list"></ul>
                <p class="piggy-bank-empty" id="piggy-bank-empty-hint" style="display: none;">ÊöÇÊó†Êî∂ÊîØËÆ∞ÂΩï</p>
            </main>
        </div>
        <!-- Â≠òÂÖ• / ‰øÆÊîπ‰ΩôÈ¢ù ÂºπÁ™ó -->
        <div id="piggy-bank-balance-modal" class="modal-overlay">
            <div class="modal-window">
                <h3 id="piggy-bank-modal-title">Â≠òÂÖ•</h3>
                <form id="piggy-bank-balance-form">
                    <div class="form-group">
                        <label for="piggy-bank-amount-input">ÈáëÈ¢ù (ÂÖÉ)</label>
                        <input type="number" id="piggy-bank-amount-input" placeholder="0.00" step="0.01" min="0">
                    </div>
                    <div class="form-group" id="piggy-bank-remark-group">
                        <label for="piggy-bank-remark-input">Â§áÊ≥®ÔºàÈÄâÂ°´Ôºâ</label>
                        <input type="text" id="piggy-bank-remark-input" placeholder="‰æãÂ¶ÇÔºöÂ∑•ËµÑ„ÄÅÁ∫¢ÂåÖ">
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button type="button" class="btn btn-neutral" id="piggy-bank-modal-cancel" style="flex:1;">ÂèñÊ∂à</button>
                        <button type="submit" class="btn btn-primary" id="piggy-bank-modal-submit" style="flex:1;">Á°ÆÂÆö</button>
                    </div>
                </form>
            </div>
        </div>
        <div id="pomodoro-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="home-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">‰∏ìÊ≥®‰ªªÂä°</h1>
                </div>
                <div class="action-btn-group">
                    <button class="action-btn" id="pomodoro-settings-btn" title="ËÆæÁΩÆ">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="22"
                            height="22">
                            <path
                                d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.44,0.17-0.48,0.41L9.2,5.77C8.61,6.01,8.08,6.33,7.58,6.71L5.19,5.75C4.97,5.68,4.72,5.75,4.6,5.97L2.68,9.29 c-0.11,0.2-0.06,0.47,0.12,0.61l2.03,1.58C4.78,11.66,4.76,11.97,4.76,12.3c0,0.32,0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.04,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.48-0.41l0.36-2.54c0.59-0.24,1.12-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0.01,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z" />
                        </svg>
                    </button>
                    <button class="action-btn" id="pomodoro-create-task-btn" title="ÂàõÂª∫‰ªªÂä°">+</button>
                </div>
            </header>
            <main class="content">
                <div class="task-list-container" id="pomodoro-task-list">
                    <!-- Task cards will be rendered here by JS -->
                </div>
                <p class="placeholder-text" id="pomodoro-no-tasks-placeholder">ËøòÊ≤°Êúâ‰∏ìÊ≥®‰ªªÂä°ÔºåÁÇπÂáªÂè≥‰∏äËßí‚Äú+‚ÄùÂàõÂª∫‰∏Ä‰∏™Âêß„ÄÇ</p>
            </main>
        </div>
        <!-- Pomodoro Focus Screen -->
        <div id="pomodoro-focus-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="pomodoro-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">‰∏ìÊ≥®‰∏≠</h1>
                </div>
                <div class="action-btn-group">
                    <button class="action-btn" id="pomodoro-focus-settings-btn" title="ËÆæÁΩÆ">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="22"
                            height="22">
                            <path
                                d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.44,0.17-0.48,0.41L9.2,5.77C8.61,6.01,8.08,6.33,7.58,6.71L5.19,5.75C4.97,5.68,4.72,5.75,4.6,5.97L2.68,9.29 c-0.11,0.2-0.06,0.47,0.12,0.61l2.03,1.58C4.78,11.66,4.76,11.97,4.76,12.3c0,0.32,0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.04,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.48-0.41l0.36-2.54c0.59-0.24,1.12-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0.01,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z" />
                        </svg>
                    </button>
                </div>
            </header>
            <main class="content">
                <div class="focus-timer-container">
                    <h2 class="focus-task-title">ÈòÖËØª‰∏ÄÁ´†„ÄäJavaScriptÈ´òÁ∫ßÁ®ãÂ∫èËÆæËÆ°„Äã</h2>
                    <div class="focus-timer-display">24:32</div>
                    <div class="focus-timer-mode">ÂÄíËÆ°Êó∂</div>
                    <div class="focus-total-time" id="pomodoro-total-focused-time">Â∑≤‰∏ìÊ≥® 0 ÂàÜÈíü</div>
                </div>

                <div class="focus-footer">
                    <div class="focus-message-bubble">
                        <p>‰øùÊåÅ‰∏ìÊ≥®Ôºå‰Ω†ÂÅöÂæóÂæàÂ•ΩÔºÅ</p>
                    </div>
                    <div class="focus-bottom-controls">
                        <div class="focus-controls-group">
                            <button class="control-btn" id="pomodoro-start-btn" title="ÂºÄÂßã">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"
                                    stroke="currentColor" stroke-width="0">
                                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                                </svg>
                            </button>
                            <button class="control-btn" id="pomodoro-pause-btn" title="ÊöÇÂÅú" style="display: none;">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"
                                    stroke="currentColor" stroke-width="1">
                                    <rect x="6" y="4" width="4" height="16"></rect>
                                    <rect x="14" y="4" width="4" height="16"></rect>
                                </svg>
                            </button>
                        </div>
                        <img src="https://i.postimg.cc/Y96LPskq/o-o-2.jpg" class="focus-avatar" alt="avatar">
                        <button class="control-btn" id="pomodoro-giveup-btn" title="ÊîæÂºÉ">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                </div>
            </main>
        </div>

        <!-- Shop Screen -->
        <div id="shop-screen" class="screen">
            <header class="app-header">
                <button class="back-btn" data-target="chat-room-screen">‚Äπ</button>
                <div class="title-container">
                    <h1 class="title">ÂïÜÂüé</h1>
                </div>
                <div class="action-btn-group">
                    <button class="action-btn" id="shop-refresh-btn" title="ÈáçÊñ∞ËøõË¥ß">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" style="width: 22px; height: 22px;">
                            <path d="M23 4v6h-6"></path>
                            <path d="M1 20v-6h6"></path>
                            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                        </svg>
                    </button>
                    <button class="action-btn" id="shop-more-btn" title="Êõ¥Â§ö">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" style="width: 24px; height: 24px;">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                </div>
            </header>
            <div class="shop-tabs"></div>
            <main class="content" id="shop-content-container"></main>
            <div id="shop-delivery-modal" class="modal-overlay">
                <div class="modal-window">
                    <h3 id="shop-delivery-item-name">Á°ÆËÆ§ËÆ¢Âçï</h3>
                    <p style="color: #666; font-size: 14px; margin-bottom: 15px;">ËØ∑ÈÄâÊã©ÈÖçÈÄÅÊñπÂºèÔºö</p>
                    <div class="delivery-options">
                        <div class="delivery-option-card active" data-type="timed"
                            onclick="selectDeliveryOption('timed')">
                            <div class="delivery-icon">üõµ</div>
                            <div class="delivery-info">
                                <div class="delivery-title">ÂÆöÊó∂ÈÄÅËææ</div>
                                <div class="delivery-desc">È¢ÑËÆ° 30 ÂàÜÈíüÂÜÖÈÄÅËææ</div>
                            </div>
                            <div class="delivery-check"></div>
                        </div>
                        <div class="delivery-option-card" data-type="instant" onclick="selectDeliveryOption('instant')">
                            <div class="delivery-icon">‚ö°</div>
                            <div class="delivery-info">
                                <div class="delivery-title">Âç≥Êó∂ÈÄÅËææ</div>
                                <div class="delivery-desc">Âä†ÊÄ•ÈÖçÈÄÅÔºåÁ´ãÂç≥ÈÄÅÂá∫</div>
                            </div>
                            <div class="delivery-check"></div>
                        </div>
                        <div class="delivery-option-card" data-type="pickup" onclick="selectDeliveryOption('pickup')">
                            <div class="delivery-icon">üè™</div>
                            <div class="delivery-info">
                                <div class="delivery-title">Èó®Â∫óËá™Êèê</div>
                                <div class="delivery-desc">Âá≠Âè£‰ª§Âà∞Â∫óÈ¢ÜÂèñ</div>
                            </div>
                            <div class="delivery-check"></div>
                        </div>
                        <div class="delivery-option-card" data-type="pay-for-me"
                            onclick="selectDeliveryOption('pay-for-me')">
                            <div class="delivery-icon">ü•∫</div>
                            <div class="delivery-info">
                                <div class="delivery-title">ËÆ©Ta‰π∞Âçï</div>
                                <div class="delivery-desc">ÂèëÈÄÅ‰ª£‰ªòËØ∑Ê±Ç</div>
                            </div>
                            <div class="delivery-check"></div>
                        </div>
                    </div>

                    <div id="pickup-code-input-container" style="display: none; margin-top: 15px;">
                        <label style="font-size: 12px; color: #666; display: block; margin-bottom: 5px;">Ëá™ÊèêÂè£‰ª§</label>
                        <input type="text" id="shop-pickup-code" placeholder="ËæìÂÖ•ÂèñË¥ßÁ†Å/Âè£‰ª§"
                            style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; outline: none;">
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button id="shop-delivery-confirm" class="btn btn-primary" style="flex: 1;">Á°ÆËÆ§‰∏ãÂçï</button>
                        <button id="shop-delivery-cancel" class="btn btn-neutral" style="flex: 1;">ÂèñÊ∂à</button>
                    </div>
                </div>
            </div>

            <!-- Shop More ActionSheet -->
            <div id="shop-more-actionsheet" class="action-sheet-overlay">
                <div class="action-sheet">
                    <button class="action-sheet-button" id="shop-pickup-btn">üéÅ ÊèêÂèñÂïÜÂìÅ (ËæìÂÖ•Âè£‰ª§)</button>
                    <button class="action-sheet-button" id="shop-category-manage-btn">üè∑Ô∏è Ëá™ÂÆö‰πâÂàÜÁ±ª</button>
                    <button class="action-sheet-button danger" id="shop-more-cancel-btn">ÂèñÊ∂à</button>
                </div>
            </div>

            <!-- Shop Category Manage Modal -->
            <div id="shop-category-manage-modal" class="modal-overlay">
                <div class="modal-window" style="max-height: 85vh; overflow-y: auto;">
                    <h3>ÂïÜÂüéÂàÜÁ±ªÁÆ°ÁêÜ</h3>
                    <div
                        style="font-size: 12px; color: #666; margin-bottom: 10px; background: #f9f9f9; padding: 8px; border-radius: 6px;">
                        Ê∑ªÂä†Ëá™ÂÆö‰πâÂàÜÁ±ªÂêéÔºå‰∏ãÊ¨°ËøõË¥ßÊó∂ AI Â∞Ü‰ºöÊ†πÊçÆ‰Ω†ÁöÑÊèêÁ§∫ËØçÁîüÊàêÂØπÂ∫îÂïÜÂìÅ„ÄÇ
                    </div>

                    <div class="form-group"
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #eee;">
                        <label for="shop-item-count" style="margin: 0;">ÊØè‰∏™ÂàÜÁ±ªÁîüÊàêÊï∞Èáè</label>
                        <input type="number" id="shop-item-count" value="8" min="1" max="20"
                            style="width: 60px; text-align: center;">
                    </div>

                    <div id="shop-category-list"
                        style="margin-bottom: 15px; border: 1px solid #eee; border-radius: 8px; padding: 10px; min-height: 100px;">
                        <!-- JS populated list -->
                    </div>

                    <div class="form-group" style="border-top: 1px solid #eee; padding-top: 15px;">
                        <label style="font-weight: bold; margin-bottom: 10px; display: block;">Ê∑ªÂä†Êñ∞ÂàÜÁ±ª</label>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <input type="text" id="shop-cat-id" placeholder="Ëã±Êñáid (Â¶Ç: flower)"
                                style="flex: 1; min-width: 0;" required>
                            <input type="text" id="shop-cat-name" placeholder="ÊòæÁ§∫ÂêçÁß∞ (Â¶Ç: üå∏ Ëä±)"
                                style="flex: 1; min-width: 0;" required>
                        </div>
                        <textarea id="shop-cat-prompt" rows="2" placeholder="ÁÆÄÁü≠ÁöÑÊèêÁ§∫ËØçÔºöÊèèËø∞Ëøô‰∏™ÂàÜÁ±ª‰∏ãÂ∫îËØ•Âçñ‰ªÄ‰πàÂïÜÂìÅ..."
                            style="width: 100%; margin-bottom: 10px;" required></textarea>
                        <button id="shop-add-category-btn" class="btn btn-secondary" style="width: 100%;">+
                            Ê∑ªÂä†ÂàÜÁ±ª</button>
                    </div>

                    <div style="margin-top: 10px; text-align: right;">
                        <button id="shop-category-close-btn" class="btn btn-primary" style="width: 100%;">ÂÆåÊàê</button>
                    </div>
                </div>
            </div>

            <!-- Shop Pickup Modal -->
            <div id="shop-pickup-modal" class="modal-overlay">
                <div class="modal-window">
                    <h3>ÊèêÂèñÂïÜÂìÅ</h3>
                    <p style="color: #666; font-size: 14px; margin-bottom: 15px;">ËØ∑ËæìÂÖ•ËÆ¢Âçï‰∏≠ÁöÑËá™ÊèêÂè£‰ª§ÊàñÊöóÂè∑Ôºö</p>
                    <div class="form-group">
                        <input type="text" id="shop-pickup-input" placeholder="‰æãÂ¶ÇÔºö888888 Êàñ Ê±™Ê±™Ê±™"
                            style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; outline: none; font-size: 16px; text-align: center;">
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button id="shop-pickup-confirm" class="btn btn-primary" style="flex: 1;">Á°ÆËÆ§ÊèêÂèñ</button>
                        <button id="shop-pickup-cancel" class="btn btn-neutral" style="flex: 1;">ÂèñÊ∂à</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pomodoro Settings Modal -->
        <div id="pomodoro-settings-modal" class="modal-overlay">
            <div class="modal-window" style="max-height: 80vh; overflow-y: auto;">
                <h3>‰∏ìÊ≥®ËÆæÁΩÆ</h3>
                <form id="pomodoro-settings-form">
                    <div class="form-group">
                        <label for="pomodoro-char-select">ÁªëÂÆöÈô™‰º¥ËßíËâ≤</label>
                        <select id="pomodoro-char-select" class="form-group"></select>
                    </div>
                    <div class="form-group">
                        <label for="pomodoro-user-persona-select">ÈÄâÊã©‰Ω†ÁöÑËÆæÂÆö</label>
                        <select id="pomodoro-user-persona-select" class="form-group"></select>
                    </div>
                    <hr style="margin: 15px 0; border: 0; border-top: 1px solid #eee;">
                    <div class="form-group">
                        <label for="pomodoro-encouragement-minutes">ÈºìÂä±Êú∫Âà∂ (ÂàÜÈíü)</label>
                        <input type="number" id="pomodoro-encouragement-minutes" class="form-group"
                            placeholder="‰∏ìÊ≥®Â§öÂ∞ëÂàÜÈíüÂêéÊî∂Âà∞ÈºìÂä±" min="1">
                    </div>
                    <div class="form-group">
                        <label for="pomodoro-poke-limit">‚ÄúÊà≥‰∏ÄÊà≥‚ÄùÊ¨°Êï∞‰∏äÈôê</label>
                        <input type="number" id="pomodoro-poke-limit" class="form-group" placeholder="ÊØèÊ¨°‰∏ìÊ≥®ÂÖÅËÆ∏Êà≥Âá†Ê¨°"
                            min="0">
                    </div>
                    <hr style="margin: 15px 0; border: 0; border-top: 1px solid #eee;">
                    <div class="form-group">
                        <label for="pomodoro-focus-bg-url">‰∏ìÊ≥®ÁïåÈù¢ËÉåÊôØ URL</label>
                        <input type="url" id="pomodoro-focus-bg-url" class="form-group" placeholder="Á≤òË¥¥ÂõæÁâáURL">
                    </div>
                    <div class="form-group">
                        <label for="pomodoro-focus-bg-upload" class="btn btn-secondary">Êàñ‰ªéÊú¨Âú∞‰∏ä‰º†</label>
                        <input type="file" id="pomodoro-focus-bg-upload" accept="image/*" style="display:none;">
                    </div>
                    <hr style="margin: 15px 0; border: 0; border-top: 1px solid #eee;">
                    <div class="form-group">
                        <label for="pomodoro-task-card-bg-url">‰ªªÂä°Âç°ÁâáËÉåÊôØ URL</label>
                        <input type="url" id="pomodoro-task-card-bg-url" class="form-group" placeholder="Á≤òË¥¥ÂõæÁâáURL">
                    </div>
                    <div class="form-group">
                        <label for="pomodoro-task-card-bg-upload" class="btn btn-secondary">Êàñ‰ªéÊú¨Âú∞‰∏ä‰º†</label>
                        <input type="file" id="pomodoro-task-card-bg-upload" accept="image/*" style="display:none;">
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="submit" class="btn btn-primary" style="flex: 1;">‰øùÂ≠òËÆæÁΩÆ</button>
                        <button type="button" id="close-pomodoro-settings-btn" class="btn btn-neutral"
                            style="flex: 1;">ÂèñÊ∂à</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Pomodoro Global Settings ActionSheet -->
        <div id="pomodoro-global-settings-actionsheet" class="action-sheet-overlay">
            <div class="action-sheet">
                <div
                    style="padding: 15px; text-align: center; color: #888; font-size: 12px; border-bottom: 1px solid #eee;">
                    ÂÖ®Â±Ä‰∏ìÊ≥®ËÆæÁΩÆ<br>
                    (‰ΩúÁî®‰∫éÊâÄÊúâÁï™ËåÑÈíü‰ªªÂä°)
                </div>
                <button class="action-sheet-button" id="link-global-pomodoro-world-book-btn">ÂÖ≥ËÅî‰∏ñÁïå‰π¶</button>
                <button class="action-sheet-button danger" id="close-pomodoro-global-settings-btn">ÂèñÊ∂à</button>
            </div>
        </div>

        <!-- Pomodoro Certificate Modal -->
        <div id="pomodoro-certificate-modal" class="modal-overlay">
            <div class="modal-window" style="text-align: center;">
                <h3>‰∏ìÊ≥®ÂÆåÊàêÔºÅ</h3>
                <div id="pomodoro-certificate-content"
                    style="border: 2px dashed var(--primary-color); padding: 20px; margin: 15px 0; border-radius: 10px; background: #fff8fa;">
                    <p><strong>‰ªªÂä°ÂêçÁß∞:</strong> <span id="cert-task-name"></span></p>
                    <p><strong>‰∏ìÊ≥®Êó∂Èïø:</strong> <span id="cert-duration"></span></p>
                    <p><strong>‚ÄúÊà≥‰∏ÄÊà≥‚ÄùÊ¨°Êï∞:</strong> <span id="cert-poke-count"></span></p>
                </div>
                <p>ÂÅöÁöÑÂæàÊ£íÔºÅË¶Å‰∏çË¶ÅÊääËøôÊ¨°ÁöÑ‰∏ìÊ≥®ÊàêÊûúÂàÜ‰∫´‰∏Ä‰∏ãÔºü</p>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button id="forward-certificate-btn" class="btn btn-primary" style="flex: 1;">ËΩ¨ÂèëÂà∞ËÅäÂ§©Ê°Ü</button>
                    <button id="close-certificate-btn" class="btn btn-neutral" style="flex: 1;">ÂÖ≥Èó≠</button>
                </div>
            </div>
        </div>

        <!-- Pomodoro Record Detail Modal -->

        <!-- Pomodoro Create Task Modal -->
        <div id="pomodoro-create-modal" class="modal-overlay">
            <div class="modal-window">
                <h3>ÂàõÂª∫‰∏ìÊ≥®‰ªªÂä°</h3>
                <form id="pomodoro-create-form">
                    <div class="form-group">
                        <label for="pomodoro-task-name">‰ªªÂä°ÂêçÁß∞</label>
                        <input type="text" id="pomodoro-task-name" class="form-group"
                            placeholder="‰æãÂ¶ÇÔºöÈòÖËØª‰∏ÄÁ´†„ÄäJavaScriptÈ´òÁ∫ßÁ®ãÂ∫èËÆæËÆ°„Äã" required>
                    </div>
                    <div class="form-group">
                        <label>ËÆ°Êó∂Ê®°Âºè</label>
                        <div class="radio-group-pills">
                            <input type="radio" id="mode-countdown" name="pomodoro-mode" value="countdown" checked>
                            <label for="mode-countdown">ÂÄíËÆ°Êó∂</label>
                            <input type="radio" id="mode-stopwatch" name="pomodoro-mode" value="stopwatch">
                            <label for="mode-stopwatch">Ê≠£ËÆ°Êó∂</label>
                        </div>
                    </div>
                    <div id="pomodoro-duration-options" class="visible">
                        <button type="button" class="duration-pill active" data-duration="30">30ÂàÜÈíü</button>
                        <button type="button" class="duration-pill" data-duration="45">45ÂàÜÈíü</button>
                        <button type="button" class="duration-pill" data-duration="60">60ÂàÜÈíü</button>
                        <button type="button" class="duration-pill" data-duration="custom">Ëá™ÂÆö‰πâ</button>
                        <input type="number" id="pomodoro-custom-duration-input" class="form-group" placeholder="ËæìÂÖ•ÂàÜÈíüÊï∞">
                    </div>
                    <button type="submit" class="btn btn-primary" style="margin-top: 20px;">ÂàõÂª∫‰ªªÂä°</button>
                </form>
            </div>
        </div>
        <div id="peek-photo-modal" class="modal-overlay">
            <div class="modal-window">
                <div id="peek-photo-image-container">
                    <span class="placeholder-icon">üñºÔ∏è</span>
                </div>
                <div id="peek-photo-description"></div>
            </div>
        </div>
    </div>

    <!-- Full Image Viewer Modal -->
    <div id="full-image-modal" class="modal-overlay" style="z-index: 20000; background: rgba(0,0,0,0.95);">
        <div class="modal-window"
            style="background: transparent; box-shadow: none; width: 100%; height: 100%; max-width: none; padding: 0; display: flex; align-items: center; justify-content: center; position: relative;">
            <img id="full-image-view" src=""
                style="max-width: 100%; max-height: 100%; object-fit: contain; transition: transform 0.3s ease;">
            <button id="close-full-image-btn"
                style="position: absolute; top: 40px; right: 20px; background: rgba(255,255,255,0.2); border: none; color: white; width: 40px; height: 40px; border-radius: 50%; font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(5px);">√ó</button>
        </div>
    </div>

    <!-- Polaroid Customization Modal -->
    <div id="heart-photo-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>Ëá™ÂÆö‰πâÊãçÁ´ãÂæó</h3>
            <form id="heart-photo-form">
                <div id="heart-photo-preview"
                    style="width: 150px; height: 150px; border: 2px dashed #ddd; border-radius: 10px; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; color: #aaa; background-color: #f9f9f9; background-size: cover; background-position: center;">
                    <span>È¢ÑËßà</span>
                </div>
                <div class="form-group">
                    <label for="heart-photo-url-input">ÂõæÁâáURL</label>
                    <input type="url" id="heart-photo-url-input" class="form-group" placeholder="Á≤òË¥¥ÂõæÁâáURL">
                </div>
                <p style="text-align:center; color:#888; margin: -10px 0 15px;">Êàñ</p>
                <input type="file" id="heart-photo-file-upload" accept="image/*" style="display:none;">
                <label for="heart-photo-file-upload" class="btn btn-secondary"
                    style="width:100%; margin-bottom: 20px;">‰ªéÊú¨Âú∞‰∏ä‰º†</label>
                <button type="submit" class="btn btn-primary">‰øùÂ≠ò</button>
            </form>
        </div>
    </div>
    <div id="forum-binding-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>ÁªëÂÆö‰∏ä‰∏ãÊñá</h3>
            <div class="forum-binding-tabs">
                <button class="tab-btn active" data-target="binding-content-worldbook">‰∏ñÁïå‰π¶</button>
                <button class="tab-btn" data-target="binding-content-char">char</button>
                <button class="tab-btn" data-target="binding-content-user">user</button>
            </div>
            <div id="forum-binding-content-wrapper">
                <div id="binding-content-worldbook" class="forum-binding-content active">
                    <ul id="forum-worldbook-list" class="binding-list"></ul>
                </div>
                <div id="binding-content-char" class="forum-binding-content">
                    <ul id="forum-char-list" class="binding-list"></ul>
                </div>
                <div id="binding-content-user" class="forum-binding-content">
                    <ul id="forum-user-list" class="binding-list"></ul>
                </div>
            </div>
            <button id="confirm-forum-binding-btn" class="btn btn-primary" style="margin-top: 20px;">Á°ÆËÆ§ÁªëÂÆö</button>
        </div>
    </div>


    <!-- Generate Journal Modal -->
    <div id="generate-journal-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>ÊåáÂÆöÊÄªÁªìËåÉÂõ¥</h3>
            <form id="generate-journal-form">
                <div id="journal-range-info"
                    style="font-size: 12px; color: #888; text-align: center; margin-bottom: 15px;"></div>
                <div class="form-group">
                    <label for="journal-range-start">Ëµ∑ÂßãÊ∂àÊÅØ (Â∫èÂè∑)</label>
                    <input type="number" id="journal-range-start" placeholder="‰æãÂ¶ÇÔºö1" required>
                </div>
                <div class="form-group">
                    <label for="journal-range-end">ÁªìÊùüÊ∂àÊÅØ (Â∫èÂè∑)</label>
                    <input type="number" id="journal-range-end" placeholder="‰æãÂ¶ÇÔºö100" required>
                </div>
                <div class="form-group"
                    style="display: flex; align-items: center; justify-content: space-between; margin-top: 15px;">
                    <label for="journal-include-favorited" style="font-size: 14px; color: #555;">ÂèÇËÄÉÂ∑≤Êî∂ËóèÁöÑÊó•ËÆ∞</label>
                    <label class="kkt-switch">
                        <input type="checkbox" id="journal-include-favorited">
                        <span class="kkt-slider"></span>
                    </label>
                </div>
                <button type="submit" class="btn btn-primary">ÁîüÊàê</button>
            </form>
        </div>
    </div>

    <!-- Journal Style Selection Modal -->
    <div id="journal-style-selection-modal" class="modal-overlay">
        <div class="modal-window" style="max-height: 80vh; display: flex; flex-direction: column;">
            <h3>Êó•ËÆ∞È£éÊ†ºËÆæÁΩÆ</h3>
            <div style="margin-bottom: 15px;">
                <label
                    style="display: block; font-weight: bold; margin-bottom: 10px; color: var(--primary-color);">ÈÄâÊã©È£éÊ†ºÊ®°Âºè</label>
                <div class="radio-group-vertical" style="display: flex; flex-direction: column; gap: 10px;">
                    <label class="radio-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="radio" name="journal-style-mode" value="default" checked>
                        <span>ÈªòËÆ§È£éÊ†º (Á¨¨‰∏Ä‰∫∫Áß∞ÊµÅÊ∞¥Ë¥¶)</span>
                    </label>
                    <label class="radio-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="radio" name="journal-style-mode" value="summary">
                        <span>ÊëòË¶ÅÊÄªÁªì (Á¨¨‰∏â‰∫∫Áß∞ÂÆ¢ËßÇËÆ∞ÂΩï)</span>
                    </label>
                    <label class="radio-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="radio" name="journal-style-mode" value="custom">
                        <span>Ëá™ÂÆö‰πâ (‰ΩøÁî®‰∏ñÁïå‰π¶ÂÆö‰πâÈ£éÊ†º)</span>
                    </label>
                </div>
            </div>

            <div id="journal-custom-style-container"
                style="display: none; flex: 1; min-height: 200px; flex-direction: column; margin-top: 10px;">
                <label
                    style="display: block; font-weight: bold; margin-bottom: 10px; font-size: 14px; color: #666;">ÈÄâÊã©‰Ωú‰∏∫È£éÊ†ºÂÆö‰πâÁöÑ‰∏ñÁïå‰π¶</label>
                <ul id="journal-style-worldbook-list" class="list-container"
                    style="flex: 1; overflow-y: auto; padding: 0; margin: 0; border: 1px solid #eee; border-radius: 8px; padding: 5px;">
                    <!-- World book items will be rendered here -->
                </ul>
            </div>

            <p style="font-size: 12px; color: #999; margin-top: 10px; text-align: center;">* ÁîüÊàêÊó∂‰ºöËá™Âä®ÂåÖÂê´ËÅäÂ§©ÂÆ§ÁªëÂÆöÁöÑÈÄöÁî®‰∏ñÁïå‰π¶‰Ωú‰∏∫ËÉåÊôØ</p>

            <button class="btn btn-primary" id="save-journal-style-btn" style="margin-top: 10px;">‰øùÂ≠òËÆæÁΩÆ</button>
        </div>
    </div>

    <!-- NEW: Delete History Chunk Modals -->
    <div id="delete-chunk-modal" class="modal-overlay">
        <div class="modal-window" style="max-height: 80vh; display: flex; flex-direction: column;">
            <h3>ËÆ∞ÂΩïÁÆ°ÁêÜ</h3>
            <div id="delete-chunk-range-info"
                style="font-size: 12px; color: #888; text-align: center; margin-bottom: 5px;"></div>
            <div id="delete-chunk-hidden-info"
                style="font-size: 12px; color: #d32f2f; text-align: center; margin-bottom: 15px; min-height: 18px;">
            </div>

            <form id="delete-chunk-form" onsubmit="event.preventDefault();">
                <div style="display: flex; gap: 10px;">
                    <div class="form-group" style="flex: 1;">
                        <label for="delete-range-start">Ëµ∑ÂßãÂ∫èÂè∑</label>
                        <input type="number" id="delete-range-start" placeholder="1" required>
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label for="delete-range-end">ÁªìÊùüÂ∫èÂè∑</label>
                        <input type="number" id="delete-range-end" placeholder="100" required>
                    </div>
                </div>
            </form>

            <div id="delete-chunk-preview-box"
                style="flex: 1; overflow-y: auto; background: #f9f9f9; border-radius: 8px; padding: 10px; margin: 10px 0; font-size: 12px; line-height: 1.5; min-height: 100px; border: 1px solid #eee;">
                <p style="color: #999; text-align: center; margin-top: 30px;">ËæìÂÖ•ËåÉÂõ¥‰ª•È¢ÑËßàÂÜÖÂÆπ</p>
            </div>

            <div style="display: flex; gap: 8px; margin-top: 10px;">
                <button id="btn-block-range" class="btn btn-neutral" style="flex: 1; font-size: 13px;">üö´ Â±èËîΩ</button>
                <button id="btn-restore-range" class="btn btn-neutral" style="flex: 1; font-size: 13px;">‚úÖ ÊÅ¢Â§ç</button>
                <button id="btn-delete-range" class="btn btn-danger" style="flex: 1; font-size: 13px;">üóëÔ∏è Âà†Èô§</button>
            </div>
            <button id="close-delete-modal-btn" class="btn btn-neutral"
                style="margin-top: 10px; width: 100%;">ÂÖ≥Èó≠</button>
        </div>
    </div>

    <div id="share-post-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>ÊòØÂê¶Â∞ÜÂàÜ‰∫´Áªô‰ªñ‰∫∫Ôºü</h3>
            <div style="margin: 20px 0;">
                <details>
                    <summary style="font-weight: 500; cursor: pointer; color: var(--primary-color);">ÈÄâÊã©ÂàÜ‰∫´ÂØπË±°</summary>
                    <ul id="share-char-list" class="binding-list"
                        style="margin-top: 10px; max-height: 40vh; overflow-y: auto;">

                    </ul>
                </details>
            </div>
            <button id="confirm-share-btn" class="btn btn-primary" style="margin-top: 15px;">Á°ÆËÆ§ÂèëÈÄÅ</button>
        </div>
    </div>

    <div id="create-forum-post-modal" class="modal-overlay">
        <div class="modal-window" style="max-width: 90%; max-height: 70vh; overflow-y: auto;">
            <h3>ÂèëÂ∏ÉÊñ∞Â∏ñ</h3>
            <form id="create-forum-post-form">
                <div class="form-group">
                    <label>Ê†áÈ¢ò</label>
                    <input type="text" id="forum-post-title-input" placeholder="ËØ∑ËæìÂÖ•Ê†áÈ¢ò" maxlength="50" required autocomplete="off">
                </div>
                <div class="form-group">
                    <label>ÂÜÖÂÆπ</label>
                    <textarea id="forum-post-content-input" placeholder="ÂàÜ‰∫´‰Ω†ÁöÑÊÉ≥Ê≥ï..." rows="8" required></textarea>
                </div>
                <div style="display:flex; gap:10px; margin-top:15px;">
                    <button type="submit" class="btn btn-primary" style="flex:1;">ÂèëÂ∏É</button>
                    <button type="button" class="btn btn-neutral" id="cancel-forum-post-btn" style="flex:1;">ÂèñÊ∂à</button>
                </div>
            </form>
        </div>
    </div>

    <div id="delete-chunk-confirm-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>‚ö†Ô∏è ÊûÅÂ∫¶Âç±Èô©</h3>
            <p style="margin: 15px 0; line-height: 1.6; color: #d32f2f; font-weight: bold;">
                ÊÇ®Âç≥Â∞ÜÊ∞∏‰πÖÂà†Èô§ÈÄâÂÆöËåÉÂõ¥ÂÜÖÁöÑËÅäÂ§©ËÆ∞ÂΩï„ÄÇ<br>
                Ê≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄÔºÅ
            </p>
            <p style="font-size: 13px; color: #666;">Â¶ÇÊûúÂè™ÊòØ‰∏çÊÉ≥ËÆ© AI ËØªÂèñËøô‰∫õËÆ∞ÂΩïÔºåÂª∫ËÆÆ‰ΩøÁî®‚ÄúÂ±èËîΩ‚ÄùÂäüËÉΩ„ÄÇ</p>

            <div style="display: flex; gap: 10px; margin-top: 25px;">
                <button id="confirm-delete-chunk-btn" class="btn btn-danger" style="flex: 1;">Á°ÆËÆ§Âà†Èô§</button>
                <button id="cancel-delete-chunk-btn" class="btn btn-neutral" style="flex: 1;">ÂèñÊ∂à</button>
            </div>
        </div>
    </div>

    <div id="bubble-presets-modal" class="modal-overlay"
        style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.35);justify-content:center;align-items:center;z-index:9999;">
        <div class="modal-window"
            style="max-width:520px;background:var(--panel-bg,#fff);padding:14px;border-radius:10px;box-shadow:0 12px 36px rgba(10,10,20,0.12);">
            <h3 style="margin:0 0 10px 0;font-size:16px;">ÁÆ°ÁêÜÊ∞îÊ≥°È¢ÑËÆæ</h3>
            <div id="bubble-presets-list" style="max-height:340px; overflow:auto; margin-bottom:12px;"></div>
            <div style="display:flex;gap:8px;justify-content:flex-end;"><button type="button" id="close-presets-modal"
                    class="btn btn-primary" style="padding:8px 12px;border-radius:8px;">ÂÖ≥Èó≠</button></div>
        </div>
    </div>
    <div id="mypersona-presets-modal" class="modal-overlay"
        style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.35);justify-content:center;align-items:center;z-index:9999;">
        <div class="modal-window"
            style="max-width:520px;background:var(--panel-bg,#fff);padding:14px;border-radius:10px;box-shadow:0 12px 36px rgba(10,10,20,0.12);">
            <h3 style="margin:0 0 10px 0;font-size:16px;">ÁÆ°ÁêÜÊàëÁöÑ‰∫∫ËÆæÈ¢ÑËÆæ</h3>
            <div id="mypersona-presets-list" style="max-height:340px; overflow:auto; margin-bottom:12px;"></div>
            <div style="display:flex;gap:8px;justify-content:flex-end;"><button type="button" id="mypersona-close-modal"
                    class="btn btn-primary" style="padding:8px 12px;border-radius:8px;">ÂÖ≥Èó≠</button></div>
        </div>
    </div>
    <div id="global-css-presets-modal" class="modal-overlay"
        style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.35);justify-content:center;align-items:center;z-index:9999;">
        <div class="modal-window"
            style="max-width:520px;background:var(--panel-bg,#fff);padding:14px;border-radius:10px;box-shadow:0 12px 36px rgba(10,10,20,0.12);">
            <h3 style="margin:0 0 10px 0;font-size:16px;">ÁÆ°ÁêÜÂÖ®Â±ÄCSSÈ¢ÑËÆæ</h3>
            <div id="global-css-presets-list" style="max-height:340px; overflow:auto; margin-bottom:12px;"></div>
            <div style="display:flex;gap:8px;justify-content:flex-end;"><button type="button"
                    id="global-css-close-modal" class="btn btn-primary"
                    style="padding:8px 12px;border-radius:8px;">ÂÖ≥Èó≠</button></div>
        </div>
    </div>
    <div id="font-presets-modal" class="modal-overlay"
        style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.35);justify-content:center;align-items:center;z-index:9999;">
        <div class="modal-window"
            style="max-width:520px;background:var(--panel-bg,#fff);padding:14px;border-radius:10px;box-shadow:0 12px 36px rgba(10,10,20,0.12);">
            <h3 style="margin:0 0 10px 0;font-size:16px;">ÁÆ°ÁêÜÂ≠ó‰ΩìÈ¢ÑËÆæ</h3>
            <div id="font-presets-list" style="max-height:340px; overflow:auto; margin-bottom:12px;"></div>
            <div style="display:flex;gap:8px;justify-content:flex-end;"><button type="button" id="font-close-modal"
                    class="btn btn-primary" style="padding:8px 12px;border-radius:8px;">ÂÖ≥Èó≠</button></div>
        </div>
    </div>
    <div id="sound-presets-modal" class="modal-overlay"
        style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.35);justify-content:center;align-items:center;z-index:9999;">
        <div class="modal-window"
            style="max-width:520px;background:var(--panel-bg,#fff);padding:14px;border-radius:10px;box-shadow:0 12px 36px rgba(10,10,20,0.12);">
            <h3 style="margin:0 0 10px 0;font-size:16px;">ÁÆ°ÁêÜÊèêÁ§∫Èü≥È¢ÑËÆæ</h3>
            <div id="sound-presets-list" style="max-height:340px; overflow:auto; margin-bottom:12px;"></div>
            <div style="display:flex;gap:8px;justify-content:flex-end;"><button type="button" id="sound-close-modal"
                    class="btn btn-primary" style="padding:8px 12px;border-radius:8px;">ÂÖ≥Èó≠</button></div>
        </div>
    </div>
    <div id="icon-presets-modal" class="modal-overlay"
        style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.35);justify-content:center;align-items:center;z-index:9999;">
        <div class="modal-window"
            style="max-width:520px;background:var(--panel-bg,#fff);padding:14px;border-radius:10px;box-shadow:0 12px 36px rgba(10,10,20,0.12);">
            <h3 style="margin:0 0 10px 0;font-size:16px;">ÁÆ°ÁêÜÂõæÊ†áÈ¢ÑËÆæ</h3>
            <div id="icon-presets-list" style="max-height:340px; overflow:auto; margin-bottom:12px;"></div>
            <div style="display:flex;gap:8px;justify-content:flex-end;"><button type="button" id="icon-presets-close-modal"
                    class="btn btn-primary" style="padding:8px 12px;border-radius:8px;">ÂÖ≥Èó≠</button></div>
        </div>
    </div>
    <div id="widget-presets-modal" class="modal-overlay"
        style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.35);justify-content:center;align-items:center;z-index:9999;">
        <div class="modal-window"
            style="max-width:520px;background:var(--panel-bg,#fff);padding:14px;border-radius:10px;box-shadow:0 12px 36px rgba(10,10,20,0.12);">
            <h3 style="margin:0 0 10px 0;font-size:16px;">ÁÆ°ÁêÜÂ∞èÁªÑ‰ª∂È¢ÑËÆæ</h3>
            <div id="widget-presets-list" style="max-height:340px; overflow:auto; margin-bottom:12px;"></div>
            <div style="display:flex;gap:8px;justify-content:flex-end;"><button type="button" id="widget-presets-close-modal"
                    class="btn btn-primary" style="padding:8px 12px;border-radius:8px;">ÂÖ≥Èó≠</button></div>
        </div>
    </div>
    <input type="file" id="import-data-input" accept=".ee" style="display: none;">
    <input type="file" id="import-partial-data-input" accept=".ee" style="display: none;">
    <div id="storage-screen" class="screen"></div>
    <input type="file" id="character-card-input" accept="image/png,application/json" style="display: none;">
    <!-- INS Widget Avatar Modal -->
    <div id="ins-widget-avatar-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>Êõ¥Êç¢Â§¥ÂÉè</h3>
            <form id="ins-widget-avatar-form">
                <input type="hidden" id="ins-widget-avatar-target">
                <div id="ins-widget-avatar-preview"
                    style="width: 100px; height: 100px; border: 2px dashed #ddd; border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; color: #aaa; background-color: #f9f9f9; background-size: cover; background-position: center;">
                    <span>È¢ÑËßà</span>
                </div>
                <div class="form-group">
                    <label for="ins-widget-avatar-url-input">Â§¥ÂÉèURL</label>
                    <input type="url" id="ins-widget-avatar-url-input" class="form-group" placeholder="Á≤òË¥¥ÂõæÁâáURL">
                </div>
                <p style="text-align:center; color:#888; margin: -10px 0 15px;">Êàñ</p>
                <input type="file" id="ins-widget-avatar-file-upload" accept="image/*" style="display:none;">
                <label for="ins-widget-avatar-file-upload" class="btn btn-secondary"
                    style="width:100%; margin-bottom: 20px;">‰ªéÊú¨Âú∞‰∏ä‰º†</label>
                <div style="display:flex; gap:10px; justify-content:center; margin-top:10px;">
                    <button type="button" id="ins-widget-avatar-reset-btn" class="btn btn-neutral">ÈáçÁΩÆ</button>
                    <button type="submit" class="btn btn-primary">‰øùÂ≠ò</button>
                </div>
            </form>
        </div>
    </div>
    <!-- More Card Background Modal -->
    <div id="more-card-bg-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>Êõ¥Êç¢‰∏™‰∫∫Âç°ÁâáËÉåÊôØ</h3>
            <form id="more-card-bg-form">
                <div id="more-card-bg-preview"
                    style="width: 100%; height: 150px; border: 2px dashed #ddd; border-radius: 10px; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; color: #aaa; background-size: cover; background-position: center;">
                    <span>È¢ÑËßà</span>
                </div>
                <div class="form-group">
                    <label for="more-card-bg-url-input">ÂõæÁâáURL</label>
                    <input type="url" id="more-card-bg-url-input" class="form-group" placeholder="Á≤òË¥¥ÂõæÁâáURL">
                </div>
                <p style="text-align:center; color:#888; margin: -10px 0 15px;">Êàñ</p>
                <input type="file" id="more-card-bg-file-upload" accept="image/*" style="display:none;">
                <label for="more-card-bg-file-upload" class="btn btn-secondary"
                    style="width:100%; margin-bottom: 20px;">‰ªéÊú¨Âú∞‰∏ä‰º†</label>
                <button type="submit" class="btn btn-primary">‰øùÂ≠ò</button>
            </form>
        </div>
    </div>

    <!-- Character Gallery Modal -->
    <div id="char-gallery-modal" class="modal-overlay">
        <div class="modal-window" style="max-height: 80vh; display: flex; flex-direction: column;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="margin: 0;">ËßíËâ≤Áõ∏ÂÜåÁÆ°ÁêÜ</h3>
                <div class="gallery-actions" style="display: flex; gap: 8px;">
                    <button id="add-gallery-item-btn" class="icon-btn-simple" title="Ê∑ªÂä†ÂõæÁâá">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                    </button>
                    <button id="batch-add-gallery-btn" class="icon-btn-simple" title="ÊâπÈáèÂØºÂÖ•">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                            <path
                                d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" />
                        </svg>
                    </button>
                    <div style="width: 1px; background: #eee; margin: 0 4px;"></div>
                    <button id="load-gallery-preset-btn" class="icon-btn-simple" title="Âä†ËΩΩÈ¢ÑËÆæ">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                            <path
                                d="M4 15h2v3h12v-3h2v3c0 1.1-.9 2-2 2H6c-1.1 0-2-.9-2-2m4.41-7.59L11 7.83V1h2v6.83l2.59-2.58L17 6.66l-5 5-5-5 1.41-1.41z" />
                        </svg>
                    </button>
                    <button id="save-gallery-preset-btn" class="icon-btn-simple" title="Â≠ò‰∏∫È¢ÑËÆæ">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                            <path
                                d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z" />
                        </svg>
                    </button>
                    <div style="width: 1px; background: #eee; margin: 0 4px;"></div>
                    <button id="export-gallery-btn" class="icon-btn-simple" title="ÂØºÂá∫Áõ∏ÂÜå">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                            <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" />
                        </svg>
                    </button>
                </div>
            </div>

            <div
                style="font-size: 12px; color: #666; margin-bottom: 10px; background: #f9f9f9; padding: 8px; border-radius: 6px;">
                Ê≠§Â§ÑÊ∑ªÂä†ÁöÑÁÖßÁâáÂ∞Ü‰Ωú‰∏∫ËßíËâ≤ÁöÑ‚ÄúÁúüÂÆûÁõ∏ÂÜå‚Äù„ÄÇ<br>
                ÂºÄÂêØ‚ÄúÁúüÂÆûÁõ∏ÂÜåÂåπÈÖç‚ÄùÂêéÔºåÂΩì AI ÂèëÈÄÅÁöÑ [ÁÖßÁâá/ËßÜÈ¢ëÔºöÂÜÖÂÆπ] ‰∏≠ÁöÑ‚ÄúÂÜÖÂÆπ‚Äù‰∏éÁõ∏ÂÜå‰∏≠ÁöÑ„ÄêÂõæÁâáÂêçÁß∞„ÄëÂåπÈÖçÊó∂ÔºåÂ∞ÜÁõ¥Êé•ÊòæÁ§∫ÂõæÁâá„ÄÇ
            </div>

            <div id="gallery-list-container"
                style="flex: 1; overflow-y: auto; margin-bottom: 15px; border: 1px solid #eee; border-radius: 8px; padding: 10px; min-height: 200px;">
                <!-- JS populated list -->
                <p class="placeholder-text" style="text-align: center; color: #999; margin-top: 20px;">Áõ∏ÂÜåÁ©∫Á©∫Â¶Ç‰πü~</p>
            </div>

            <div style="margin-top: 5px; text-align: right;">
                <button id="close-gallery-modal-btn" class="btn btn-neutral">ÂÖ≥Èó≠</button>
            </div>
        </div>
    </div>

    <!-- Gallery Presets Modal -->
    <div id="gallery-presets-modal" class="modal-overlay" style="z-index: 10002;">
        <div class="modal-window" style="max-width: 520px;">
            <h3 style="margin: 0 0 15px 0;">Áõ∏ÂÜåÈ¢ÑËÆæÂ∫ì</h3>
            <div id="gallery-presets-list"
                style="max-height: 340px; overflow: auto; margin-bottom: 15px; border: 1px solid #f0f0f0; padding: 8px; border-radius: 6px; min-height: 100px;">
                <!-- JS populated -->
            </div>
            <div style="display: flex; justify-content: flex-end;">
                <button id="close-gallery-presets-modal" class="btn btn-primary">ÂÖ≥Èó≠</button>
            </div>
        </div>
    </div>

    <!-- Save Gallery Preset Modal -->
    <div id="save-gallery-preset-modal" class="modal-overlay" style="z-index: 10002;">
        <div class="modal-window">
            <h3>‰øùÂ≠ò‰∏∫È¢ÑËÆæ</h3>
            <div class="form-group">
                <label>È¢ÑËÆæÂêçÁß∞</label>
                <input type="text" id="gallery-preset-name-input" placeholder="‰æãÂ¶ÇÔºöÈÄöÁî®È£éÊôØÂõæ" required>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button id="confirm-save-gallery-preset-btn" class="btn btn-primary" style="flex: 1;">‰øùÂ≠ò</button>
                <button id="cancel-save-gallery-preset-btn" class="btn btn-neutral" style="flex: 1;">ÂèñÊ∂à</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Gallery Item Modal -->
    <div id="gallery-item-modal" class="modal-overlay" style="z-index: 10001;">
        <div class="modal-window">
            <h3 id="gallery-item-modal-title">Ê∑ªÂä†ÂõæÁâá</h3>
            <form id="gallery-item-form">
                <input type="hidden" id="gallery-item-id">
                <div id="gallery-item-preview"
                    style="width: 100%; height: 150px; background-color: #f9f9f9; border-radius: 8px; margin-bottom: 15px; background-size: contain; background-repeat: no-repeat; background-position: center; border: 1px dashed #ddd; display: flex; align-items: center; justify-content: center; color: #aaa;">
                    È¢ÑËßà
                </div>

                <div class="form-group">
                    <label>ÂõæÁâáÂêçÁß∞ (AIËØÜÂà´Áî®ÔºåÂøÖÈ°ªÂîØ‰∏Ä)</label>
                    <input type="text" id="gallery-item-name" placeholder="‰æãÂ¶ÇÔºöÊµ∑ËæπËá™Êãç" required>
                </div>

                <div class="form-group">
                    <label>ÂõæÁâáURL</label>
                    <input type="url" id="gallery-item-url" placeholder="Á≤òË¥¥ÂõæÁâáÈìæÊé•">
                </div>

                <p style="text-align:center; color:#888; margin: -10px 0 15px;">Êàñ</p>
                <input type="file" id="gallery-item-upload" accept="image/*" style="display:none;">
                <label for="gallery-item-upload" class="btn btn-secondary"
                    style="width:100%; margin-bottom: 15px;">Êú¨Âú∞‰∏ä‰º†</label>

                <button type="submit" class="btn btn-primary">‰øùÂ≠ò</button>
                <button type="button" id="cancel-gallery-item-btn" class="btn btn-neutral"
                    style="margin-top: 10px;">ÂèñÊ∂à</button>
            </form>
        </div>
    </div>

    <!-- Batch Add Gallery Modal -->
    <div id="batch-gallery-modal" class="modal-overlay" style="z-index: 10001;">
        <div class="modal-window">
            <h3>ÊâπÈáèÂØºÂÖ•Áõ∏ÂÜå</h3>
            <div class="form-group">
                <label>Ê†ºÂºèÔºöÂêçÁß∞:URL (ÊØèË°å‰∏Ä‰∏™)</label>
                <textarea id="batch-gallery-textarea" rows="10"
                    placeholder="Êµ∑ËæπËá™Êãç:https://example.com/1.jpg&#10;Áå´Áå´:https://example.com/2.png"
                    style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
            </div>
            <input type="file" id="batch-gallery-file-input" accept=".txt" style="display:none;">
            <button id="import-gallery-file-btn" class="btn btn-secondary"
                style="margin-bottom: 10px; width: 100%;">‰ªéTXTÊñá‰ª∂ËØªÂèñ</button>
            <button id="confirm-batch-gallery-btn" class="btn btn-primary">ÂºÄÂßãÂØºÂÖ•</button>
            <button id="cancel-batch-gallery-btn" class="btn btn-neutral" style="margin-top: 10px;">ÂèñÊ∂à</button>
        </div>
    </div>
    <!-- Burnout Update Modal -->
    <div id="burnout-update-modal" class="modal-overlay">
        <div class="modal-window" style="max-height: 80vh; overflow-y: auto;">
            <h3 style="margin-bottom: 20px;">Êõ¥Êñ∞ËØ¥Êòé</h3>
            <div class="update-log-content" style="text-align: left; line-height: 1.6; font-size: 14px; color: #333;">

                <h4 style="margin: 15px 0 10px; color: var(--primary-color);">Êó∂Èó¥ÊÑüÁü•</h4>
                <ul style="padding-left: 20px; margin: 0;">
                    <li>Êó∂Èó¥ÊÑüÁü• char‰ºöÁü•ÈÅì‰Ω†ÊòØÂá†Âπ¥Âá†ÊúàÂá†Êó•Âá†Êó∂Âá†ÂàÜÂèëÁöÑÊ∂àÊÅØ</li>
                    <li>Êõ¥Êç¢ÔºöÁßªÈô§ÂèëÈÄÅÈîÆÔºåÂéü‰ΩçÁΩÆÊîπ‰∏∫Ë°®ÊÉÖÂåÖÈîÆÔºå‰ΩøÁî®ËæìÂÖ•Ê≥ïÁöÑÂõûËΩ¶ÈîÆÊù•ÂèëÈÄÅÊ∂àÊÅØÔºåËé∑ÂèñaiÂõûÂ§çÂú®Âéü‰ΩçÁΩÆ„ÄÇ</li>

                </ul>

                <h4 style="margin: 15px 0 10px; color: var(--primary-color);">Êñ∞Â¢ûÂäüËÉΩ</h4>
                <ul style="padding-left: 20px; margin: 0;">
                    <li>Êñ∞Â¢ûÔºöapiÊ∏©Â∫¶ËÆæÁΩÆ</li>

                    <li>Êñ∞Â¢ûÔºöÊä•ÈîôÂºπÁ™óÂíåÂÖ∑‰ΩìÊó•Âøó</li>
                    <li>Â≠ó‰ΩìÁßªÂà∞‚ÜíËá™ÂÆö‰πâÁïåÈù¢ Â¢ûÂä†Â≠ó‰ΩìÈ¢ÑËÆæÁÆ°ÁêÜÔºåË∞ÉËäÇÂ≠ó‰ΩìÂ§ßÂ∞èÔºåÂ≠òÂÇ®Á©∫Èó¥ÁßªËá≥ÂéüÂ≠ó‰Ωì‰ΩçÁΩÆÔºàÂ∫ïÈÉ®dockÊ†èÁ¨¨‰∏â‰∏™Ôºâ</li>
                    <li>Êñ∞Â¢ûÔºöÂèëÈÄÅ‰∏ä‰∏ãÊñáÊó∂Ëá™Âä®ËØÜÂà´{{user}}Â≠óÁ¨¶ÊõøÊç¢‰∏∫ÂΩìÂâçÁî®Êà∑‰∫∫ËÆæÂßìÂêç</li>
                    <li>Êñ∞Â¢ûÔºöÂêéÂè∞‰∏ªÂä®ÂèëÊ∂àÊÅØ</li>
                </ul>

                <h4 style="margin: 15px 0 10px; color: var(--primary-color);">ÂèåËØ≠ËßÑÂàô</h4>
                <ul style="padding-left: 20px; margin: 0;">
                    <li>ÂèåËØ≠ËßÑÂàôÊîπ‰∏∫„Äå„ÄçËØÜÂà´ËÄå‰∏çÊòØÔºàÔºâÔºå‰øÆÊîπÁõÆÁöÑÔºö‰∏∫‰∫ÜËÆ©Êüê‰∫õcharËÉΩÂèëÂ∏¶Êã¨Âè∑ÁöÑÈ¢úÊñáÂ≠óÂóØÔºåËøáÂæÄÊ∂àÊÅØÊ∏≤Êüì‰∏çÂèóÂΩ±ÂìçÔºå‰πü‰∏çÁî®ÊÄïaiÂ≠¶‰∏ä‰∏ãÊñáÔºåÂú®ÂèëÈÄÅËøáÂæÄÊ∂àÊÅØËÆ∞ÂΩï‰πãÂâçËá™Âä®‰ºöÊääÔºàÔºâÊõøÊç¢‰∏∫„Äå„ÄçÔºåÂú®ÂÜôËøáÁöÑÊâ©Â•ΩËæìÂá∫ËßÑËåÉÊèêÁ§∫ËØçÈáåÊîπ‰∏Ä‰∏ãÂ∞±Ë°å
                    </li>
                </ul>

                <h4 style="margin: 15px 0 10px; color: var(--primary-color);">ÁïåÈù¢ÊîπÁâà</h4>
                <ul style="padding-left: 20px; margin: 0;">
                    <li>ËÅäÂ§©ÂÆ§UIÂ§ßÊîπÔºå‰ªøkktÔºåËøîÂõûÈîÆÂú®Â∑¶‰∏äËßíÔºåÂè≥‰∏äËßíÁöÑÊêúÁ¥¢ÂõæÊ†á‰ªÖ‰∏∫Ë£ÖÈ•∞ÔºåÊ†áÈ¢ò‰∏ãÊñπÁöÑËÉ∂ÂõäÂå∫ÂüüÂèØ‰ª•ÁªôËßíËâ≤ÂàÜÁªÑÂàÜÁ±ªÔºåÁõ∏ÂΩì‰∫éÊñá‰ª∂Â§πÔºåÊñá‰ª∂Â§πÊîØÊåÅËá™ÂÆö‰πâÈáçÂëΩÂêçÔºåÈïøÊåâËÅäÂ§©È°πÂèØ‰ª•ÁßªÂÖ•Êñá‰ª∂Â§π</li>

                </ul>

                <h4 style="margin: 15px 0 10px; color: var(--primary-color);">ËÅäÂ§©ËÆæÁΩÆÁïåÈù¢</h4>
                <ul style="padding-left: 20px; margin: 0;">
                    <li>Êñ∞Â¢ûÔºöËßíËâ≤‰∏ìÂ±ûÁä∂ÊÄÅÊ†èÔºå‰ΩøÁî®ÊñπÊ≥ïÂíåÈÖíÈ¶ÜÁöÑÁä∂ÊÄÅÊ†èÊ≠£Âàô‰∏ÄËá¥ÔºåÊúÄÂ•ΩÂº∫Ë∞ÉËæìÂá∫Âú®‰∏ÄÊù°Ê∂àÊÅØÂ∞ΩÈáè‰∏Ä‰∏™<>
                            Ê†áÁ≠æÂÜÖÂÆåÊàêÔºå‰∏çÁÑ∂aiÂèØËÉΩ‰ºöÂàÜÂ§öÊù°Ê∂àÊÅØÂèëÈÄÅ‰ºöÊéâÊ†ºÂºèÔºÅÁä∂ÊÄÅÊ†èÂç°ÁâáÂèØÂ∑¶ÊªëÊü•ÁúãÂéÜÂè≤Áä∂ÊÄÅÊ†èÔºåÂéÜÂè≤Áä∂ÊÄÅÊ†è‰ªÖ‰øùÂ≠òÊúÄËøë20Êù°</li>
                    <li>Áä∂ÊÄÅÊ†èÂºÄÂêØÂêéÔºåËÅäÂ§©ÁïåÈù¢È°∂Ê†èÂ§áÊ≥®ÊóÅËæπ‰ºöÊòæÁ§∫‰∏Ä‰∏™ËìùËâ≤WIFI‰ø°Âè∑ÔºåÂΩìcharËæìÂá∫Ê≠£Á°ÆÁöÑÁä∂ÊÄÅÊ†èÊ†ºÂºèÂêéÔºåÁÇπÂáªÈÇ£‰∏™ÊòæÁ§∫Áä∂ÊÄÅÊ†è</li>
                    <li>Êñ∞Â¢ûÔºöË°®ÊÉÖÂåÖÈÄªËæëÔºåÊú™ÁªëÂÆöË°®ÊÉÖÂåÖÂàÜÁªÑÁöÑËßíËâ≤ÔºåÂ∞Ü‰∏ç‰ºöÂèëÈÄÅË°®ÊÉÖÂåÖÔºå</li>
                    <li>Êñ∞Â¢ûÔºöÂ§¥ÂÉèÊòæÁ§∫Ê®°ÂºèÔºåÂÖ®ÈÉ®ÊòæÁ§∫ÔºöÊØèÊù°Ê∂àÊÅØÊóÅËæπÈÉΩÊúâ‰∏™Â§¥ÂÉè„ÄÇÊ∞îÊ≥°ÂêàÂπ∂ÔºöËøûÁª≠Ê∂àÊÅØÂè™ÊòæÁ§∫Á¨¨‰∏ÄÊù°ÁöÑÊ∂àÊÅØÁöÑÂ§¥ÂÉèÔºåKktÊ®°ÂºèÔºöËßíËâ≤ÁöÑËøûÁª≠Ê∂àÊÅØÂè™ÊòæÁ§∫Á¨¨‰∏ÄÊù°Ê∂àÊÅØÁöÑÂ§¥ÂÉèÔºåËÄåÊàëÊñπÊ∂àÊÅØ‰∏çÊòæÁ§∫Â§¥ÂÉè„ÄÇÂÖ®ÈÉ®ÈöêËóèÔºö‰∏çÊòæÁ§∫Â§¥ÂÉè
                    </li>
                    <li>Êñ∞Â¢ûÔºöÊó∂Èó¥Êà≥ÂºÄÂÖ≥Ôºà‰ªÖÂΩ±ÂìçÊ†∑ÂºèÔºâÔºåÂ§¥ÂÉèÂúÜËßíËá™ÂÆö‰πâÔºåÊ∞îÊ≥°Á£®Á†ÇÂ±ÇÂºÄÂÖ≥</li>
                    <li>‰øÆÊîπÔºöÂºïÁî®Ê∂àÊÅØÊ†∑Âºè‰ªøvx</li>
                </ul>

                <h4 style="margin: 15px 0 10px; color: var(--primary-color);">Êñ∞Â¢ûÔºöËÅîÁ≥ª‰∫∫ÁïåÈù¢</h4>
                <ul style="padding-left: 20px; margin: 0;">
                    <li>ËÅîÁ≥ª‰∫∫ÁïåÈù¢</li>
                    <li>Âè≥‰∏äËßí‰∏âÂõæÊ†áËøòÊ≤°ÂÅöÔºå‰ªÖ‰∏∫Ë£ÖÈ•∞</li>
                    <li>Êñ∞Â¢ûÔºö‰∏™‰∫∫Ê°£Ê°àÔºåÂú®ËøôÈáåÊòæÁ§∫‰Ω†ÁöÑÊâÄÊúâ‰∫∫ËÆæÈ¢ÑËÆæÔºåÊñáÊú¨Ê°ÜÈáåÂèØ‰ª•Â°´ÈÄöÁî®ËÆæÂÆöÔºåÂ¶ÇÔºöÂ§ñË≤åËÉåÊôØÂ∑¥ÊãâÂ∑¥ÊãâÔºåÁÇπÂáª‰∏ãÊñπÂ∞èËÉ∂ÂõäÂèØÁªëÂÆöËßíËâ≤ÔºåÁÇπÂáªÂ∑≤ÁªëÂÆöÁöÑËßíËâ≤ÂºπÂá∫‰∏ìÂ±ûËÆæÂÆöÁöÑËæìÂÖ•ÊñáÊú¨Ê°ÜÔºåÂ°´ÂÖ•ÂØπËøô‰∏™ËßíËâ≤ÁöÑ‰∏ìÂ±ûËÆæÂÆöÔºàÂ¶ÇÔºöÊ≠£Âú®‰∫§ÂæÄ‰∏≠ÔºåÊòØÂßêÂßê/Â¶πÂ¶π/ÂâçÂ•≥Âèã/ËßíËâ≤‰∏ìÂ±ûÂÖ≥Á≥ªÂíåËÉåÊôØÔºâÔºåÁÇπÂáª‰øùÂ≠òÂêåÊ≠•ÂêéÔºåËá™Âä®ÊãºÊé•ÈÄöÁî®‰∫∫ËÆæ+‰∏ìÂ±û‰∫∫ËÆæ„ÄÇ‰ΩøÁî®Âú∫ÊôØÔºö‰ª•‰∏Ä‰∏™ÈÄöÁî®ËÆæÂÆöÁªëÂÆöÂ§ö‰∏™charÔºåÊØè‰∏™charËÆæÁΩÆ‰∏çÂêåÁöÑ‰∏ìÂ±ûËÆæÂÆö„ÄÇÂè≥‰∏äËßíÊòüÊòüÁ¨¶Âè∑ÔºåÁÇπ‰∫ÆÂêéÊòØÈÄâÊã©ËÅîÁ≥ª‰∫∫‰∏ªÁïåÈù¢È°∂ÈÉ®Â±ïÁ§∫ÁöÑÂ§¥ÂÉè„ÄÇ
                    </li>
                    <li>Êñ∞Â¢ûÔºöÂ•ΩÂèãÂàóË°®„ÄÇÂÖ∂ÂÆûÊ≤°‰ªÄ‰πàÁî®ÔºåÁ∫ØÂ±ûÂ∫üÁâ©ÔºåÁÇπÂáªÂèØÁúãÊÄªÊ∂àÊÅØÊù°Êï∞ÔºåÊâÄÂç†ÂÜÖÂ≠òÔºåÊúÄËøëËÅäÂ§©Êó∂Èó¥„ÄÇ</li>
                </ul>

                <h4 style="margin: 15px 0 10px; color: var(--primary-color);">Êñ∞Â¢ûÔºöËèúÂçïÁïåÈù¢</h4>
                <ul style="padding-left: 20px; margin: 0;">

                    <li>Áä∂ÊÄÅÊ†èÈ¢ÑËÆæÁÆ°ÁêÜÔºåÊîØÊåÅÂØºÂá∫ÂØºÂÖ•ÔºàÂè™ËÉΩÂØºÂÖ•‰ªéËØ•ÈìæÊé•ÂØºÂá∫ÁöÑÊñá‰ª∂Ôºâ</li>
                    <li>Á¨¨‰∫åÈ°µÂàõÊÑèÂ∑•ÂùäÁÇπ‰∏çÂä®ÊòØÊ≠£Â∏∏ÁöÑÔºåËøòÊ≤°ÂÅöÂÆå</li>
                </ul>

            </div>
            <button onclick="document.getElementById('burnout-update-modal').classList.remove('visible')"
                class="btn btn-primary" style="margin-top: 20px; width: 100%;">ÂÖ≥Èó≠</button>
        </div>
    </div>

    <!-- Update Log Modal -->
    <div id="update-log-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>ÂèëÁé∞Êñ∞ÁâàÊú¨ÔºÅ</h3>
            <div id="update-log-modal-content">
                <!-- Update content will be injected here -->
            </div>
            <button id="close-update-log-modal" class="btn btn-primary" style="margin-top: 15px;">ÊàëÁü•ÈÅì‰∫Ü</button>
        </div>
    </div>

    <!-- Private Chat Monitor Overlay (Browser Style) -->
    <div id="private-chat-overlay" class="private-chat-overlay">
        <div class="browser-window">
            <div class="tabs-head">
                <div class="tabs" id="private-chat-tabs">
                    <!-- Tabs will be injected here -->
                </div>
                <div class="window-opt">
                    <button id="private-window-minimize">-</button>
                    <button id="private-window-maximize">‚ñ°</button>
                    <button id="private-window-close" class="window-close">‚úï</button>
                </div>
            </div>

            <div class="head-browser">
                <button disabled>‚Üê</button>
                <button disabled>‚Üí</button>
                <div class="address-bar" id="private-chat-title">
                    <!-- Current session title -->
                    Private Chat Monitor
                </div>
                <button>‚ãÆ</button>
                <button class="star">‚ú∞</button>
            </div>

            <div class="browser-content" id="private-chat-content">
                <!-- Chat messages will be injected here -->
                <div class="empty-state">ÊöÇÊó†Ê¥ªË∑ÉÁöÑÁßÅËÅä‰ºöËØù</div>
            </div>

            <!-- ÁßÅËÅäËæìÂÖ•Âå∫Âüü -->
            <div class="private-chat-input-area" id="private-chat-input-area">
                <input type="text" class="private-chat-input" id="private-chat-input" placeholder="ÂèëÈÄÅÁßÅËÅäÊ∂àÊÅØ...">
            </div>
        </div>
    </div>


    <!-- 
  === JSÊñá‰ª∂Á¥¢ÂºïËØ¥Êòé ===
  Êú™Êù•‰øÆÊîπ‰ª£Á†ÅÊó∂ÔºåËØ∑ÂèÇËÄÉ‰ª•‰∏ãÊ≥®ÈáäÊâæÂà∞ÂØπÂ∫îÁöÑÊñá‰ª∂Ôºö
-->

    <!-- [1. Âü∫Á°ÄÂ±Ç] -->
    <script src="js/utils.js"></script> <!-- Â∑•ÂÖ∑ÂáΩÊï∞ÔºöÂõæÁâáÂéãÁº©„ÄÅToastÊèêÁ§∫„ÄÅÈöèÊú∫Êï∞Á≠â -->
    <script src="js/db.js"></script> <!-- Êï∞ÊçÆÂ±ÇÔºöDexieÊï∞ÊçÆÂ∫ìÈÖçÁΩÆ„ÄÅÂÖ®Â±ÄÂèòÈáèÂÆö‰πâ„ÄÅÊï∞ÊçÆÂ≠òÂèñ -->

    <!-- [2. Ê†∏ÂøÉ‰∫§‰∫íÂ±Ç] -->
    <script src="js/ui.js"></script> <!-- UI‰∫§‰∫íÔºöÁïåÈù¢ÂàáÊç¢„ÄÅ‰∏ªÂ±èÂπïÈÄªËæë„ÄÅÂè≥ÈîÆËèúÂçï -->
    <!-- Chat Modules -->
    <script src="js/modules/chat_list.js"></script>
    <script src="js/modules/character_import.js"></script>
    <script src="js/modules/chat_render.js"></script>
    <script src="js/modules/chat_ai.js"></script>
    <script src="js/modules/chat_features.js"></script>
    <script src="js/modules/chat_ops.js"></script>
    <script src="js/chat.js"></script> <!-- ËÅäÂ§©Ê†∏ÂøÉÂÖ•Âè£ -->
    <script src="js/group_chat.js"></script> <!-- Áæ§ËÅäÁ≥ªÁªüÔºöÁæ§ËÅäÁÆ°ÁêÜ„ÄÅËÆæÁΩÆ„ÄÅPromptÁîüÊàê -->
    <script src="js/contacts.js"></script> <!-- ËÅîÁ≥ª‰∫∫ÔºöÂ•ΩÂèãÂàóË°®„ÄÅÂêçÁâá -->
    <script src="js/settings.js"></script> <!-- ËÆæÁΩÆÁÆ°ÁêÜÔºöAPIËÆæÁΩÆ„ÄÅÂ§ñËßÇËá™ÂÆö‰πâ„ÄÅÈ¢ÑËÆæÁÆ°ÁêÜ -->

    <!-- [3. Áã¨Á´ãÂäüËÉΩÊ®°Âùó (Plugins)] -->
    <script src="js/modules/sticker.js"></script> <!-- Ë°®ÊÉÖÂåÖÁÆ°ÁêÜÁ≥ªÁªü -->
    <script src="js/modules/pomodoro.js"></script> <!-- Áï™ËåÑÈíü‰∏ìÊ≥®ÂäüËÉΩ -->
    <script src="js/modules/forum.js"></script> <!-- ËôöÊãüËÆ∫ÂùõÂäüËÉΩ -->
    <script src="js/modules/worldbook.js"></script> <!-- ‰∏ñÁïå‰π¶ËÆæÂÆöÈõÜ -->
    <script src="js/modules/peek.js"></script> <!-- ÂÅ∑ÁúãÊâãÊú∫(Áõ∏ÂÜå/Áü≠‰ø°Á≠â) -->
    <script src="js/modules/journal.js"></script> <!-- ÂõûÂøÜÊó•ËÆ∞ÁîüÊàê -->
    <script src="js/modules/storage.js"></script> <!-- Â≠òÂÇ®Á©∫Èó¥ÂàÜÊûêÂõæË°® -->
    <script src="js/modules/widgets.js"></script> <!-- Ê°åÈù¢Â∞èÁªÑ‰ª∂ËÆæÁΩÆ -->
    <script src="js/modules/tutorial.js"></script> <!-- ÊïôÁ®ã„ÄÅÊõ¥Êñ∞Êó•Âøó„ÄÅGitHubÂ§á‰ªΩ -->
    <script src="js/modules/more_menu.js"></script> <!-- Êõ¥Â§öËèúÂçï‰∏éÁä∂ÊÄÅÊ†èÁÆ°ÁêÜ -->
    <script src="js/modules/favorites.js"></script> <!-- Ê∂àÊÅØÊî∂Ëóè -->
    <script src="js/modules/search.js"></script> <!-- ËÅäÂ§©ËÆ∞ÂΩïÊêúÁ¥¢Ê®°Âùó -->
    <script src="js/modules/battery_interaction.js"></script> <!-- ÁîµÈáè‰∫§‰∫íÊ®°Âùó -->
    <script src="js/modules/gallery.js"></script> <!-- ËßíËâ≤Áõ∏ÂÜåÁÆ°ÁêÜÊ®°Âùó -->
    <script src="js/modules/live.js"></script> <!-- Áõ¥Êí≠Èó¥Ê®°Âùó -->
    <script src="js/modules/shop.js"></script> <!-- ÂïÜÂüéÊ®°Âùó -->
    <script src="js/modules/cot_settings.js"></script> <!-- ÊÄùÁª¥ÈìæËÆæÁΩÆÊ®°Âùó -->
    <script src="js/modules/tts_service.js"></script> <!-- TTS ËØ≠Èü≥ÂêàÊàêÊúçÂä° -->
    <script src="js/modules/voice_selector.js"></script> <!-- Èü≥Ëâ≤ÈÄâÊã©Âô® -->
    <script src="js/modules/tts_settings.js"></script> <!-- TTS ËÆæÁΩÆÁÆ°ÁêÜ -->
    <script src="js/modules/video_call.js"></script> <!-- ËßÜÈ¢ëÈÄöËØùÊ®°Âùó -->
    <script src="js/modules/archive.js"></script> <!-- ËÆ∞ÂøÜÂ≠òÊ°£Â∫ìÊ®°Âùó -->
    <script src="js/modules/piggy_bank.js"></script> <!-- Â≠òÈí±ÁΩêÔºàÈí±ÂåÖÔºâÊ®°Âùó -->

    <!-- [4. Á®ãÂ∫èÂÖ•Âè£] -->
    <script src="js/main.js"></script> <!-- ‰∏ªÂÖ•Âè£ÔºöÂàùÂßãÂåñ(init)„ÄÅÂÖ®Â±Ä‰∫ã‰ª∂ÁõëÂê¨ -->
</body>

</html>